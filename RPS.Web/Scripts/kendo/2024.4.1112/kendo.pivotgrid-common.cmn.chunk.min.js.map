{"version":3,"file":"kendo.pivotgrid-common.cmn.chunk.min.js","names":["global","factory","exports","module","require","define","amd","globalThis","self","kendo","_globals","PivotgridCommonCmnChunk","DataQueryCmnChunk","this","kendo_dataQuery_cmn_chunk_js","filterFunctionFormats","contains","doesnotcontain","endswith","eq","neq","startswith","operators","serializeExpression","expression","command","value","String","field","operator","str","values","_i","arguments","length","forEach","index","replace","RegExp","formatString","serializeMembers","members","measures","sort","memberName","parsed","found","expanded","child","root","idx","member","name_1","name","push","hierarchyName","baseHierarchyPath","j","l","indexOf","expand","concat","parseDescriptors","rootNames","some","n","getRootNames","crossJoinCommands","names","crossJoinCommand","mapNames","expandMemberDescriptor","join","measureNames","measure","result","undefined","rootLength","slice","name_2","rootName","tmp","crossJoin","sortDescriptor","length_1","sortDescriptorForMember","dir","parts","split","pop","shift","createRequestBody","options","_a","columnAxes","_b","rowAxes","_c","measureAxes","_d","_e","filter","measuresRowAxis","measuresAxis","filters","cube","current","serializeFilters","connection","catalog","extendStatics","d","b","Object","setPrototypeOf","__proto__","Array","p","hasOwnProperty","__extends","__","constructor","prototype","create","__assign","assign","t","s","i","call","apply","__awaiter","thisArg","_arguments","P","generator","Promise","resolve","reject","fulfilled","step","next","e","rejected","done","then","__generator","body","f","y","g","_","label","sent","trys","ops","verb","throw","return","Symbol","iterator","v","op","TypeError","parseResponse","response","xmlDoc","DOMParser","parseFromString","axes","from","querySelectorAll","cells","map","cell","fmtValue","getPropertyValue","ordinal","parseInt","getAttribute","columns","tuples","rows","data","axis","tuple","lNum","hasChildren","caption","children","hierarchy","levelName","levelNum","parentName","translateAxis","indexedData","fill","c","counter","rowTuple","colTuple","columnTuple","node","querySelector","textContent","discoverCommands","schemaCatalogs","schemaCubes","schemaDimensions","schemaHierarchies","schemaKPIs","schemaLevels","schemaMeasures","schemaMembers","createDiscoverBody","properties","serializeOptions","restrictions","Catalog","parentTagName","capitalize","key","toUpperCase","_this","discoverParser","row","description","type","defaultHierarchy","uniqueName","dimensionUniqueName","displayFolder","origin","defaultMember","goal","status","trend","statusGraphic","trendGraphic","groupName","orderingProperty","hierarchyUniqueName","aggregator","defaultFormat","levelUniqueName","childrenCardinality","isMeasure","getMaxNesting","set","Set","add","size","getMaxExpansion","generateNormalizedPath","parent","normalizedPath","Boolean","toMatrix","rowIndex","colIndex","maxDepth","maxBreadth","matrix","leafs","branchDepth","branchBreadth","depth","breadth","matrixResult","leafsResult","findIndex","level","inject","total","path","splice","collOffset","newMatrix","newLeafs","childBreadth","withTotal","alt","childIndex","childHierarchy","copy","obj","JSON","parse","stringify","kpiMeasure","kpi","buildKPIMeasures","compareAxisWithField","a","compareAxes","filterField","out","_loop_2","startsWith","duplicatedAxisIndex","ax","insertAxis","toInsert","state","dropTarget","dropDirection","offset","reverseColumnsByMeasures","firstColumn","lastMember","columnsArr","measuresCount","col","result_1","arr","reverse","HEADERS_ACTION","PIVOT_CONFIGURATOR_ACTION","findPath","matchFn","matched","match","h","headersReducer","action","toggle","existing","find","payload","collapse","existing_1","nextState","filtered_1","tree","I","configuratorReducer","newRows","newColumns","newMeasures","newSort","newFilter","newDragitem","newDropZone","newDropDirection","newDropTarget","toggleSelection","isArray","payload_1","removeMeasureAxis","addMeasureAxis","every","m","removeMeasureAxes","addMeasureAxes","removeColumnAxis","removeRowAxis","addColumnAxis","addRowAxis","addColumnAxes","removeColumnAxes","addRowAxes","removeRowAxes","remove","setDragItem","setDropZone","setDropTarget","setDropDirection","drop","dragItem","dropZone","currentColumn","currentRow","currentMeasure","setSort","setFilter","addFilter","changeFilter","removeFilter","minAggregate","init","min","Number","POSITIVE_INFINITY","merge","src","dest","Math","accumulate","acc","isFinite","NaN","format","toFixed","maxAggregate","max","NEGATIVE_INFINITY","forEachDesc","desc","callbackfn","filterFields","callback","subNode","initialNode","childNode","get","Map","splitKeyValue","keyValue","separatorIndex","substring","calculateColumnData","dataField","k","childData_1","parentData_1","aggregate","mergeTrees","srcChild","destChild","calculateColumns","columnsData","srcColumns","destColumns","createPath","caption_1","membersNode","axisSettings","cache","cacheData","has","currentLevel","currentLevelNode","levelField_1","_loop_1","item","newDest","currentPath","readData","dataTree","rowTuples","columnTuples","fields","columnSettings","rowSettings","rowsCache","rowNode","rowColumnsNode","measuresMember_1","colNode","mergeData","exclude","rootFields","definitions","createTuples","axesSettings","sortDescriptors","excludeFields","parentFields","flatMembers","topTuple","allTuple","topField","getTopMembersTuple","currDef","axe","keysToAdd","keys","currDefMembers","element","delete","nodeData","curLevel_1","childrenByKeys","descriptor","order","sortableA","sortValue","sortableB","sortFunc","leafValue","leafTuple","axisCaption","curCaption","measureToMember","addMeasure","measureMember","tupleCopy","addMultipleMeasures","tupleWithMeasure","Navigation","tabIndex","eventHandlers","update","defineProperty","selectors","enumerable","configurable","all","elements","el","matches","start","eventType","this_1","mouseEvents","ev","target","Element","closest","addEventListener","this_2","keyboardEvents","stop","removeEventListener","focusElement","previous","removeAttribute","classList","setAttribute","focus","preventScroll","scrollableValuesSel","scrollableColumnHeaderSel","scrollableRowHeaderSel","emptyCellSel","tableSel","cellSel","scrollables","selectors$1","onEnter","nav","icon","index_1","click","preventDefault","tryScrollLeft","scrollable","elToScroll","offsetLeft","scrollLeft","tryScrollRight","offsetWidth","tryScrollUp","scrollTop","offsetTop","tryScrollDown","offsetHeight","scrollTo","scrollFunc","scroll","tableMap","table","colsCount","colSpan","reduce","prev","cur","r","curColSpan","colSp","rowSp","rowSpan","ind","val","curInd","navigationMap","columnHeader","rowHeader","emptyCell","emptyCellRow","ctrlKey","metaKey","cellAt","pos","targetPos","getTargetPos","nextPos","keyboardEvents$1","keydown","ArrowLeft","ArrowRight","ArrowUp","ArrowDown","o","_target","_ev","nextElementSibling","HTMLElement","setTimeout","parentNode","confHeader","Enter","Space","Home","ro","x","End","mouseEvents$1","hasAttribute","PivotGridNavigation","_super","navigate","onDelete","Tab","shiftKey","Escape","pivot","previousElementSibling","confButton","pivotCell","Delete","Backspace","ConfiguratorNavigation","A","B","C","D","E","F","G","H","__meta__","id","category","depends","hidden","chunk","args","colTuples","sumA","count","leafNodes","compositeFilter","logic","predicate","fieldValues","hasFilter","filteringAxes","filteringFields_1","initializeFiltering","dataItem","filteringDataItem_1","displayValue","dataKey","node_1","eachAxis","leaf","countA","_value","fetchOptions","headers","method","fetch","url","text","stringResponse","tupleIndex","memberIndex","parent_1","parentKey","intruderIndex","rotateMatrix","q","sum","hash","membersNames","columnsIndexes","rowsIndexes","colMembers","rowMembers","u","expandTree","descriptors","w","dimensions","dim","z"],"sources":["kendo.pivotgrid-common.cmn.chunk.js"],"mappings":"CAAA,SAAWA,EAAQC,GACI,iBAAZC,SAA0C,oBAAXC,OAAyBF,EAAQC,QAASE,QAAQ,kCACtE,mBAAXC,QAAyBA,OAAOC,IAAMD,OAAO,CAAC,UAAW,8BAA+BJ,GACpBA,IAA1ED,EAA+B,oBAAfO,WAA6BA,WAAaP,GAAUQ,MAAsBC,MAAQT,EAAOS,OAAS,CAAC,EAAGT,EAAOS,MAAMC,SAAWV,EAAOS,MAAMC,UAAY,CAAC,EAAGV,EAAOS,MAAMC,SAASC,wBAA0B,CAAC,GAAIX,EAAOS,MAAMC,SAASE,kBAC1P,CAJD,CAIGC,MAAM,SAAWX,EAASY,GAazB,IAAIC,EAAwB,CACxBC,SAAU,sDACVC,eAAgB,kDAChBC,SAAU,6DACVC,GAAI,6CACJC,IAAK,6CACLC,WAAY,6DAEZC,EACgB,iBADhBA,EAEI,KAFJA,EAGK,MAsBT,SAASC,EAAoBC,GACzB,IAAIC,EAAU,GACVC,EAAQC,OAAOH,EAAWE,OAC1BE,EAAQJ,EAAWI,MACnBC,EAAWL,EAAWK,SAa1B,OAZIA,IAAaP,GACbG,GAAW,IACXA,GAAWC,EACXD,GAAW,MAGXA,GAAWI,IAAaP,GAAiBO,IAAaP,EAA2B,IAAM,GACvFG,GAAW,UACXA,GAAWG,EAAQ,WACnBH,GAKR,SAAsBK,GAElB,IADA,IAAIC,EAAS,GACJC,EAAK,EAAGA,EAAKC,UAAUC,OAAQF,IACpCD,EAAOC,EAAK,GAAKC,UAAUD,GAK/B,OAHAD,EAAOI,SAAQ,SAAUT,EAAOU,GAC5BN,EAAMA,EAAIO,QAAQ,IAAIC,OAAO,MAAQF,EAAQ,MAAO,KAAMV,EAC9D,IACOI,CACX,CAdmBS,CAAaxB,EAAsBc,GAAWD,EAAOF,GAChED,GAAW,KAERA,CACX,CAeA,SAASe,EAAiBC,EAASC,EAAUC,GACzC,IAQIC,EARAnB,EAAU,GAEVoB,EAkDR,SAA0BJ,GAMtB,IALA,IAIIK,EAJAC,EAAW,GACXC,EAAQ,GACRC,EAAO,GACPC,EAAM,EAEHA,EAAMT,EAAQP,OAAQgB,IAAO,CAChC,IAAIC,EAASV,EAAQS,GACjBE,EAASD,EAAOE,KAEpB,GADAP,GAAQ,EACJM,EAAOlB,OAAS,EAChBc,EAAMM,KAAKH,OAEV,CAED,IADA,IAAII,EAAgBC,EAAkBJ,EAAO,IACpCK,EAAI,EAAGC,EAAIT,EAAKf,OAAQuB,EAAIC,EAAGD,IACpC,GAA+C,IAA3CR,EAAKQ,GAAGJ,KAAK,GAAGM,QAAQJ,GAAsB,CAC9CT,GAAQ,EACR,KACJ,CAECA,GACDG,EAAKK,KAAKH,GAEVA,EAAOS,QACPb,EAASO,KAAKH,EAEtB,CACJ,CAEA,OADAJ,EAAWA,EAASc,OAAOb,GACpB,CACHD,SAAUA,EACVE,KAAMA,EAEd,CApFiBa,CADbrB,EAAUA,GAAW,IAEjBM,EAAWF,EAAOE,SAClBgB,EAqCR,SAAsBtB,GAClB,IAAIQ,EAAO,GAQX,OAPAR,EAAQN,SAAQ,SAAUgB,GACtB,IAAIE,EAAOF,EAAOE,KAAK,GACnBE,EAAgBC,EAAkBH,GACjCJ,EAAKe,MAAK,SAAUC,GAAK,OAAoC,IAA7BA,EAAEN,QAAQJ,EAAsB,KACjEN,EAAKK,KAAKD,EAElB,IACOJ,CACX,CA/CoBiB,CAAarB,EAAOI,MAChCkB,EAAoB,GACpBjC,EAASa,EAASb,OAClBgB,EAAM,EAENkB,EAAQ,GACZ,GAAIL,EAAU7B,OAAS,GAAKQ,EAASR,OAAS,EAAG,CAE7C,IADAiC,EAAkBb,KAAKe,EAAiBN,EAAWrB,IAC5CQ,EAAMhB,EAAQgB,IAEjBkB,EAAQE,EADR1B,EAAa2B,EAAuBxB,EAASG,GAAKG,KAAMV,GAC3BoB,GAC7BI,EAAkBb,KAAKe,EAAiBD,EAAO1B,IAEnDjB,GAAW0C,EAAkBK,KAAK,IACtC,KACK,CACD,KAAOtB,EAAMhB,EAAQgB,IACjBN,EAAa2B,EAAuBxB,EAASG,GAAKG,KAAMV,GACxDyB,EAAMd,KAAKV,EAAW,IAE1BnB,GAAWsC,EAAUF,OAAOO,GAAOI,KAAK,IAC5C,CACA,OAAO/C,CACX,CAIA,SAASgD,EAAa/B,GAIlB,IAHA,IAEIgC,EAFAxC,EAASQ,EAASR,OAClByC,EAAS,GAEJzB,EAAM,EAAGA,EAAMhB,EAAQgB,IAC5BwB,EAAUhC,EAASQ,GACnByB,EAAOrB,UAAsBsB,IAAjBF,EAAQrB,KAAqBqB,EAAQrB,KAAOqB,GAE5D,OAAOC,CACX,CA+CA,SAASL,EAASF,EAAOL,GACrB,IAAIc,EAAad,EAAU7B,OAC3B6B,EAAYA,EAAUe,MAAM,GAC5B,IAAK,IAAI5B,EAAM,EAAGA,EAAMkB,EAAMlC,OAAQgB,IAElC,IADA,IAAI6B,EAASX,EAAMlB,GACVO,EAAI,EAAGA,EAAIoB,EAAYpB,IAAK,CACjC,IAAIuB,EAAWxB,EAAkBO,EAAUN,IAC3C,IAAkC,IAA9BsB,EAAOpB,QAAQqB,GAAkB,CACjCjB,EAAUN,GAAKsB,EACf,KACJ,CACJ,CAEJ,OAAOhB,CACX,CACA,SAASM,EAAiB5B,EAASC,GAC/B,IAAIuC,EAAMxC,EAAQqC,MAAM,GAIxB,OAHIpC,EAASR,OAAS,GAClB+C,EAAI3B,KAAK,IAAMmB,EAAa/B,GAAU8B,KAAK,KAAO,KAE/CU,EAAUD,EACrB,CACA,SAASV,EAAuBH,EAAOzB,GACnC,IAAIO,EAAMkB,EAAMlC,OAAS,EACrBmB,EAAOe,EAAMlB,GACbiC,EAUR,SAAiCxC,EAAMQ,GACnC,IAAK,IAAID,EAAM,EAAGkC,EAAWzC,EAAKT,OAAQgB,EAAMkC,EAAUlC,IACtD,GAAwC,IAApCC,EAAOQ,QAAQhB,EAAKO,GAAKtB,OACzB,OAAOe,EAAKO,GAGpB,OAAO,IACX,CAjByBmC,CAAwB1C,EAAMU,GAQnD,OAPI8B,GAAkBA,EAAeG,IACjCjC,EAAO,SAAWA,EAAO,aAAe8B,EAAevD,MAAQ,iCAAmCuD,EAAeG,IAAM,IAGvHjC,GAAQ,YAEZe,EAAMlB,GAAOG,EACNe,CACX,CASA,SAASZ,EAAkBZ,GACvB,IAAI2C,EAAQ3C,EAAW4C,MAAM,KAC7B,OAAID,EAAMrD,OAAS,EACRqD,EAAM,GAAK,IAAMA,EAAM,GAE3B3C,CACX,CACA,SAASsC,EAAUd,GACf,IACIf,EADAsB,EAAS,cAab,OAXIP,EAAMlC,OAAS,GACfmB,EAAOe,EAAMqB,MACbd,GAAUO,EAAUd,KAGpBO,GAAUP,EAAMsB,QAChBrC,EAAOe,EAAMqB,OAEjBd,GAAU,MACVA,GAAUtB,EACVsB,GAAU,IAEd,CAKA,SAASgB,EAAkBC,GACvB,IAAInE,EAAU,0JACVoE,EAAKD,EAAQE,WAAYA,OAAoB,IAAPD,EAAgB,GAAKA,EAAIE,EAAKH,EAAQI,QAASA,OAAiB,IAAPD,EAAgB,GAAKA,EACpHE,EAAKL,EAAQM,YAAaA,OAAqB,IAAPD,EAAgB,GAAKA,EAAIE,EAAKP,EAAQjD,KAAMA,OAAc,IAAPwD,EAAgB,GAAKA,EAAIC,EAAKR,EAAQS,OAAQA,OAAgB,IAAPD,EAAgB,GAAKA,EACvKE,EAA2C,SAAzBV,EAAQW,aAwC9B,OAvCA9E,GAAW,sBACNqE,EAAW5D,QAAU8D,EAAQ9D,UAAYgE,EAAYhE,QAAWgE,EAAYhE,QAAUoE,KACvFR,EAAaE,EACbA,EAAU,GACVM,GAAkB,GAEjBR,EAAW5D,QAAW8D,EAAQ9D,SAC/BoE,GAAkB,GAElBR,EAAW5D,OACXT,GAAWe,EAAiBsD,EAAaQ,EAAgC,GAAdJ,EAAkBvD,GAExEuD,EAAYhE,SAAWoE,IAC5B7E,GAAWgD,EAAayB,GAAa1B,KAAK,MAE9C/C,GAAW,8EACPuE,EAAQ9D,QAAWoE,GAAmBJ,EAAYhE,OAAS,KAC3DT,GAAW,gBACPuE,EAAQ9D,OACRT,GAAWe,EAAiBwD,EAASM,EAAkBJ,EAAc,GAAIvD,GAGzElB,GAAWgD,EAAayB,GAAa1B,KAAK,KAE9C/C,GAAW,2EAEX4E,EAAOnE,QACPT,GAAW,SACXA,GAAW,IACXA,GAlPR,SAA0B+E,EAASC,GAG/B,IAFA,IAAIhF,EAAU,GACViF,EAAU,GACLxD,EAAMsD,EAAQtE,OAAS,EAAGgB,GAAO,EAAGA,IACzCwD,EAAU,WACVA,GAAWnF,EAAoBiF,EAAQtD,IACvCwD,GAAW,SAGPjF,EAFAyB,IAAQsD,EAAQtE,OAAS,EACzBwE,GAAW,UAAYD,EAAO,IAIpBC,EAAU,WAAajF,EAAU,KAGnD,OAAOA,CACX,CAkOmBkF,CAAiBN,EAAQT,EAAQgB,WAAWH,MACvDhF,GAAW,KAGXA,GAAW,UAAYmE,EAAQgB,WAAWH,KAAO,IAE1B,IAAvBP,EAAYhE,QAAgB4D,EAAW5D,SACvCT,GAAW,WAAagD,EAAayB,GAAa1B,KAAK,KAAO,MAElE/C,GAAW,4DAA8DmE,EAAQgB,WAAWC,QAAU,uGACvFxE,QAAQ,KAAM,QACjC,CAkBA,IAAIyE,EAAgB,SAASC,EAAGC,GAI5B,OAHAF,EAAgBG,OAAOC,gBAClB,CAAEC,UAAW,cAAgBC,OAAS,SAAUL,EAAGC,GAAKD,EAAEI,UAAYH,CAAG,GAC1E,SAAUD,EAAGC,GAAK,IAAK,IAAIK,KAAKL,EAAOA,EAAEM,eAAeD,KAAIN,EAAEM,GAAKL,EAAEK,GAAI,EACtEP,EAAcC,EAAGC,EAC5B,EAEA,SAASO,EAAUR,EAAGC,GAElB,SAASQ,IAAO3G,KAAK4G,YAAcV,CAAG,CADtCD,EAAcC,EAAGC,GAEjBD,EAAEW,UAAkB,OAANV,EAAaC,OAAOU,OAAOX,IAAMQ,EAAGE,UAAYV,EAAEU,UAAW,IAAIF,EACnF,CAEA,IAAII,EAAW,WAQX,OAPAA,EAAWX,OAAOY,QAAU,SAAkBC,GAC1C,IAAK,IAAIC,EAAGC,EAAI,EAAG/D,EAAIhC,UAAUC,OAAQ8F,EAAI/D,EAAG+D,IAE5C,IAAK,IAAIX,KADTU,EAAI9F,UAAU+F,GACOf,OAAOS,UAAUJ,eAAeW,KAAKF,EAAGV,KAAIS,EAAET,GAAKU,EAAEV,IAE9E,OAAOS,CACX,EACOF,EAASM,MAAMrH,KAAMoB,UAChC,EA6BA,SAASkG,EAAUC,EAASC,EAAYC,EAAGC,GAEvC,OAAO,IAAKD,IAAMA,EAAIE,WAAU,SAAUC,EAASC,GAC/C,SAASC,EAAUjH,GAAS,IAAMkH,EAAKL,EAAUM,KAAKnH,GAAS,CAAE,MAAOoH,GAAKJ,EAAOI,EAAI,CAAE,CAC1F,SAASC,EAASrH,GAAS,IAAMkH,EAAKL,EAAiB,MAAE7G,GAAS,CAAE,MAAOoH,GAAKJ,EAAOI,EAAI,CAAE,CAC7F,SAASF,EAAKjE,GAJlB,IAAejD,EAIaiD,EAAOqE,KAAOP,EAAQ9D,EAAOjD,QAJ1CA,EAIyDiD,EAAOjD,MAJhDA,aAAiB4G,EAAI5G,EAAQ,IAAI4G,GAAE,SAAUG,GAAWA,EAAQ/G,EAAQ,KAIjBuH,KAAKN,EAAWI,EAAW,CAC7GH,GAAML,EAAYA,EAAUL,MAAME,EAASC,GAAc,KAAKQ,OAClE,GACJ,CAEA,SAASK,EAAYd,EAASe,GAC1B,IAAsGC,EAAGC,EAAGvB,EAAGwB,EAA3GC,EAAI,CAAEC,MAAO,EAAGC,KAAM,WAAa,GAAW,EAAP3B,EAAE,GAAQ,MAAMA,EAAE,GAAI,OAAOA,EAAE,EAAI,EAAG4B,KAAM,GAAIC,IAAK,IAChG,OAAOL,EAAI,CAAET,KAAMe,EAAK,GAAIC,MAASD,EAAK,GAAIE,OAAUF,EAAK,IAAwB,mBAAXG,SAA0BT,EAAES,OAAOC,UAAY,WAAa,OAAOnJ,IAAM,GAAIyI,EACvJ,SAASM,EAAK3F,GAAK,OAAO,SAAUgG,GAAK,OACzC,SAAcC,GACV,GAAId,EAAG,MAAM,IAAIe,UAAU,mCAC3B,KAAOZ,OACH,GAAIH,EAAI,EAAGC,IAAMvB,EAAY,EAARoC,EAAG,GAASb,EAAU,OAAIa,EAAG,GAAKb,EAAS,SAAOvB,EAAIuB,EAAU,SAAMvB,EAAEG,KAAKoB,GAAI,GAAKA,EAAER,SAAWf,EAAIA,EAAEG,KAAKoB,EAAGa,EAAG,KAAKlB,KAAM,OAAOlB,EAE3J,OADIuB,EAAI,EAAGvB,IAAGoC,EAAK,CAAS,EAARA,EAAG,GAAQpC,EAAEpG,QACzBwI,EAAG,IACP,KAAK,EAAG,KAAK,EAAGpC,EAAIoC,EAAI,MACxB,KAAK,EAAc,OAAXX,EAAEC,QAAgB,CAAE9H,MAAOwI,EAAG,GAAIlB,MAAM,GAChD,KAAK,EAAGO,EAAEC,QAASH,EAAIa,EAAG,GAAIA,EAAK,CAAC,GAAI,SACxC,KAAK,EAAGA,EAAKX,EAAEI,IAAIlE,MAAO8D,EAAEG,KAAKjE,MAAO,SACxC,QACI,KAAMqC,EAAIyB,EAAEG,MAAM5B,EAAIA,EAAE5F,OAAS,GAAK4F,EAAEA,EAAE5F,OAAS,KAAkB,IAAVgI,EAAG,IAAsB,IAAVA,EAAG,IAAW,CAAEX,EAAI,EAAG,QAAU,CAC3G,GAAc,IAAVW,EAAG,MAAcpC,GAAMoC,EAAG,GAAKpC,EAAE,IAAMoC,EAAG,GAAKpC,EAAE,IAAM,CAAEyB,EAAEC,MAAQU,EAAG,GAAI,KAAO,CACrF,GAAc,IAAVA,EAAG,IAAYX,EAAEC,MAAQ1B,EAAE,GAAI,CAAEyB,EAAEC,MAAQ1B,EAAE,GAAIA,EAAIoC,EAAI,KAAO,CACpE,GAAIpC,GAAKyB,EAAEC,MAAQ1B,EAAE,GAAI,CAAEyB,EAAEC,MAAQ1B,EAAE,GAAIyB,EAAEI,IAAIrG,KAAK4G,GAAK,KAAO,CAC9DpC,EAAE,IAAIyB,EAAEI,IAAIlE,MAChB8D,EAAEG,KAAKjE,MAAO,SAEtByE,EAAKf,EAAKlB,KAAKG,EAASmB,EAC5B,CAAE,MAAOT,GAAKoB,EAAK,CAAC,EAAGpB,GAAIO,EAAI,CAAG,CAAE,QAAUD,EAAItB,EAAI,CAAG,CACzD,GAAY,EAARoC,EAAG,GAAQ,MAAMA,EAAG,GAAI,MAAO,CAAExI,MAAOwI,EAAG,GAAKA,EAAG,QAAK,EAAQlB,MAAM,EAC9E,CAtBgDJ,CAAK,CAAC3E,EAAGgG,GAAK,CAAG,CAuBrE,CAuHA,SAASG,EAAcC,GACnB,IAAIC,GAAS,IAAIC,WAAYC,gBAAgBH,EAAU,YACnDI,EAAOrD,MAAMsD,KAAKJ,EAAOK,iBAAiB,SAC1CC,EAAQxD,MAAMsD,KAAKJ,EAAOK,iBAAiB,oBAC1CE,KAAI,SAAUC,GAAQ,MAAO,CAC9BC,SAAUC,EAAiBF,EAAM,YACjCG,QAASC,SAASJ,EAAKK,aAAa,eAAgB,IACpDzJ,MAAOsJ,EAAiBF,EAAM,SAC9B,IACAM,EAAU,CAAEC,OAAQ,IACpBC,EAAO,CAAED,OAAQ,IACjBE,EAAO,GACXd,EAAKtI,SAAQ,SAAUqJ,GACnB,GAAkC,eAA9BA,EAAKL,aAAa,QAA0B,CAC5C,IAAIE,EAAmC,IAA1BD,EAAQC,OAAOnJ,OAAekJ,EAAQC,OAASC,EAAKD,OACjEjE,MAAMM,UAAUpE,KAAK4E,MAAMmD,EAyBvC,SAAuBG,GACnB,IAAIH,EAASjE,MAAMsD,KAAKc,EAAKb,iBAAiB,UAC9C,OAAOU,EAAOR,KAAI,SAAUY,GAgBxB,MAAO,CAAEhJ,QAfY2E,MAAMsD,KAAKe,EAAMd,iBAAiB,WAC1BE,KAAI,SAAU1H,GACvC,IAAIuI,EAAOR,SAASF,EAAiB7H,EAAQ,SAAW,IAAK,IACzDwI,EAAcT,SAASF,EAAiB7H,EAAQ,yBAA2B,IAAK,IAAM,EAC1F,MAAO,CACHyI,QAASZ,EAAiB7H,EAAQ,WAClC0I,SAAU,GACVF,YAAaA,EACbG,UAAW3I,EAAOgI,aAAa,aAC/BY,UAAWf,EAAiB7H,EAAQ,SACpC6I,SAAUN,EACVrI,KAAM2H,EAAiB7H,EAAQ,SAC/B8I,WAAYjB,EAAiB7H,EAAQ,sBAE7C,IAEJ,GACJ,CA7C+C+I,CAAcV,GACrD,CACJ,IACA,IAAIW,EAAc,IAAI/E,MAAMkE,EAAKD,OAAOnJ,OAASkJ,EAAQC,OAAOnJ,QAAQkK,KAAK,MAC7ExB,EAAMzI,SAAQ,SAAUkK,GAAKF,EAAYE,EAAEpB,SAAWoB,CAAG,IACzD,IAAIC,EAAU,EAWd,OAVAhB,EAAKD,OAAOlJ,SAAQ,SAAUoK,GAC1BnB,EAAQC,OAAOlJ,SAAQ,SAAUqK,GAC7BjB,EAAKjI,KAAK,CACNmJ,YAAaD,EACbjB,KAAMY,EAAYG,GAClBC,SAAUA,IAEdD,GACJ,GACJ,IACO,CAAElB,QAASA,EAASG,KAAMA,EAAMD,KAAMA,EACjD,CAIA,SAASN,EAAiB7H,EAAQE,GAC9B,IAAIqJ,EAAOvJ,EAAOwJ,cAActJ,GAChC,OAAOqJ,EAAOA,EAAKE,YAAc,EACrC,CA0BA,IAAIC,EAAmB,CACnBC,eAAgB,oBAChBC,YAAa,iBACbC,iBAAkB,sBAClBC,kBAAmB,uBACnBC,WAAY,gBACZC,aAAc,kBACdC,eAAgB,oBAChBC,cAAe,oBAKnB,SAASC,EAAmB1H,GACxB,IAAI2H,EAAa,CAAC,EACd9L,EAAU,uIAQd,OAPAA,GAAW,iBAAmBoL,EAAiBjH,EAAQnE,UAAYmE,EAAQnE,SAAW,iBACtFA,GAAW,iBAAmB+L,EAAiB,kBAAmB5H,EAAQ6H,cAAc,GAAQ,kBAC5F7H,EAAQgB,YAAchB,EAAQgB,WAAWC,UACzC0G,EAAWG,QAAU9H,EAAQgB,WAAWC,SAE5CpF,GAAW,eAAiB+L,EAAiB,eAAgBD,GAAY,GAAS,gBAClF9L,GAAW,+BAEf,CACA,SAAS+L,EAAiBG,EAAe/H,EAASgI,GAC9C,IAAIjJ,EAAS,GACb,GAAIiB,EAAS,CACTjB,GAAU,IAAMgJ,EAAgB,IAChC,IAAIjM,OAAQ,EACZ,IAAK,IAAImM,KAAOjI,EACRA,EAAQiI,KACRnM,EAAQkE,EAAQiI,GACZD,IACAC,EAAMA,EAAIxL,QAAQ,yCAA0C,OAAOyL,cAAczL,QAAQ,KAAM,KAEnGsC,GAAU,IAAMkJ,EAAM,IAAMnM,EAAQ,KAAOmM,EAAM,KAGzDlJ,GAAU,KAAOgJ,EAAgB,GACrC,MAEIhJ,GAAU,IAAMgJ,EAAgB,KAEpC,OAAOhJ,CACX,CA2IA,IAAIoJ,OAAQnJ,EACRoJ,EAAiB,CACjBlB,eA1HJ,SAAuBzC,GACnB,IAAIC,GAAS,IAAIC,WAAYC,gBAAgBH,EAAU,YAMvD,OALWjD,MAAMsD,KAAKJ,EAAOK,iBAAiB,2CACzCE,KAAI,SAAUoD,GAAO,MAAO,CAC7B5K,KAAM2H,EAAiBiD,EAAK,gBAC5BC,YAAalD,EAAiBiD,EAAK,eACnC,GAER,EAmHIlB,YAzIJ,SAAoB1C,GAChB,IAAIC,GAAS,IAAIC,WAAYC,gBAAgBH,EAAU,YAQvD,OAPWjD,MAAMsD,KAAKJ,EAAOK,iBAAiB,2CACzCE,KAAI,SAAUoD,GAAO,MAAO,CAC7B5K,KAAM2H,EAAiBiD,EAAK,aAC5BrC,QAASZ,EAAiBiD,EAAK,gBAC/BC,YAAalD,EAAiBiD,EAAK,eACnCE,KAAMnD,EAAiBiD,EAAK,aAC5B,GAER,EAgIIjB,iBAxEJ,SAAyB3C,GACrB,IAAIC,GAAS,IAAIC,WAAYC,gBAAgBH,EAAU,YAUvD,OATWjD,MAAMsD,KAAKJ,EAAOK,iBAAiB,2CACzCE,KAAI,SAAUoD,GAAO,MAAO,CAC7BrC,QAASZ,EAAiBiD,EAAK,qBAC/BG,iBAAkBpD,EAAiBiD,EAAK,qBACxCC,YAAalD,EAAiBiD,EAAK,eACnC5K,KAAM2H,EAAiBiD,EAAK,kBAC5BE,KAAMjD,SAASF,EAAiBiD,EAAK,kBAAmB,IACxDI,WAAYrD,EAAiBiD,EAAK,yBAClC,GAER,EA6DIhB,kBAzDJ,SAA0B5C,GACtB,IAAIC,GAAS,IAAIC,WAAYC,gBAAgBH,EAAU,YAYvD,OAXWjD,MAAMsD,KAAKJ,EAAOK,iBAAiB,2CACzCE,KAAI,SAAUoD,GAAO,MAAO,CAC7B5K,KAAM2H,EAAiBiD,EAAK,kBAC5BrC,QAASZ,EAAiBiD,EAAK,qBAC/BC,YAAalD,EAAiBiD,EAAK,eACnCI,WAAYrD,EAAiBiD,EAAK,yBAClCK,oBAAqBtD,EAAiBiD,EAAK,yBAC3CM,cAAevD,EAAiBiD,EAAK,4BACrCO,OAAQxD,EAAiBiD,EAAK,oBAC9BQ,cAAezD,EAAiBiD,EAAK,kBACrC,GAER,EA4CIf,WAhGJ,SAAmB7C,GACf,IAAIC,GAAS,IAAIC,WAAYC,gBAAgBH,EAAU,YAgBvD,OAfWjD,MAAMsD,KAAKJ,EAAOK,iBAAiB,2CACzCE,KAAI,SAAUoD,GAAO,MAAO,CAC7B5K,KAAM2H,EAAiBiD,EAAK,YAC5BI,WAAYrD,EAAiBiD,EAAK,YAClCrC,QAASZ,EAAiBiD,EAAK,eAC/BvM,MAAOsJ,EAAiBiD,EAAK,aAC7BS,KAAM1D,EAAiBiD,EAAK,YAC5BU,OAAQ3D,EAAiBiD,EAAK,cAC9BW,MAAO5D,EAAiBiD,EAAK,aAC7BY,cAAe7D,EAAiBiD,EAAK,sBACrCa,aAAc9D,EAAiBiD,EAAK,qBACpCC,YAAalD,EAAiBiD,EAAK,mBACnCc,UAAW/D,EAAiBiD,EAAK,qBACjCE,KAAM,MACN,GAER,EA+EIhB,aAzCJ,SAAqB9C,GACjB,IAAIC,GAAS,IAAIC,WAAYC,gBAAgBH,EAAU,YAavD,OAZWjD,MAAMsD,KAAKJ,EAAOK,iBAAiB,2CACzCE,KAAI,SAAUoD,GAAO,MAAO,CAC7B5K,KAAM2H,EAAiBiD,EAAK,cAC5BrC,QAASZ,EAAiBiD,EAAK,iBAC/BC,YAAalD,EAAiBiD,EAAK,eACnCI,WAAYrD,EAAiBiD,EAAK,qBAClCK,oBAAqBtD,EAAiBiD,EAAK,yBAC3CM,cAAevD,EAAiBiD,EAAK,wBACrCe,iBAAkBhE,EAAiBiD,EAAK,2BACxCO,OAAQxD,EAAiBiD,EAAK,gBAC9BgB,oBAAqBjE,EAAiBiD,EAAK,yBAC3C,GAER,EA2BIb,eApHJ,SAAuB/C,GACnB,IAAIC,GAAS,IAAIC,WAAYC,gBAAgBH,EAAU,YAYvD,OAXWjD,MAAMsD,KAAKJ,EAAOK,iBAAiB,2CACzCE,KAAI,SAAUoD,GAAO,MAAO,CAC7B5K,KAAM2H,EAAiBiD,EAAK,gBAC5BrC,QAASZ,EAAiBiD,EAAK,mBAC/BI,WAAYrD,EAAiBiD,EAAK,uBAClCC,YAAalD,EAAiBiD,EAAK,eACnCiB,WAAYlE,EAAiBiD,EAAK,sBAClCc,UAAW/D,EAAiBiD,EAAK,qBACjCM,cAAevD,EAAiBiD,EAAK,0BACrCkB,cAAenE,EAAiBiD,EAAK,yBACrC,GAER,EAuGIZ,cAxBJ,SAAsBhD,GAClB,IAAIC,GAAS,IAAIC,WAAYC,gBAAgBH,EAAU,YAWvD,OAVWjD,MAAMsD,KAAKJ,EAAOK,iBAAiB,2CACzCE,KAAI,SAAUoD,GAAO,MAAO,CAC7B5K,KAAM2H,EAAiBiD,EAAK,eAC5BrC,QAASZ,EAAiBiD,EAAK,kBAC/BI,WAAYrD,EAAiBiD,EAAK,sBAClCK,oBAAqBtD,EAAiBiD,EAAK,yBAC3CgB,oBAAqBjE,EAAiBiD,EAAK,yBAC3CmB,gBAAiBpE,EAAiBiD,EAAK,qBACvCoB,oBAAqBrE,EAAiBiD,EAAK,wBAC3C,GAER,GAiEIqB,EAAY,SAAUnM,GAAU,MAA4B,eAArBA,EAAO2I,SAA4B,EAM1EyD,EAAgB,SAAU7C,EAAM8C,GAMhC,YALY,IAARA,IAAkBA,EAAM,IAAIC,MAC/B/C,EAAKb,UAAY,IAAI1J,SAAQ,SAAUa,GACpCwM,EAAIE,IAAI1M,EAAM+I,WACdwD,EAAcvM,EAAOwM,EACzB,IACOA,EAAIG,IACf,EAIIC,EAAkB,SAAUlD,GAC5B,IAAI3J,EAAW,EAIf,OAHC2J,EAAKb,UAAY,IAAI1J,SAAQ,SAAUa,GACpCD,GAAa6M,EAAgB5M,IAAU,CAC3C,IACOD,CACX,EAII8M,EAAyB,SAAUnD,EAAMoD,GACzC,OAAQA,GAAWA,EAAOhE,YAAcY,EAAKZ,WACtCgE,EAAOC,gBAAkB,IAAIjL,MAAM,GAAI,GAAGjB,OAAO,CAAC6I,EAAKrJ,MAAQ,QAAWyM,GAAUA,EAAOC,eAAkBD,EAAOC,eAAiB,IAAIlM,OAAO,CAAC6I,EAAKrJ,QAAQgD,OAAO2J,QAChL,EAWIC,EAAW,SAAUvD,EAAMwD,EAAUC,EAAUC,EAAUC,EAAYC,EAAQC,EAAOT,QACnE,IAAbI,IAAuBA,GAAY,QACtB,IAAbC,IAAuBA,EAAW,QACrB,IAAbC,IAAuBA,OAAWxL,QACnB,IAAfyL,IAAyBA,OAAazL,QAC3B,IAAX0L,IAAqBA,OAAS1L,QACpB,IAAV2L,IAAoBA,OAAQ3L,QACjB,IAAXkL,IAAqBA,OAASlL,GAClC,IAAI4L,EAAcjB,EAAc7C,GAC5B+D,EAAgBb,EAAgBlD,GAChCgE,EAAQN,GAAYI,EACpBG,EAAUN,GAAcI,EACxBG,EAAeN,EAASA,EAAOxL,QAAU,GACzC+L,EAAcN,EAAQA,EAAMzL,QAAU,IAAIsC,MAAMuJ,GAChDvO,EAAQwO,EAAaE,WAAU,SAAUpN,GAAK,OAAOA,GAAKA,EAAEL,OAASqJ,EAAKX,WAAarI,EAAEqN,QAAUrE,EAAKV,QAAU,IAClH+E,EAAQH,EAAaxO,GACrB6L,EAAM,CACN5K,KAAMqJ,EAAKX,UACXgF,MAAOrE,EAAKV,SACZ5J,MAAO8N,EACPtF,MAAO,IAAIxD,MAAMuJ,GAASvE,KAAK,OAE/B4E,GAAuB,IAAdd,IAAiC,IAAdC,EAC5BrF,EAAO,CACPc,QAASc,EAAKd,QACdvI,KAAMqJ,EAAKrJ,KACX0I,UAAWW,EAAKX,UAChBC,SAAUU,EAAKV,SACfL,YAAae,EAAKf,YAClBM,WAAYS,EAAKT,WACjBH,UAAWY,EAAKZ,UAChBmF,WAAuBrM,IAAf8H,EAAKuE,OAAsBvE,EAAKuE,OAAmBnB,GAAUA,EAAOjE,SAAS3J,QAAU,GAAK4N,EAAOmB,MAC3GnB,OAAQA,EACRI,SAAUA,EACVC,SAAUA,EACVO,MAAO,EACPC,QAAS,EACTO,KAAMxE,EAAKwE,MAAQ,GACnBnB,eAAgBrD,EAAKqD,gBAAkB,GACvClE,SAAUa,EAAKb,SAASxF,QAAO,SAAUgG,GAAK,OAAOA,EAAEP,YAAcY,EAAKZ,SAAW,KAEzF,GAAIkF,EACA,GAAID,EACAA,EAAMnG,MAAMuF,GAAYrF,EACpBiG,EAAM3O,OAAS8N,IACfA,EAAWa,EAAM3O,YAIrB,GAAIwO,EAAaV,IAAaU,EAAaV,GAAUtF,MAAM1I,OAAQ,CAC/D,IAAK,IAAIgB,EAAMgN,EAAUhN,EAAM0N,EAAa1O,OAAQgB,IAAO,CACtC0N,EAAa1N,GACnBd,OACf,CACAwO,EAAaO,OAAOjB,EAAU,EAAGjC,GACjC2C,EAAaV,GAAUtF,MAAMuF,GAAYrF,CAC7C,MAEI8F,EAAaV,GAAYjC,EACzB2C,EAAaV,GAAUtF,MAAMuF,GAAYrF,EAIrD,IAAIsG,EAAa,EAcjB,OAbI1E,EAAKb,UAAYa,EAAKb,SAAS3J,OAC/BwK,EAAKb,SAAS1J,SAAQ,SAAUa,GAC5B,IAAI6C,EAAKoK,EAASjN,EAAOkN,EAAW,EAAGC,EAAWiB,EAAYV,EAAOC,EAASC,EAAcC,EAAa/F,GAAOuG,EAAYxL,EAAG,GAAIyL,EAAWzL,EAAG,GAAI0L,EAAe1L,EAAG,GACvKuL,GAAeG,GAAgB,EAC/BX,EAAeS,EAAUvM,QACzB+L,EAAcS,EAASxM,OAC3B,IAEK4H,EAAKqD,iBACVc,EAAYV,GAAY,CAAEc,MAAOnG,EAAKmG,MAAOC,KAAMxE,EAAKqD,iBAE5DjF,EAAK4F,MAAQF,EACb1F,EAAK6F,QAAUF,EACR,CACHG,EACAC,EACAL,EACAC,EAER,EACIe,EAAY,SAAUvO,EAAM6M,EAAQ1N,GAGpC,IAAI0J,OAFW,IAAXgE,IAAqBA,EAAS,WACpB,IAAV1N,IAAoBA,EAAQ,GAGhC,IADA,IAAIqP,EAAM7J,EAAS,CAAC,EAAG3E,EAAM,CAAEgO,OAAO,EAAMtF,aAAa,EAAOE,SAAU,KACjE6F,EAAa,EAAGA,EAAazO,EAAK4I,SAAS3J,OAAQwP,IAAc,CACtE,IAAI1O,EAAQwO,EAAUvO,EAAK4I,SAAS6F,GAAazO,EAAMyO,GACvD5F,EAAYA,GAAa9I,EAAM8I,UAC3B9I,EAAM8I,YAAcA,IACjBgE,GACCA,EAAOjE,SAAS7H,MAAK,SAAUqI,GAAK,OAAOA,EAAE4E,OAAS5E,EAAEhJ,OAASoO,EAAIpO,IAAM,KAC3EJ,EAAKgO,QACTQ,EAAI5F,SAASvI,KAAKN,GAClBC,EAAK4I,SAASsF,OAAOO,EAAY,GACjCA,IAER,CACA,GAAIzO,EAAK4I,SAASxF,QAAO,SAAUgG,GAAK,OAAQA,EAAE4E,KAAO,IAAG/O,QAAU,GAC/D4N,IACCA,EAAOjE,SAAS7H,MAAK,SAAUqI,GAAK,OAAOA,EAAE4E,OAAS5E,EAAEhJ,OAASoO,EAAIpO,IAAM,MAC3EJ,EAAKgO,MAAO,CAChB,IAAIU,EAAiB1O,EAAK4I,SAAS,GAAGC,UAClC7I,EAAK6I,YAAc6F,GACnB7B,EAAOjE,SAASsF,OAAO/O,EAAQ,EAAG,EAAGqP,EAE7C,CACA,OAAOxO,CACX,EAiMA,SAAS2O,EAAKC,GACV,OAAOC,KAAKC,MAAMD,KAAKE,UAAUH,GACrC,CAOA,IAAII,EAAa,SAAU5O,EAAMqB,EAASyJ,GACtC,MAAO,CACHc,oBAAqB5L,EACrBgL,WAAY3J,EACZkH,QAASlH,EACTA,QAASA,EACTrB,KAAMqB,EACNyJ,KAAMA,EACN+D,KAAK,EAEb,EAIA,SAASC,EAAiBzF,GACtB,IAAIrJ,EAAOqJ,EAAKrJ,KAChB,MAAO,CACH4O,EAAW5O,EAAMqJ,EAAKhL,MAAO,SAC7BuQ,EAAW5O,EAAMqJ,EAAKgC,KAAM,QAC5BuD,EAAW5O,EAAMqJ,EAAKiC,OAAQ,UAC9BsD,EAAW5O,EAAMqJ,EAAKkC,MAAO,SAErC,CAIA,IAqBIwD,EAAuB,SAAUC,EAAGrL,GAAK,OAAOrF,OAAO0Q,EAAEhP,QAAU1B,OAAO,CAAEqF,EAAEoH,iBACxEpH,EAAEoH,iBACFpH,EAAEqH,YAAe,EAIvBiE,EAAc,SAAUD,EAAGrL,GAAK,OAAOrF,OAAO0Q,EAAEhP,QAAU1B,OAAOqF,EAAE3D,KAAO,EAI1EkP,EAAc,SAAU9H,EAAM+H,GAkB9B,IAjBA,IAAIC,EAAU,SAAUzK,GACpB,IAAIwD,EAAOf,EAAKzC,GACZ5F,EAAQoJ,EAAKnI,KAAKyN,WAAU,SAAUzN,GAAQ,OAAO+O,EAAqB,CAAE/O,KAAM,CAACA,IAASmP,IAAQ7Q,OAAO0B,GAAMqP,WAAWF,EAAInE,WAAa,IACjJ,IAAe,IAAXjM,EACA,GAAIA,IAAUoJ,EAAKnI,KAAKnB,OAAS,GAA0B,IAArBsJ,EAAKnI,KAAKnB,OAC5CuI,EAAK0G,OAAOnJ,EAAG,OAEd,CACDwD,EAAKnI,KAAK8N,OAAO/O,EAAO,GACxB,IAAIuQ,EAAsBlI,EAAKqG,WAAU,SAAU8B,GAAM,OAAOA,IAAOpH,GAAQ7J,OAAOiR,EAAGvP,QAAU1B,OAAO6J,EAAKnI,KAAO,KACzF,IAAzBsP,IACAlI,EAAKkI,GAAuB/K,EAAS,CAAC,EAAG6C,EAAKkI,GAAsBnH,EAAQf,EAAKkI,GAAqB/O,QAAU4H,EAAK5H,OAAU,CAAEA,QAAQ,GAAS,CAAC,GACnJ6G,EAAK0G,OAAOnJ,EAAG,GAEvB,CAER,EACSA,EAAIyC,EAAKvI,OAAS,EAAG8F,GAAK,EAAGA,IAClCyK,EAAQzK,EAEhB,EAII6K,EAAa,SAAUpI,EAAMqI,EAAUC,GACvC,IAAI3Q,GAAS,EACb,GAAI2Q,EAAMC,YAAcD,EAAME,cAAe,CACzC,IAAIC,EAASH,EAAME,cACY,WAAxBF,EAAME,cACH,EACA,EACJ,EACN7Q,EAAQqI,EAAKqG,WAAU,SAAUzE,GAAK,OAAOiG,EAAYjG,EAAG0G,EAAMC,WAAa,IAAKE,CACxF,EACe,IAAX9Q,GACAqI,EAAKtI,SAAQ,SAAUqJ,GACnB,IAAI3F,EACA2F,EAAK5H,QAAU4H,EAAKnI,KAAKnB,OAAS,GAAKsJ,EAAKnI,KAAKnB,OAASE,IACzDyD,EAAK2F,EAAKnI,MAAM8N,OAAOjJ,MAAMrC,EAAI,CAACzD,EAAO,GAAGyB,OAAOiP,EAASzP,MAErE,IACAoH,EAAK0G,OAAO/O,EAAO,EAAG0Q,IAGtBrI,EAAKnH,KAAKwP,EAElB,EAIIK,EAA2B,SAAU/H,GACrC,IAAIgI,EAAchI,EAAQlJ,QAAUkJ,EAAQ,GACxCiI,EAAaD,GAAeA,EAAY3Q,QAAQ2Q,EAAY3Q,QAAQP,OAAS,GACjF,GAAImR,GAAc/D,EAAU+D,GAAa,CAGrC,IAFA,IAAIC,EAAa,GACbC,EAAgB,IAAI9D,IAAIrE,EAAQP,KAAI,SAAU2I,GAAO,OAAOA,EAAI/Q,QAAQ+Q,EAAI/Q,QAAQP,OAAS,GAAG0J,OAAS,KAAI+D,KACxG3H,EAAI,EAAGA,EAAIoD,EAAQlJ,OAAQ8F,GAAKuL,EACrCD,EAAWhQ,KAAK8H,EAAQtG,MAAMkD,EAAGA,EAAIuL,IAEzC,IAAIE,EAAW,GAIf,OAHAH,EAAWnR,SAAQ,SAAUuR,GACzBD,EAASnQ,KAAK4E,MAAMuL,EAAUC,EAAIC,UACtC,IACOF,CACX,CACA,OAAOrI,CACX,EA2DA,IAgCIwI,GACJ,SAAWA,GACPA,EAAuB,OAAI,wBAC3BA,EAAuB,OAAI,wBAC3BA,EAAyB,SAAI,yBAChC,CAJD,CAIGA,IAAmBA,EAAiB,CAAC,IACxC,IA2DWC,EA3DPC,EAAW,SAAUpH,EAAMqH,EAASC,GACpC,IAAIrP,EAAS,IAAI8K,IAUjB,OATA/C,EAAKb,SAAS1J,SAAQ,SAAUa,GAC5B,IAAIiR,EAAQF,EAAQ/Q,GAChBgR,GACArP,EAAO+K,IAAI/N,OAAOqB,EAAMkO,OAE5B4C,EAAS9Q,EAAO+Q,EAAUC,GAAWC,GAAQpJ,KAAI,SAAUqJ,GACvDvP,EAAO+K,IAAIwE,EACf,GACJ,IACO9M,MAAMsD,KAAK/F,EAAO5C,SAC7B,EAIIoS,EAAiB,SAAUpB,EAAOqB,GAClC,OAAQA,EAAOjG,MACX,KAAKyF,EAAeS,OAChB,IAAIC,EAAWvB,EAAMwB,MAAK,SAAWxM,GAAK,OAAOpG,OAAOoG,EAAE1E,QAAU1B,OAAOyS,EAAOI,QAAW,IAC7F,OAAOL,EAAepB,EAAOnL,EAAS,CAAC,EAAGwM,EAAQ,CAAEjG,KAAMmG,GAAaA,EAAe,OAC5EV,EAAea,SACfb,EAAehQ,UAE7B,KAAKgQ,EAAehQ,OAChB,IAAI8Q,EAAa3B,EAAMwB,MAAK,SAAWxM,GAAK,OAAOpG,OAAOoG,EAAE1E,QAAU1B,OAAOyS,EAAOI,QAAW,IAC/F,GAAIE,IAAoC,IAAtBA,EAAW9Q,OACzB,OAAOmP,EAEN,IAAI2B,IAAqC,IAAtBA,EAAW9Q,aAA0CgB,IAAtB8P,EAAW9Q,OAG7D,CACD,IAAI+Q,EAAY5B,EAAMjO,QAEtB,OADA6P,EAAUrR,KAAK,CAAED,KAAM+Q,EAAOI,QAAS5Q,QAAQ,IACxC+Q,CACX,CANI,OAAO5B,EAAMlI,KAAI,SAAU9C,GAAK,OAAOA,IAAM2M,EAAc9M,EAAS,CAAC,EAAG8M,EAAY,CAAE9Q,QAAQ,IAAWmE,CAAG,IAQpH,KAAK6L,EAAea,SAChB,IAAIG,EAAad,EAASM,EAAOS,MAAM,SAAUnI,GAAQ,OAAQA,EAAKuE,OAAStP,OAAO+K,EAAKwE,QAAUvP,OAAOyS,EAAOI,QAAU,IAQ7H,OAPezB,EAAMjO,QAChBuB,QAAO,SAAU6N,GAAK,OAAQU,EAAW5Q,MAAK,SAAUoF,GAAK,OAAOA,IAAMzH,OAAOuS,EAAE7Q,KAAO,GAAI,IAC9FwH,KAAI,SAAUqJ,GAAK,OAAQtM,EAAS,CAAC,EAAGsM,EAAG,CAAEtQ,OAAQoM,QAAQkE,EAAEtQ,SAAa,IAC5EiH,KAAI,SAAUqJ,GAAK,OAAQvS,OAAOuS,EAAE7Q,QAAU1B,OAAOyS,EAAOI,SAC3DJ,EAAOI,QAAQtS,OAAS,OAAI0C,EAAY,CAAEvB,KAAM+Q,EAAOI,QAAS5Q,QAAQ,GACxEsQ,CAAG,IACJ7N,OAAO2J,SAGhB,QACI,OAAO+C,EAGnB,EAKA7S,EAAQ4U,OAAI,GACDjB,EA8BR3T,EAAQ4U,IAAM5U,EAAQ4U,EAAI,CAAC,IA5BiB,gBAAI,6CAC/CjB,EAAyC,cAAI,4CAC7CA,EAAyC,cAAI,4CAC7CA,EAA4C,iBAAI,+CAChDA,EAA4C,iBAAI,+CAChDA,EAAsC,WAAI,yCAC1CA,EAAsC,WAAI,yCAC1CA,EAAyC,cAAI,4CAC7CA,EAAyC,cAAI,4CAC7CA,EAA0C,eAAI,6CAC9CA,EAA0C,eAAI,6CAC9CA,EAA6C,kBAAI,gDACjDA,EAA6C,kBAAI,gDAEjDA,EAAkC,OAAI,mCAEtCA,EAAmC,QAAI,qCAEvCA,EAAqC,UAAI,uCACzCA,EAAqC,UAAI,uCACzCA,EAAwC,aAAI,0CAC5CA,EAAwC,aAAI,0CAE5CA,EAAuC,YAAI,yCAC3CA,EAAgC,KAAI,iCACpCA,EAAuC,YAAI,0CAC3CA,EAAyC,cAAI,4CAC7CA,EAA4C,iBAAI,+CAKpD,IAAIkB,EAAsB,SAAUhC,EAAOqB,GACvC,IAAIY,EACAC,EACAC,EACAC,EACAC,EACAC,EACAC,EACAC,EACAC,EACJ,OAAQpB,EAAOjG,MACX,KAAKjO,EAAQ4U,EAAEW,gBACX,IAAIrO,MAAMsO,QAAQtB,EAAOI,SAGpB,CACD,IAAImB,EAAYvB,EAAOI,QACvB,GAAuB,IAAnBmB,EAAUxH,MAAc,eAAgBwH,EACxC,OAAI5C,EAAM7M,YAAYlC,MAAK,SAAU+D,GAAK,OAAOqK,EAAqBrK,EAAG4N,EAAY,IAC1EZ,EAAoBhC,EAAOnL,EAAS,CAAC,EAAGwM,EAAQ,CAAEjG,KAAMjO,EAAQ4U,EAAEc,qBAGlEb,EAAoBhC,EAAOnL,EAAS,CAAC,EAAGwM,EAAQ,CAAEjG,KAAMjO,EAAQ4U,EAAEe,kBAG5E,GAAuB,QAAnBF,EAAUxH,KAAgB,CAC/B,IAAIzL,EAAWyP,EAAiBwD,GAChC,OAAIjT,EAASoT,OAAM,SAAUC,GAAK,OAAOhD,EAAM7M,YAAYlC,MAAK,SAAU+D,GAAK,OAAOqK,EAAqBrK,EAAGgO,EAAI,GAAI,IAC3GhB,EAAoBhC,EAAOnL,EAAS,CAAC,EAAGwM,EAAQ,CAAEjG,KAAMjO,EAAQ4U,EAAEkB,kBAAmBxB,QAAS9R,KAG9FqS,EAAoBhC,EAAOnL,EAAS,CAAC,EAAGwM,EAAQ,CAAEjG,KAAMjO,EAAQ4U,EAAEmB,eAAgBzB,QAAS9R,EAAS2D,QAAO,SAAU0P,GAAK,OAAQhD,EAAM7M,YAAYlC,MAAK,SAAU+D,GAAK,OAAOqK,EAAqBrK,EAAGgO,EAAI,GAAI,MAE9N,CACK,OAAI3B,EAAOI,QAAQtC,IAChBa,EAAM7M,YAAYlC,MAAK,SAAU+D,GAAK,OAAOqK,EAAqBrK,EAAG4N,EAAY,IAC1EZ,EAAoBhC,EAAOnL,EAAS,CAAC,EAAGwM,EAAQ,CAAEjG,KAAMjO,EAAQ4U,EAAEc,qBAGlEb,EAAoBhC,EAAOnL,EAAS,CAAC,EAAGwM,EAAQ,CAAEjG,KAAMjO,EAAQ4U,EAAEe,kBAIzE9C,EAAMjN,WAAW9B,MAAK,SAAU+D,GAAK,OAAOqK,EAAqBrK,EAAG4N,EAAY,IACzEZ,EAAoBhC,EAAOnL,EAAS,CAAC,EAAGwM,EAAQ,CAAEjG,KAAMjO,EAAQ4U,EAAEoB,oBAEpEnD,EAAM/M,QAAQhC,MAAK,SAAU+D,GAAK,OAAOqK,EAAqBrK,EAAG4N,EAAY,IAC3EZ,EAAoBhC,EAAOnL,EAAS,CAAC,EAAGwM,EAAQ,CAAEjG,KAAMjO,EAAQ4U,EAAEqB,kBAEnEpD,EAAMjN,aAAciN,EAAMjN,WAAW5D,QAAa6Q,EAAM/M,SAAY+M,EAAM/M,QAAQ9D,OAIjF6S,EAAoBhC,EAAOnL,EAAS,CAAC,EAAGwM,EAAQ,CAAEjG,KAAMjO,EAAQ4U,EAAEsB,iBAHlErB,EAAoBhC,EAAOnL,EAAS,CAAC,EAAGwM,EAAQ,CAAEjG,KAAMjO,EAAQ4U,EAAEuB,aAMrF,CACA,MAEJ,KAAKnW,EAAQ4U,EAAEsB,cACXnB,GAAclC,EAAMjN,YAAc,IAAIjC,OAAO,CACzC,CAAER,KAAM,CAAC+Q,EAAOI,QAAQpG,kBAAoBgG,EAAOI,QAAQnG,eAE/D,MAEJ,KAAKnO,EAAQ4U,EAAEwB,cAEX,MAEJ,KAAKpW,EAAQ4U,EAAEoB,iBACXjB,GAAclC,EAAMjN,YAAc,IAAIO,QAAO,SAAU0B,GAAK,OAAQqK,EAAqBrK,EAAGqM,EAAOI,QAAU,IAAG1P,QAChHyN,EAAY0C,EAAYb,EAAOI,SAC/B,MAEJ,KAAKtU,EAAQ4U,EAAEyB,iBAEX,MAEJ,KAAKrW,EAAQ4U,EAAEuB,WACXrB,GAAWjC,EAAM/M,SAAW,IAAInC,OAAO,CACnC,CAAER,KAAM,CAAC+Q,EAAOI,QAAQpG,kBAAoBgG,EAAOI,QAAQnG,eAE/D,MAEJ,KAAKnO,EAAQ4U,EAAE0B,WAEX,MAEJ,KAAKtW,EAAQ4U,EAAEqB,cACXnB,GAAWjC,EAAM/M,SAAW,IAAIK,QAAO,SAAU0B,GAAK,OAAQqK,EAAqBrK,EAAGqM,EAAOI,QAAU,IAAG1P,QAC1GyN,EAAYyC,EAASZ,EAAOI,SAC5B,MAEJ,KAAKtU,EAAQ4U,EAAE2B,cAEX,MAEJ,KAAKvW,EAAQ4U,EAAEe,eACXX,GAAenC,EAAM7M,aAAe,IAAIrC,OAAO,CAC3C,CAAER,KAAM,CAAC+Q,EAAOI,QAAQpG,kBAAoBgG,EAAOI,QAAQnG,eAE/D,MAEJ,KAAKnO,EAAQ4U,EAAEc,kBACXV,GAAenC,EAAM7M,aAAe,IAAIG,QAAO,SAAU0B,GAAK,OAAQqK,EAAqBrK,EAAGqM,EAAOI,QAAU,IAAG1P,QAClH,MAEJ,KAAK5E,EAAQ4U,EAAEmB,eACXf,GAAenC,EAAM7M,aAAe,IAAIrC,QAAQuQ,EAAOI,SAAW,IAAI3J,KAAI,SAAUxD,GAAK,MAAO,CAAGhE,KAAM,CAACgE,EAAE+G,kBAAoB/G,EAAEgH,YAAgB,KAClJ,MAEJ,KAAKnO,EAAQ4U,EAAEkB,kBACXd,GAAenC,EAAM7M,aAAe,IAAIG,QAAO,SAAU0B,GAAK,OAAQqM,EAAOI,QAAQxQ,MAAK,SAAUqD,GAAK,OAAO+K,EAAqBrK,EAAGV,EAAI,GAAI,IAAGvC,QACnJ,MAEJ,KAAK5E,EAAQ4U,EAAE4B,OACP3D,EAAMjN,WAAW9B,MAAK,SAAU+D,GAAK,OAAOuK,EAAYvK,EAAGqM,EAAOI,QAAU,MAC5ES,EAAalC,EAAMjN,WAAWO,QAAO,SAAU0B,GAAK,OAAQuK,EAAYvK,EAAGqM,EAAOI,QAAU,IAAG1P,QAC/FyN,EAAY0C,EAAY,CAAE5G,WAAY+F,EAAOI,QAAQnR,QAErD0P,EAAM/M,QAAQhC,MAAK,SAAU+D,GAAK,OAAOuK,EAAYvK,EAAGqM,EAAOI,QAAU,MACzEQ,EAAUjC,EAAM/M,QAAQK,QAAO,SAAU0B,GAAK,OAAQuK,EAAYvK,EAAGqM,EAAOI,QAAU,IAAG1P,QACzFyN,EAAYyC,EAAS,CAAE3G,WAAY+F,EAAOI,QAAQnR,QAElD0P,EAAM7M,YAAYlC,MAAK,SAAU+D,GAAK,OAAOuK,EAAYvK,EAAGqM,EAAOI,QAAU,MAC7EU,EAAcnC,EAAM7M,YAAYG,QAAO,SAAU0B,GAAK,OAAQuK,EAAYvK,EAAGqM,EAAOI,QAAU,IAAG1P,SAErG,MAEJ,KAAK5E,EAAQ4U,EAAE6B,YACXtB,EAAcjB,EAAOI,QACrB,MACJ,KAAKtU,EAAQ4U,EAAE8B,YACXtB,EAAclB,EAAOI,QACrB,MACJ,KAAKtU,EAAQ4U,EAAE+B,cACXrB,EAAgBpB,EAAOI,QACvB,MACJ,KAAKtU,EAAQ4U,EAAEgC,iBACXvB,EAAmBnB,EAAOI,QAC1B,MACJ,KAAKtU,EAAQ4U,EAAEiC,KACX,GAAIhE,EAAMiE,UAAYjE,EAAMkE,SAAU,CAClC,IAAIC,EAAgBnE,EAAMjN,WAAWyO,MAAK,SAAUxM,GAAK,OAAOuK,EAAYvK,EAAGqM,EAAOI,QAAU,IAC5F2C,EAAapE,EAAM/M,QAAQuO,MAAK,SAAUxM,GAAK,OAAOuK,EAAYvK,EAAGqM,EAAOI,QAAU,IACtF4C,EAAiBrE,EAAM7M,YAAYqO,MAAK,SAAUxM,GAAK,OAAOuK,EAAYvK,EAAGqM,EAAOI,QAAU,IAC9F9N,OAAU,EAed,OAdIwQ,IACAxQ,EAAUwQ,EACVjC,EAAalC,EAAMjN,WAAWO,QAAO,SAAU0B,GAAK,OAAQuK,EAAYvK,EAAGqM,EAAOI,QAAU,IAAG1P,QAC/FyN,EAAY0C,EAAY,CAAE5G,WAAY+F,EAAOI,QAAQnR,QAErD8T,IACAzQ,EAAUyQ,EACVnC,EAAUjC,EAAM/M,QAAQK,QAAO,SAAU0B,GAAK,OAAQuK,EAAYvK,EAAGqM,EAAOI,QAAU,IAAG1P,QACzFyN,EAAYyC,EAAS,CAAE3G,WAAY+F,EAAOI,QAAQnR,QAElD+T,IACA1Q,EAAU0Q,EACVlC,EAAcnC,EAAM7M,YAAYG,QAAO,SAAU0B,GAAK,OAAQuK,EAAYvK,EAAGqM,EAAOI,QAAU,IAAG1P,SAE7FiO,EAAMkE,UACV,IAAK,aACDhC,EAAaA,GAAclC,EAAMjN,WAAWhB,QAC5C+N,EAAWoC,EAAYvO,EAASqM,GAChC,MAEJ,IAAK,UACDiC,EAAUA,GAAWjC,EAAM/M,QAAQlB,QACnC+N,EAAWmC,EAAStO,EAASqM,GAC7B,MAEJ,IAAK,cACDmC,EAAcA,GAAenC,EAAM7M,YAAYpB,QAC/C+N,EAAWqC,EAAaxO,EAASqM,GAM7C,CACAsC,EAAc,KACdC,EAAc,KACdE,EAAgB,KAChB,MACJ,KAAKtV,EAAQ4U,EAAEuC,QACXlC,EAAUf,EAAOI,QACjB,MACJ,KAAKtU,EAAQ4U,EAAEwC,UAEPlC,EADAhO,MAAMsO,QAAQtB,EAAOI,SACTJ,EAAOI,QAGP,CAACJ,EAAOI,SAExB,MACJ,KAAKtU,EAAQ4U,EAAEyC,UACXnC,GAAarC,EAAM1M,QAAU,IAAIvB,QAC7BsC,MAAMsO,QAAQtB,EAAOI,SACrBY,EAAU9R,KAAK4E,MAAMkN,EAAWhB,EAAOI,SAGvCY,EAAU9R,KAAK8Q,EAAOI,SAE1B,MACJ,KAAKtU,EAAQ4U,EAAE0C,aACXpC,EAAahO,MAAMsO,QAAQtB,EAAOI,UAC3BzB,EAAM1M,QAAU,IAAIwE,KAAI,SAAUzB,GAAK,OAAOgL,EAAOI,QAAQxQ,MAAK,SAAUqO,GAAK,OAAOA,EAAEzQ,QAAUwH,EAAExH,KAAO,IAC1GwS,EAAOI,QAAQD,MAAK,SAAUlC,GAAK,OAAOA,EAAEzQ,QAAUwH,EAAExH,KAAO,IAC/DwH,CAAG,KACN2J,EAAM1M,QAAU,IAAIwE,KAAI,SAAUzB,GAAK,OAAOA,EAAExH,QAAUwS,EAAOI,QAAQ5S,MACtEwS,EAAOI,QACPpL,CAAG,IACb,MACJ,KAAKlJ,EAAQ4U,EAAE2C,aACXrC,GAAarC,EAAM1M,QAAU,IAAIvB,QAE7BsQ,EADAhO,MAAMsO,QAAQtB,EAAOI,SACTY,EAAU/O,QAAO,SAAU+C,GAAK,OAAQgL,EAAOI,QAAQxQ,MAAK,SAAUqD,GAAK,OAAOA,EAAEzF,QAAUwH,EAAExH,OACxGyF,EAAExF,WAAauH,EAAEvH,QAAU,GAAI,IAGvBuT,EAAU/O,QAAO,SAAU+C,GAAK,QAASA,EAAExH,QAAUwS,EAAOI,QAAQ5S,OACzEwH,EAAEvH,WAAauS,EAAOI,QAAQ3S,SAAW,IAM5D,MAAO,CACHmV,SAAU3B,EACVrC,WAAYwC,EACZvC,cAAesC,EACf0B,SAAU3B,EACVxP,WAAYmP,EACZjP,QAASgP,EACT9O,YAAagP,EACb7O,OAAQ+O,EACRzS,KAAMwS,EAEd,EA0CIuC,EAAe,CACfC,KAAM,SAAUpM,GACP,QAASA,IAAU,IACpBA,EAAKqM,IAAMC,OAAOC,kBAE1B,EACAC,MAAO,SAAUC,EAAKC,GAClBA,EAAKL,IAAMM,KAAKN,IAAII,EAAIJ,IAAKK,EAAKL,IACtC,EACAO,WAAY,SAAUC,EAAK1W,GACvB0W,EAAIR,IAAMM,KAAKN,IAAIlW,EAAO0W,EAAIR,IAClC,EACAjT,OAAQ,SAAU4G,GAAQ,OAAOsM,OAAOQ,SAAS9M,EAAKqM,KAAOrM,EAAKqM,IAAMU,GAAK,EAC7EC,OAAQ,SAAU7W,GAAS,OAAOA,EAAM8W,QAAQ,EAAI,GAKpDC,EAAe,CACfd,KAAM,SAAUpM,GACP,QAASA,IAAU,IACpBA,EAAKmN,IAAMb,OAAOc,kBAE1B,EACAZ,MAAO,SAAUC,EAAKC,GAClBA,EAAKS,IAAMR,KAAKQ,IAAIV,EAAIU,IAAKT,EAAKS,IACtC,EACAP,WAAY,SAAUC,EAAK1W,GACvB0W,EAAIM,IAAMR,KAAKQ,IAAIhX,EAAO0W,EAAIM,IAClC,EACA/T,OAAQ,SAAU4G,GAAQ,OAAOsM,OAAOQ,SAAS9M,EAAKmN,KAAOnN,EAAKmN,IAAMJ,GAAK,EAC7EC,OAAQ,SAAU7W,GAAS,OAAOA,EAAM8W,QAAQ,EAAI,GAwBxD,SAASI,EAAYC,EAAMC,GACnB,YAAaD,EACbA,EAAKrS,QAAQqE,KAAI,SAAU7H,GAAS,OAAO4V,EAAY5V,EAAO8V,EAAa,IAG3EA,EAAWD,EAEnB,CACA,IAAIE,EAAe,SAAU1S,EAAQ2S,IACf5R,MAAMsO,QAAQrP,GAAUA,EAASA,EAAOG,SAC9CrE,SAAQ,SAAU0W,GAAQ,OAAOD,EAAYC,EAAMG,EAAW,GAC9E,EA2BIC,EAAU,SAAUvM,EAAM9K,EAAOsX,GACjC,IAAIC,EAAYzM,EAAK0M,IAAIxX,GAKzB,OAJKuX,IACDA,EAAYD,GAAe,IAAIG,IAC/B3M,EAAK8C,IAAI5N,EAAOuX,IAEbA,CACX,EAKIG,EAAgB,SAAUC,GAC1B,IAAIC,EAAiBD,EAAS5V,QALlB,KAMZ,OAAwB,IAApB6V,EAGO,CAFGD,EAASE,UAAU,EAAGD,GACpBD,EAASE,UAAUD,EAAiB,IAIzC,CAACD,OAAU3U,EAE1B,EAEI8U,EAAsB,SAAUhN,EAAMhK,EAAUiX,GAChDjN,EAAKvK,SAAQ,SAAUgX,EAAWS,GAC9B,GAAIA,IAAMD,EAAW,CACbR,EAAUxJ,KAAO,GACjB+J,EAAoBP,EAAWzW,EAAUiX,GAE7C,IAAIE,EAAcV,EAAUC,IAAIO,GAC5BG,EAAeb,EAAQvM,EAAMiN,EAAW,CAAC,GAC7CjX,EAASP,SAAQ,SAAU4T,GACvBA,EAAEgE,UAAUpC,KAAKmC,GACjB/D,EAAEgE,UAAUhC,MAAM8B,EAAaC,EACnC,GACJ,CACJ,GACJ,EAEIE,EAAa,SAAUhC,EAAKC,EAAMvV,EAAUiX,GAC5C3B,EAAI7V,SAAQ,SAAU8X,EAAUL,GAC5B,IAAIM,EACAN,IAAMD,GACNO,EAAYjB,EAAQhB,EAAM2B,GAC1BI,EAAWC,EAAUC,EAAWxX,EAAUiX,KAG1CO,EAAYjB,EAAQhB,EAAM2B,EAAG,CAAC,GAC9BlX,EAASP,SAAQ,SAAU4T,GACvBA,EAAEgE,UAAUpC,KAAKuC,GACjBnE,EAAEgE,UAAUhC,MAAMkC,EAAUC,EAChC,IAER,GACJ,EACIC,GAAmB,SAAUzN,EAAMhK,EAAU0X,EAAaT,GAC1DjN,EAAKvK,SAAQ,SAAUgX,EAAWS,GAC9B,GAAIA,IAAMQ,EAAa,CACfjB,EAAUxJ,KAAO,GACjBwK,GAAiBhB,EAAWzW,EAAU0X,EAAaT,GAEvD,IAAIU,EAAapB,EAAQE,EAAWiB,GAChCE,EAAcrB,EAAQvM,EAAM0N,GAChCJ,EAAWK,EAAYC,EAAa5X,EAAUiX,EAClD,CACJ,GACJ,EAoDIY,GAAa,SAAUlX,EAAMoH,EAAMyG,GACnC,IAAIrL,EAAKyT,EAAcjW,GAAOwK,EAAMhI,EAAG,GAAInE,EAAQmE,EAAG,GAClDlB,EAASuM,EAAKpM,QAClB,GAAI+I,GAAOnM,EAAO,CACd,IAAI8J,EAAOf,EAAK8J,MAAK,SAAUlC,GAAK,OAAOA,EAAExE,MAAQA,CAAK,IACtD2M,EAAYhP,EAAOA,EAAKI,QAAU,GACtC,OAAOjH,EAAOkG,KAAI,SAAUxD,GAAK,OAAOA,IAAMmT,EAAYnX,EAAOgE,CAAG,GACxE,CACA,OAAO1C,CACX,EACI8V,GAAc,SAAU5F,EAAMpS,EAASb,EAAO8Y,EAAchY,EAAUiX,EAAWgB,GAGjF,IAFA,IAAIC,EAAYD,GAAS,IAAItB,IACzBnI,EAAOwJ,EAAa7P,KAAI,SAAUwH,GAAK,OAAOA,EAAEzG,OAAS,IACtDnJ,EAAQP,OAAS,GAAKwY,EAAa1W,MAAK,SAAUqO,GAAK,OAAOA,EAAEzG,UAAYnJ,EAAQA,EAAQP,OAAS,GAAG0J,OAAS,KACpHnJ,EAAQgD,MACRyL,EAAKzL,MAET,IAAIiH,EAAOmI,EA4CX,OA3CApS,EAAQN,SAAQ,SAAU4T,EAAG/N,GAEzB,GADAkJ,EAAOqJ,GAAWxE,EAAE1S,KAAMqX,EAAcxJ,GACpCxE,IAASgO,EAAa1W,MAAK,SAAUqO,GAAK,OAAOA,EAAEzG,UAAYmK,EAAE1S,IAAM,IAAI,CAC3E,IAAKqJ,EAAKmO,IAAI9E,EAAE1S,QAAUuX,EAAUC,IAAI3J,EAAKpM,MAAM,EAAGoM,EAAKvN,QAAQoS,EAAE1S,MAAQ,GAAGmB,KAAK,MAiCjF,IAhCA,IAAIsW,EAAe1T,MAAMsD,KAAKgC,GAAM6H,MAAK,SAAUtQ,GAAK,OAAOA,EAAE,KAAOrC,CAAO,IAC3EmZ,EAAmBD,GAAgBA,EAAa,GAChDE,EAAeD,GAAoBzB,EAAcyB,GAAkB,GACnErK,EAAQsK,EAAehT,EAAI0S,EAAa5J,WAAU,SAAUuB,GAAK,OAAOA,EAAExE,MAAQmN,CAAc,IAAK,EACrGC,EAAU,SAAUnT,GACpB,IAAIyD,EAAO,GACXmB,EAAKvK,SAAQ,SAAUT,EAAOmM,GACtBA,IAAQjM,GACR2J,EAAKjI,KAAK4E,MAAMqD,EAAMnE,MAAMsD,KAAKhJ,GAAO2E,QAAO,SAAUU,GAAK,OAAOA,EAAE,KAAOnF,CAAO,IAE7F,IACA,IAAIiH,EAAO,IAAIwQ,IACf9N,EAAKpJ,SAAQ,SAAU+Y,GACnB,GAAIrS,EAAKgS,IAAIK,EAAK,IAAK,CACnB,IAAIjD,EAAOpP,EAAKuQ,IAAI8B,EAAK,IACrBlD,EAAMkD,EAAK,GACXC,EAAU,IAAI9B,IAClBW,EAAW/B,EAAMkD,EAASzY,EAAUiX,GACpCK,EAAWhC,EAAKmD,EAASzY,EAAUiX,GACnC9Q,EAAK2G,IAAI0L,EAAK,GAAIC,EACtB,MAEItS,EAAK2G,IAAI0L,EAAK,GAAI,IAAI7B,IAAI6B,EAAK,IAEvC,IACA,IAAIE,EAAclK,EAAKpM,MAAM,EAAGoM,EAAKvN,QAAQoS,EAAE1S,OAC/CwF,EAAK1G,SAAQ,SAAUT,EAAOmM,GAC1B+M,EAAUpL,IAAI+K,GAAW1M,EAAK6M,EAAcU,EAAYvX,OAAO,CAACgK,KAAOrJ,KAAK,KAAM9C,EACtF,IACAmH,EAAK2G,IAAI5N,EAAO8K,EAAK0M,IAAIxX,IACzB8K,EAAO7D,CACX,EACSf,EAAI,EAAGA,EAAI4I,EAAO5I,IACvBmT,IAGRvO,EAAOA,EAAK0M,IAAIrD,EAAE1S,OAASuX,EAAUxB,IAAIlI,EAAKpM,MAAM,EAAGoM,EAAKvN,QAAQoS,EAAE1S,MAAQ,GAAGmB,KAAK,KAC1F,CACJ,IACOkI,CACX,EAEI2O,GAAW,SAAUC,EAAUC,EAAWC,EAAcC,EAAQC,EAAgBC,EAAajZ,GAC7F,IAAI6I,EAAO,GACPoO,EAAY8B,EAAO9B,UAAWS,EAAcqB,EAAOrB,YACnDwB,EAAY,IAAIvC,IAyBpB,OAxBAkC,EAAUpZ,SAAQ,SAAU8L,GACxB,IAAI4N,EAAUpB,GAAYa,EAAUrN,EAAIxL,QAAQqC,QAASsV,EAAauB,EAAajZ,EAAUiX,EAAWiC,GACpGE,EAAiBD,GAAWA,EAAQzC,IAAIgB,GAC5CoB,EAAarZ,SAAQ,SAAUqR,GAC3B,IAAI/Q,EAAU+Q,EAAI/Q,QAAQqC,QACtBJ,EAAUhC,EAAS,GACvB,GAA8C,+BAA1CD,EAAQA,EAAQP,OAAS,GAAG6J,UAA4C,CACxE,IAAIgQ,EAAmBtZ,EAAQgD,MAC/Bf,EAAUhC,EAAS6R,MAAK,SAAUwB,GAAK,OAAOpU,OAAOoU,EAAE1S,QAAU0Y,EAAiBnQ,OAAS,KAAMlH,CACrG,CACA,IAAIsX,EAAUF,GAAkBrB,GAAYqB,EAAgBrZ,EAASkX,EAAW+B,EAAgBhZ,EAAUiX,GACtGjY,EAAQ,GAAIqJ,EAAW,GAC3B,GAAIiR,GAAWtX,EAAS,CACpB,IAAIC,EAASD,EAAQqV,UAAUpV,OAAOqX,EAAQ5C,IAAIO,IAClDjY,EAAQC,OAAOgD,GACfoG,EAAWrG,EAAQqV,UAAUxB,OAAO5T,EACxC,CACA4G,EAAKjI,KAAK,CACNmJ,YAAa+G,EACbjI,KAAM,CAAER,SAAUA,EAAUE,QARS,EAQSvJ,MAAOA,GACrD6K,SAAU0B,GAElB,GACJ,IACO1C,CACX,EAmCI0Q,GAAY,SAAUjE,EAAKC,EAAMiE,GACjClE,EAAI7V,SAAQ,SAAU8X,EAAUL,GAC5B,IAAKsC,EAAQtC,GAAI,CACb,IAAIM,EAAYjB,EAAQhB,EAAM2B,GAC9BqC,GAAUhC,EAAUC,EAAWgC,EACnC,CACJ,GACJ,EA6CIC,GAAa,SAAUC,GACvB,IAAIX,EAAS,IAAIhM,IAMjB,OALA2M,EAAYja,SAAQ,SAAU+Y,GACD,IAArBA,EAAK7X,KAAKnB,QAAiBoX,EAAc4B,EAAK7X,KAAK,IAAI,IACvDoY,EAAO/L,IAAIwL,EAAK7X,KAAK,GAE7B,IACOoY,CACX,EAEIY,GAAe,SAAUC,EAAcF,EAAad,EAAUiB,EAAiBC,GAC/E,IAAIC,EAAeN,GAAWC,GAC1BM,EAAc,GACdC,EAlGiB,SAAUF,EAAcH,GAC7C,IAAIM,EAAW,CAAEna,QAAS,IAgB1B,OAfAga,EAAata,SAAQ,SAAU0a,GAC3B,IAAIrR,EAAO8Q,EAAa/H,MAAK,SAAUlC,GAAK,OAAOA,EAAExE,MAAQgP,CAAU,IACnEjR,EAAUJ,EAAOA,EAAKI,QAAU,GAChCzI,EAAS,CACTyI,QAASA,EACTC,SAAU,GACVF,aAAa,EACbM,WAAY,GACZD,SAAU,EACVD,UAAWH,EACXE,UAAW+Q,EACXxZ,KAAMuI,GAEVgR,EAASna,QAAQa,KAAKH,EAC1B,IACOyZ,CACX,CAgFmBE,CAAmBL,EAAcH,GAChDI,EAAYpZ,KAAKqZ,GA4FjB,IA3FA,IAAIlK,EAAU,SAAUzK,GACpB,IAAI+U,EAAUX,EAAYpU,GAC1B,GAA4B,IAAxB+U,EAAQ1Z,KAAKnB,SAAiB6a,EAAQnZ,QAAU6Y,EAAa5B,IAAIkC,EAAQ1Z,KAAK,IAC9E,MAAO,WAEX,IAII2Z,EAJAC,EAAY,IAAIxN,IAAIgN,EAAaS,QACjCC,EAAiB,GACjBD,EAAO,GACP7R,EAAS,GAEb0R,EAAQ1Z,KAAKlB,SAAQ,SAAUib,EAAShb,GACpC,IAAIyD,EACAE,EAAKuT,EAAc8D,GAAUxb,EAAQmE,EAAG,GAAIrE,EAAQqE,EAAG,GAE3D,GADAiX,EAAMV,EAAa/H,MAAK,SAAUlC,GAAK,OAAOA,EAAExE,MAAQjM,CAAO,IAC3DF,EAAO,CACPub,EAAUI,OAAOzb,GACjBsb,EAAK5Z,KAAK8Z,GACV,IAAIja,EAAS,CACT0I,SAAU,GACVD,QAASlK,EACToK,UAAWlK,EACXoK,SAAU,EACVD,UAAWnK,EAAQ,IAAMA,EACzByB,KAAM+Z,EACNnR,WAAY+Q,EAAMA,EAAIpR,QAAU,IAEpCuR,EAAe7Z,KAAKH,EACxB,MACK,GAAI4Z,EAAQnZ,QAAUmZ,EAAQ1Z,KAAKnB,OAAS,IAAME,EAAO,CAC1D6a,EAAUI,OAAOD,GACjBF,EAAK5Z,KAAK8Z,GACV,IAAIvR,EA1FC,SAAUyP,EAAU4B,EAAMhB,GAsC3C,IArCA,IAGIrT,EAHAlE,EAAS,GACT2Y,EAAW,SAAU5Q,GAAQ,OAAOtF,MAAMsD,KAAKgC,GAAMrG,QAAO,SAAUpC,GAAK,OAAQiY,EAAQjY,EAAE,GAAK,GAAI,EACtGmZ,EAAU,IAAI/D,IAAIiC,GAElBL,EAAU,SAAUjT,GAEpB,GADAa,EAAOuU,EAAQhE,IAAI8D,EAAKlV,IAEpBoV,EAAU,IAAI/D,IAAIxQ,QAEjB,GAAIb,EAAIkV,EAAKhb,OAAS,GAAKkF,MAAMsD,KAAK0S,GAASpZ,MAAK,SAAU8E,GAAK,OAAOwQ,EAAcxQ,EAAE,IAAI,KAAOoU,EAAKlV,EAAI,IAAI,CACnH,IAAIuV,EAAa,GACjBH,EAAQjb,SAAQ,SAAUa,EAAO6K,GACxBqO,EAAQrO,IACT0P,EAAWja,KAAK4E,MAAMqV,EAAYD,EAAS,IAAIjE,IAAIrW,IAE3D,IACAoa,EAAU,IAAI/D,IACdkE,EAAWpb,SAAQ,SAAU+Y,GACzB,GAAIkC,EAAQvC,IAAIK,EAAK,IAAK,CACtB,IAAIjD,EAAOmF,EAAQhE,IAAI8B,EAAK,IACxBlD,EAAMkD,EAAK,GACXC,EAAU,IAAI9B,IAClB4C,GAAUhE,EAAMkD,EAASe,GACzBD,GAAUjE,EAAKmD,EAASe,GACxBkB,EAAQ5N,IAAI0L,EAAK,GAAIC,EACzB,MAEIiC,EAAQ5N,IAAI0L,EAAK,GAAI,IAAI7B,IAAI6B,EAAK,IAE1C,GACJ,MACe,IAANlT,GAAWA,IAAMkV,EAAKhb,OAAS,GAChCkF,MAAMsD,KAAK0S,GAASpZ,MAAK,SAAU8E,GAAK,OAAOwQ,EAAcxQ,EAAE,IAAI,KAAOoU,EAAKlV,EAAI,KACnFrD,EAAOrB,KAAK4E,MAAMvD,EAAQ2Y,EAASF,GAG/C,EACSpV,EAAI,EAAGA,EAAIkV,EAAKhb,OAAQ8F,IAC7BiT,EAAQjT,GAEZ,OAAOrD,CACX,CAgD+B6Y,CAAelC,EAAU4B,EAAMV,GAC1CiB,EAAalB,EAAgBhI,MAAK,SAAUsE,GAAQ,OAAOA,EAAKjX,QAAUA,CAAO,IACjF6b,GAAcA,EAAWnY,KACzBuG,EAASlJ,KAnHd,SAAU8a,EAAYT,GACjC,OAAO,SAAU3K,EAAGrL,GAChB,IAAI0W,EAAQD,EAAWnY,IACnBqY,EAAYX,EAAIY,UAAUtE,EAAcjH,EAAE,IAAI,IAC9CwL,EAAYb,EAAIY,UAAUtE,EAActS,EAAE,IAAI,IAClD,OAAI2W,EAAYE,EACK,QAAVH,GAAmB,EAAI,EAE9BC,EAAYE,EACK,QAAVH,EAAkB,GAAK,EAE3B,CACX,CACJ,CAsGkCI,CAASL,EAAYT,IAEvC,IAAK,IAAI3Q,EAAI,EAAGA,EAAIR,EAAS3J,OAAQmK,IAAK,CACtC,IAAI0R,EAAYlS,EAASQ,GAAG,GACxB2R,EAAY,CAAEvb,QAAS,IAC3B4I,EAAO/H,KAAK0a,GACZ,IAAIpS,EAAU0N,EAAcyE,GAAW,GACvCf,EAAMV,EAAa/H,MAAK,SAAUlC,GAAK,OAAOA,EAAExE,MAAQuP,CAAS,IAC7Dja,EAAS,CACTyI,QAASA,EACTC,SAAU,GACVE,UAAWqR,EAAU,IAAMA,EAC3BpR,SAAU,EACVC,WAAY+Q,EAAMA,EAAIpR,QAAU,GAChCE,UAAWsR,EACX/Z,KAAM0a,IAETlY,EAAKmY,EAAUvb,SAASa,KAAK4E,MAAMrC,EAAIsX,GACxCa,EAAUvb,QAAQa,KAAKH,EAC3B,CACJ,MACK,GAAI4Z,EAAQnZ,OAAQ,CAErB,IAAIqa,GADJjB,EAAMV,EAAa/H,MAAK,SAAUlC,GAAK,OAAOA,EAAExE,MAAQuP,CAAS,KACzCJ,EAAIpR,QAAU,GACtCqR,EAAUI,OAAOD,GACjBF,EAAK5Z,KAAK8Z,GACNja,EAAS,CACT0I,SAAU,GACVD,QAASqS,EACTnS,UAAWsR,EACXrR,UAAWkS,EACXjS,SAAU,EACV3I,KAAM4a,EACNhS,WAAY,IAEhBkR,EAAe7Z,KAAKH,EACxB,CACA8Z,EAAU9a,SAAQ,SAAU0L,GACxBxC,EAAOlJ,SAAQ,SAAUsJ,GAErB,IAAIyS,GADJlB,EAAMV,EAAa/H,MAAK,SAAUlC,GAAK,OAAOA,EAAExE,MAAQA,CAAK,KACtCmP,EAAIpR,QAAU,GACjCzI,EAAS,CACT0I,SAAU,GACVF,aAAa,EACbC,QAASsS,EACTpS,UAAW+B,EACX9B,UAAWmS,EACXlS,SAAU,EACV3I,KAAM6a,EACNjS,WAAY,IAEhBR,EAAMhJ,QAAQa,KAAKH,EACvB,GACJ,IACAuZ,EAAYpZ,KAAK4E,MAAMwU,EAAarR,EACxC,GACJ,EACSrD,EAAI,EAAGA,EAAIoU,EAAYla,OAAQ8F,IACpCyK,EAAQzK,GAEZ,OAAO0U,CACX,EACIyB,GAAkB,SAAUzZ,GAC5B,MAAO,CACHkH,QAASjK,OAAO+C,EAAQrB,MACxBwI,SAAU,GACVF,aAAa,EACbG,UAAW,aACXC,UAAW,6BACXC,SAAU,EACV3I,KAAM,eAAiBqB,EAAQrB,KAAO,IACtC4I,WAAY,GAEpB,EACImS,GAAa,SAAU3S,EAAO/G,GAC9B,IAAI2Z,EAAgBF,GAAgBzZ,GAChC4Z,EAAY1M,EAAKnG,GAErB,OADA6S,EAAU7b,QAAQa,KAAK+a,GAChBC,CACX,EAEIC,GAAsB,SAAUlT,EAAQ3I,GACxC,GAAIA,EAASR,OAAS,EAClB,OAAOmJ,EAGX,IADA,IAAI1G,EAAS0G,EAAOvG,QACXkD,EAAIrD,EAAOzC,OAAS,EAAG8F,GAAK,EAAGA,IAAK,CACzC,IAAIyD,EAAQ9G,EAAOqD,GACnBrD,EAAOqD,GAAKoW,GAAWzZ,EAAOqD,GAAItF,EAAS,IAC3C,IAAK,IAAIqT,EAAI,EAAGA,EAAIrT,EAASR,OAAQ6T,IAAK,CACtC,IAAIyI,EAAmBJ,GAAW3S,EAAO/I,EAASqT,IAClDpR,EAAOwM,OAAOnJ,EAAI+N,EAAG,EAAGyI,EAC5B,CACJ,CACA,OAAOrL,EAAyBxO,EACpC,EAqDI8Z,GAA4B,WAC5B,SAASA,EAAW7Y,GAChB/E,KAAK6d,SAAW,EAChB7d,KAAKoC,KAAO,KACZpC,KAAK8d,cAAgB,CAAC,EACtB9d,KAAK+d,OAAS,WAAc,EAC5B/d,KAAK6d,SAAW9Y,EAAQ8Y,QAC5B,CAqFA,OApFAzX,OAAO4X,eAAeJ,EAAW/W,UAAW,WAAY,CACpD0R,IAAK,WACD,OAAOvY,KAAKoC,KAAOmE,MAAMsD,KAAK7J,KAAKoC,KAAK0H,iBAAiB9J,KAAKie,UAAUta,KAAK,OAAS,EAC1F,EACAua,YAAY,EACZC,cAAc,IAElB/X,OAAO4X,eAAeJ,EAAW/W,UAAW,QAAS,CACjD0R,IAAK,WACD,OAAQvY,KAAKoC,MAAQpC,KAAKoC,KAAK0J,cAAc9L,KAAKie,UAAUta,KAAK,OAAU,IAC/E,EACAua,YAAY,EACZC,cAAc,IAElB/X,OAAO4X,eAAeJ,EAAW/W,UAAW,OAAQ,CAChD0R,IAAK,WACD,IAAI6F,EAAMpe,KAAKqe,SACf,OAAOD,EAAIA,EAAI/c,OAAS,IAAM,IAClC,EACA6c,YAAY,EACZC,cAAc,IAElB/X,OAAO4X,eAAeJ,EAAW/W,UAAW,UAAW,CACnD0R,IAAK,WACD,OAAOvY,KAAKqe,SAAS3K,MAAK,SAAU4K,GAAM,OAAOA,EAAGC,QAAQ,SAAW,GAC3E,EACAL,YAAY,EACZC,cAAc,IAElBP,EAAW/W,UAAU2X,MAAQ,SAAUpc,GACnC,IAAI8K,EAAQlN,KACZA,KAAKoC,KAAOA,EACZ,IAAIgY,EAAU,SAAUqE,GAChBC,EAAOC,YAAYF,KACnBC,EAAOZ,cAAcW,GAAa,SAAWG,GACzC,IAAIC,EAASD,EAAGC,kBAAkBC,SAAWF,EAAGC,OAAOE,QAAQ7R,EAAM+Q,UAAUta,KAAK,MAChFkb,GACA3R,EAAMyR,YAAYF,GAAWrX,UAAKrD,EAAW8a,EAAQ3R,EAAO0R,EAEnE,EACDxc,EAAK4c,iBAAiBP,EAAWC,EAAOZ,cAAcW,IAE9D,EACIC,EAAS1e,KACb,IAAK,IAAIye,KAAaze,KAAK2e,YACvBvE,EAAQqE,GAEZ,IAAI7M,EAAU,SAAU6M,GAChBQ,EAAOC,eAAeT,KACtBQ,EAAOnB,cAAcW,GAAa,SAAWG,GACzC,IAAIC,EAASD,EAAGC,kBAAkBC,SAAWF,EAAGC,OAAOE,QAAQ7R,EAAM+Q,UAAUta,KAAK,MAChFqJ,EAAiB,MAAX4R,EAAG5R,IAAc,QAAU4R,EAAG5R,IACpC6R,GAAU3R,EAAMgS,eAAeT,GAAWzR,IAC1CE,EAAMgS,eAAeT,GAAWzR,GAAK5F,UAAKrD,EAAW8a,EAAQ3R,EAAO0R,EAE3E,EACDxc,EAAK4c,iBAAiBP,EAAWQ,EAAOnB,cAAcW,IAE9D,EACIQ,EAASjf,KACb,IAAK,IAAIye,KAAaze,KAAKkf,eACvBtN,EAAQ6M,EAEhB,EACAb,EAAW/W,UAAUsY,KAAO,WACxB,GAAInf,KAAKoC,KACL,IAAK,IAAIqc,KAAaze,KAAK8d,cACnB9d,KAAK8d,cAAcW,IACnBze,KAAKoC,KAAKgd,oBAAoBX,EAAWze,KAAK8d,cAAcW,IAIxEze,KAAKoC,KAAO,IAChB,EACAwb,EAAW/W,UAAUwY,aAAe,SAAU9C,EAAS+C,GAC/C/C,IACI+C,IACAA,EAASC,gBAAgB,YACzBD,EAASE,UAAU3J,OAAO,YAE9B0G,EAAQkD,aAAa,WAAY3e,OAAOd,KAAK6d,WAC7CtB,EAAQmD,MAAM,CAAEC,eAAe,IAEvC,EACO/B,CACX,CA7F+B,GA+F3BgC,GAAsB,mCACtBC,GAA4B,2CAC5BC,GAAyB,wCACzBC,GAAe,yCACfC,GAAW,0BACXC,GAAU,oBACVC,GAAc,CAACN,GAAqBC,GAA2BC,IAAwBnc,KAAK,KAC5Fwc,GAAc,CACdJ,GACA,CAACF,GAA2BG,GAAUC,IAAStc,KAAK,KACpD,CAACmc,GAAwBE,GAAUC,IAAStc,KAAK,KACjD,CAACic,GAAqBI,GAAUC,IAAStc,KAAK,MAE9Cyc,GAAU,SAAUvB,EAAQwB,EAAKzB,GACjC,IAAI0B,EAAOzB,EAAO/S,cAAc,wBAChC,GAAIwU,EAAM,CACN,IAAIC,EAAUF,EAAIhC,SAASvb,QAAQ+b,GACnCwB,EAAItC,OAAS,WACTsC,EAAIhB,aAAagB,EAAIhC,SAASkC,GAAU,MACxCF,EAAItC,OAAS,WAAc,CAC/B,EACAuC,EAAKE,QACL5B,EAAG6B,gBACP,CACJ,EACIC,GAAgB,SAAU7B,EAAQ8B,EAAYC,GAC1C/B,EAAOgC,WAAaF,EAAWG,aAC/BF,EAAWE,WAAajC,EAAOgC,WAEvC,EACIE,GAAiB,SAAUlC,EAAQ8B,EAAYC,GAC3C/B,EAAOgC,WAAahC,EAAOmC,YAAcL,EAAWG,WAAaH,EAAWK,aAC5EnC,EAAOmC,YAAcL,EAAWK,cAChCJ,EAAWE,WAAajC,EAAOgC,WAAahC,EAAOmC,YAAcL,EAAWK,YAEpF,EACIC,GAAc,SAAUpC,EAAQ8B,EAAYC,GACxCD,EAAWO,WAAarC,EAAOsC,UAAYR,EAAWO,YACtDN,EAAWM,UAAYrC,EAAOsC,UAEtC,EACIC,GAAgB,SAAUvC,EAAQ8B,EAAYC,GAC1C/B,EAAOsC,UAAYtC,EAAOwC,aAAeV,EAAWO,UAAYP,EAAWU,cAC3ExC,EAAOwC,aAAeV,EAAWU,eACjCT,EAAWM,UAAYrC,EAAOsC,UAAYtC,EAAOwC,aAAeV,EAAWU,aAEnF,EACIC,GAAW,SAAUzC,EAAQzc,EAAMmf,GACnC,IAAIX,EAAaxe,EAAK0J,cAAc8T,IAChCe,EAAa9B,GAAUA,EAAOE,QAAQmB,IACrCU,GAAeD,GAAe9B,GAGnC0C,EAAWjgB,SAAQ,SAAUkgB,GAAU,OAAOA,EAAO3C,EAAQ8B,EAAYC,EAAa,GAC1F,EACIa,GAAW,SAAUC,GACrB,IAAIjX,EAAOlE,MAAMsD,KAAK6X,EAAMjX,MACxBkX,EAAYpb,MAAMsD,KAAMY,GAAQA,EAAK,IAAMA,EAAK,GAAGV,OAAU,IAC5DC,KAAI,SAAUwB,GAAK,OAAOA,EAAEoW,OAAS,IACrCC,QAAO,SAAUC,EAAMC,GAAO,OAAOD,EAAOC,CAAK,GAAG,GACrD/X,EAAMS,EAAKT,KAAI,WAAc,OAAO,IAAIzD,MAAMob,EAAY,IAa9D,OAZAlX,EAAKnJ,SAAQ,SAAU8L,EAAK4U,GACxB,IAAIC,EAAa,EACjB1b,MAAMsD,KAAKuD,EAAIrD,OAAOzI,SAAQ,SAAUkK,GACpC,IAAK,IAAI0W,EAAQ,EAAGA,EAAQ1W,EAAEoW,QAASM,IAAS,CAC5C,IAAK,IAAIC,EAAQ,EAAGA,EAAQ3W,EAAE4W,QAASD,IAAS,CAC5C,IAAIE,EAAMrY,EAAIgY,EAAIG,GAAOlS,WAAU,SAAUqS,EAAKC,GAAU,OAAOA,GAAUN,IAAeK,CAAK,IACjGtY,EAAIgY,EAAIG,GAAOE,GAAO7W,CAC1B,CACAyW,GACJ,CACJ,GACJ,IACOjY,CACX,EACIwY,GAAgB,SAAUpgB,GAO1B,IANA,IAAIqgB,EAAehB,GAASrf,EAAK0J,cAAc,CAAC+T,GAA2BG,IAAUrc,KAAK,OACtF+e,EAAYjB,GAASrf,EAAK0J,cAAc,CAACgU,GAAwBE,IAAUrc,KAAK,OAChFzC,EAASugB,GAASrf,EAAK0J,cAAc,CAAC8T,GAAqBI,IAAUrc,KAAK,OAC1Egf,EAAYvgB,EAAK0J,cAAciU,IAC/B6C,EAAe,IAAIrc,MAAMmc,EAAU,GAAGrhB,QAAQkK,KAAKoX,GACnD3Y,EAAM,GACD7C,EAAI,EAAGA,EAAIsb,EAAaphB,OAAQ8F,IACrC6C,EAAIvH,KAAKmgB,EAAa5f,OAAOyf,EAAatb,KAE9C,IAASA,EAAI,EAAGA,EAAIub,EAAUrhB,OAAQ8F,IAClC6C,EAAIvH,KAAKigB,EAAUvb,GAAGnE,OAAO9B,EAAOiG,KAExC,OAAO6C,CACX,EAWI6Y,GAAU,SAAUjE,GAAM,OAAOA,EAAGiE,SAAWjE,EAAGkE,OAAS,EAC3DC,GAAS,SAAU3gB,EAAMyc,EAAQmE,GAKjC,IAJA,IAAIhZ,EAAMwY,GAAcpgB,GACpB6gB,EAbW,SAAUjZ,EAAK6U,GAC9B,IAAK,IAAImD,EAAI,EAAGA,EAAIhY,EAAI3I,OAAQ2gB,IAC5B,IAAK,IAAIxW,EAAI,EAAGA,EAAIxB,EAAIgY,GAAG3gB,OAAQmK,IAC/B,GAAIxB,EAAIgY,GAAGxW,KAAOqT,EACd,MAAO,CAACmD,EAAGxW,GAIvB,MAAO,EAAE,GAAI,EACjB,CAIoB0X,CAAalZ,EAAK6U,GAC9BsE,EAAU,CAACF,EAAU,GAAKD,EAAI,GAAIC,EAAU,GAAKD,EAAI,IACrDhb,EAAOgC,EAAImZ,EAAQ,KAAOnZ,EAAImZ,EAAQ,IAAIA,EAAQ,IAC/Cnb,GAAQA,IAAS6W,GAEpB7W,EAAOgC,GADPmZ,EAAU,CAACA,EAAQ,GAAKH,EAAI,GAAIG,EAAQ,GAAKH,EAAI,KAC9B,KAAOhZ,EAAImZ,EAAQ,IAAIA,EAAQ,IAEtD,OAAOnb,CACX,EACIob,GAAmB,CACnBC,QAAS,CACLC,UAAW,SAAUzE,EAAQwB,EAAKzB,GAC9BA,EAAG6B,iBACH,IAAIzY,EAAO+a,GAAO1C,EAAIje,KAAMyc,EAAQ,CAAC,GAAI,IACzCwB,EAAIhB,aAAarX,EAAM6W,GACvByC,GAAStZ,EAAMqY,EAAIje,KAAM,CAAC2e,GAAgBL,GAAeU,GAAeH,IAC5E,EACAsC,WAAY,SAAU1E,EAAQwB,EAAKzB,GAC/BA,EAAG6B,iBACH,IAAIzY,EAAO+a,GAAO1C,EAAIje,KAAMyc,EAAQ,CAAC,EAAG,IACxCwB,EAAIhB,aAAarX,EAAM6W,GACvByC,GAAStZ,EAAMqY,EAAIje,KAAM,CAACse,GAAeK,GAAgBK,GAAeH,IAC5E,EACAuC,QAAS,SAAU3E,EAAQwB,EAAKzB,GAC5BA,EAAG6B,iBACH,IAAIzY,EAAO+a,GAAO1C,EAAIje,KAAMyc,EAAQ,EAAE,EAAG,IACzCwB,EAAIhB,aAAarX,EAAM6W,GACvByC,GAAStZ,EAAMqY,EAAIje,KAAM,CAAC2e,GAAgBL,GAAeU,GAAeH,IAC5E,EACAwC,UAAW,SAAU5E,EAAQwB,EAAKzB,GAC9BA,EAAG6B,iBACH,IAAIzY,EAAO+a,GAAO1C,EAAIje,KAAMyc,EAAQ,CAAC,EAAG,IACxCwB,EAAIhB,aAAarX,EAAM6W,GACvByC,GAAStZ,EAAMqY,EAAIje,KAAM,CAAC2e,GAAgBL,GAAeO,GAAaG,IAC1E,EACAsC,EAAG,SAAUC,EAAStD,EAAKuD,GACvB,GAAKvD,EAAIje,KAAT,CAGA,IAAI4F,EAAOqY,EAAIje,KAAKyhB,mBAChB7b,GAAQA,aAAgB8b,aAAe9b,EAAKuW,QAAQ,yCACpDvW,EAAKwY,QACLuD,YAAW,WACP,GAAI1D,EAAIje,KAAK4hB,WAAY,CACrB,IAAIC,EAAa5D,EAAIje,KAAK4hB,WAAWlY,cAAc,sFAC/CmY,aAAsBH,cACtBG,EAAWxE,aAAa,WAAY3e,OAAOuf,EAAIxC,WAC/CoG,EAAWvE,QAEnB,CACJ,GAAG,GAZP,CAcJ,EACAwE,MAAO9D,GACP+D,MAAO/D,GACPgE,KAAM,SAAUvF,EAAQwB,EAAKzB,GACzB,IAAI5U,EAAMwY,GAAcnC,EAAIje,MAGxB4F,GAFO6a,GAAQjE,GACF5U,EAAI,GAAMA,EAAI0J,MAAK,SAAU2Q,GAAM,OAAOlV,QAAQkV,EAAG3Q,MAAK,SAAU4Q,GAAK,OAAOA,IAAMzF,CAAQ,IAAK,KAAM,IAC3G,GACX7W,IACAqY,EAAIhB,aAAarX,EAAM6W,GACvByC,GAAStZ,EAAMqY,EAAIje,KAAM,CAAC2e,GAAgBL,GAAeU,GAAeH,KACxErC,EAAG6B,iBAEX,EACA8D,IAAK,SAAU1F,EAAQwB,EAAKzB,GACxB,IAAI5U,EAAMwY,GAAcnC,EAAIje,MAExBgL,EADOyV,GAAQjE,GACF5U,EAAIA,EAAI3I,OAAS,GAAM2I,EAAI0J,MAAK,SAAU2Q,GAAM,OAAOlV,QAAQkV,EAAG3Q,MAAK,SAAU4Q,GAAK,OAAOA,IAAMzF,CAAQ,IAAK,KAAM,GACnI7W,EAAOoF,GAAOA,EAAIA,EAAI/L,OAAS,IAAM,KACrC2G,IACAqY,EAAIhB,aAAarX,EAAM6W,GACvByC,GAAStZ,EAAMqY,EAAIje,KAAM,CAACse,GAAeK,GAAgBE,GAAaG,KACtExC,EAAG6B,iBAEX,IAGJ+D,GAAgB,CAChBhE,MAAO,SAAU3B,EAAQwB,GACrB,GAAIxB,GAAUA,aAAkBiF,YAAa,CACzC,IAAIhC,EAAOzB,EAAIhC,SAAS3K,MAAK,SAAUlI,GAAK,OAAOA,EAAEiZ,aAAa,WAAa,KAAM,KACrFpE,EAAIhB,aAAaR,EAAQiD,EAC7B,CACJ,GAmBA4C,GAAqC,SAAUC,GAE/C,SAASD,IACL,IAAIxX,EAAmB,OAAXyX,GAAmBA,EAAOtd,MAAMrH,KAAMoB,YAAcpB,KAIhE,OAHAkN,EAAM+Q,UAAYkC,GAClBjT,EAAMyR,YAAc6F,GACpBtX,EAAMgS,eAAiBkE,GAChBlW,CACX,CACA,OARAxG,EAAUge,EAAqBC,GAQxBD,CACX,CAVwC,CAUtC9G,IAEEK,GAAY,CACZ,qFACA,4CACA,4CAiBA2G,GAAW,SAAU/F,EAAQwB,EAAKzB,EAAIna,GACtCma,EAAG6B,iBACH,IAAIrC,EAAMiC,EAAIhC,SACV9c,EAAQ6c,EAAItb,QAAQ+b,GAAUpa,EAC9BlD,EAAQ,IACRA,EAAQ6c,EAAI/c,OAAS,GAEzBgf,EAAIhB,aAAajB,EAAI7c,EAAQ6c,EAAI/c,QAASwd,EAC9C,EACIgG,GAAW,SAAUhG,EAAQwB,EAAKzB,GAC9BA,EAAGC,kBAAkBiF,cACFlF,EAAGC,OAAO/S,cAAc,gEACfgY,cACxBlF,EAAG6B,iBACHmE,GAAS/F,EAAQwB,EAAKzB,GAAK,IAGvC,EACIM,GAAiB,CACjBmE,QAAS,CACLyB,IAAK,SAAUjG,EAAQwB,EAAKzB,GACxBgG,GAAS/F,EAAQwB,EAAKzB,EAAIA,EAAGmG,UAAY,EAAI,EACjD,EACAC,OAtCO,SAAUrB,EAAStD,EAAKzB,GACnC,GAAIA,EAAGC,kBAAkBiF,aACjBzD,EAAIje,KAAM,CACV,IAAI6iB,EAAQ5E,EAAIje,KAAK8iB,uBACjBC,EAAa9E,EAAIje,KAAKyhB,mBACtBuB,EAAY7e,MAAMsD,KAAKob,aAAiBnB,YAAcmB,EAAMnb,iBAAiB,cAAgB,IAAI4J,MAAK,SAAUlI,GAAK,OAAOA,EAAEqS,UAAY,CAAG,IAC7IuH,aAAqBtB,cACrBsB,EAAU1F,QACNyF,aAAsBrB,aACtBqB,EAAW3E,QAGvB,CAER,EAyBQ6E,OAAQR,GACRS,UAAWT,KAGflG,GAAc,CACd6B,MAAO,SAAU3B,EAAQwB,GACrB,GAAIxB,GAAUA,aAAkBiF,YAAa,CACzC,IAAIhC,EAAOzB,EAAIhC,SAAS3K,MAAK,SAAUlI,GAAK,OAAOA,EAAEiZ,aAAa,WAAa,KAAM,KACrFpE,EAAIhB,aAAaR,EAAQiD,EAC7B,CACJ,GAmBAyD,GAAwC,SAAUZ,GAElD,SAASY,IACL,IAAIrY,EAAmB,OAAXyX,GAAmBA,EAAOtd,MAAMrH,KAAMoB,YAAcpB,KAIhE,OAHAkN,EAAM+Q,UAAYA,GAClB/Q,EAAMyR,YAAcA,GACpBzR,EAAMgS,eAAiBA,GAChBhS,CACX,CACA,OARAxG,EAAU6e,EAAwBZ,GAQ3BY,CACX,CAV2C,CAUzC3H,IAEFve,EAAQmmB,EAAIxZ,EACZ3M,EAAQomB,EAAItM,EACZ9Z,EAAQqmB,EAAInc,EACZlK,EAAQsmB,EAAInL,GACZnb,EAAQumB,EAAItK,GACZjc,EAAQwmB,EAr2CQ,SAAU9gB,EAASS,QAChB,IAAXA,IAAqBA,EAAS,IAClCT,EAAQS,OAASA,CACrB,EAm2CAnG,EAAQymB,EA93CM,SAAU/gB,EAASjD,QAChB,IAATA,IAAmBA,EAAO,IAC9BiD,EAAQjD,KAAOA,CACnB,EA43CAzC,EAAQ0mB,EAAIR,GACZlmB,EAAQoI,EAAIid,GACZrlB,EAAQ2mB,SA3sFS,CACbC,GAAI,6BACJzjB,KAAM,0BACN0jB,SAAU,MACV7Y,YAAa,oCACb8Y,QAAS,CAAC,wBACVC,QAAQ,EACRC,OAAO,GAqsFXhnB,EAAQmS,EA5cmB,SAAU8U,GACjC,IAAIthB,EACAyV,EAAW6L,EAAK7L,SAAUK,EAAcwL,EAAKxL,YAAaD,EAAiByL,EAAKzL,eAAgB1V,EAAUmhB,EAAKnhB,QAASF,EAAaqhB,EAAKrhB,WAAYpD,EAAWykB,EAAKzkB,SAAUC,EAAOwkB,EAAKxkB,KAAM8Y,EAAS0L,EAAK1L,OAChNS,IAAWrW,EAAK,CAAC,GAAM4V,EAAOrB,aAAeqB,EAAOrB,YAAavU,EAAG4V,EAAO9B,WAAa8B,EAAO9B,UAAW9T,GAC1GuhB,EAAYthB,EAAW5D,OACvBma,GAAaX,EAAgB5V,EAAYwV,EAASlC,IAAIqC,EAAOrB,aAAczX,EAAMuZ,GACjFxZ,EAASmI,KAAI,SAAUkL,GAAK,MAAO,CAAGtT,QAAS,CAAC0b,GAAgBpI,IAAQ,IACxEyF,EAAe1V,EAAW5D,OAAS,EAAIqc,GAAoB6I,EAAW1kB,GAAY0kB,EAClF7L,EAAYvV,EAAQ9D,OAASma,GAAaV,EAAa3V,EAASsV,EAAU3Y,EAAMuZ,GAAW,CAAC,CAAEzZ,QAAS,KAE3G,MAAO,CACH2I,QAASoQ,EACTjQ,KAHa8P,GAASC,EAAUC,EAAWC,EAAcC,EAAQC,EAAgBC,EAAajZ,GAI9F4I,KAAMiQ,EAEd,EA8bArb,EAAQ8G,EAn8Be,CACnB2Q,KAAM,SAAUpM,GACP,UAAWA,IAAU,IACtBA,EAAK8b,KAAO,EACZ9b,EAAK+b,MAAQ,EAErB,EACAvP,MAAO,SAAUC,EAAKC,GAClBA,EAAKoP,MAAQrP,EAAIqP,KACjBpP,EAAKqP,OAAStP,EAAIsP,KACtB,EACAnP,WAAY,SAAUC,EAAK1W,GACvB0W,EAAIiP,MAAQ3lB,EACZ0W,EAAIkP,OAAS,CACjB,EACA3iB,OAAQ,SAAU4G,GAAQ,OAAOA,EAAK8b,KAAO9b,EAAK+b,KAAO,EACzD/O,OAAQ,SAAU7W,GAAS,OAAOA,EAAM8W,QAAQ,EAAI,GAo7BxDtY,EAAQmM,EAt0Ba,SAAUd,EAAMD,EAAMF,EAAS1I,EAAU+Y,EAAQpV,GAClE,IAAI1B,EAAS,IAAI0U,IACbsB,EAAQ,IAAItB,IACZ5O,EAAOa,EAAKzH,OAAOuH,GACnBmc,EAAY,IAAI9X,IAChBkK,EAAY8B,EAAO9B,UAAWS,EAAcqB,EAAOrB,YACnDvU,EApGkB,SAAUyF,EAAMF,EAAS/E,GAC/C,IAAImhB,EAAkBnhB,EACjBe,MAAMsO,QAAQrP,GAAU,CAAEohB,MAAO,MAAOjhB,QAASH,GAAWA,OAAUzB,EACvE8iB,EAAYF,EAAkB1mB,EAA6BuL,EAAEmb,GAAmB,WAAc,OAAO,CAAM,EAC3G/c,EAAOa,EAAKzH,OAAOuH,GACnBuc,EAAc,GAClB5O,EAAa1S,GAAU,IAAI,SAAUwS,GAC7B,UAAWA,GAAQA,EAAKjX,OACxB+lB,EAAYrkB,KAAKuV,EAAKjX,MAE9B,IACA,IAAI+C,EAAS,CAAEijB,WAAW,EAAOF,UAAWA,EAAWG,cAAe,IACtE,GAAIF,EAAY3jB,MAAK,SAAUoF,GAAK,MAAoB,mBAANA,CAAkB,IAChEzE,EAAOkjB,cAAgBpd,EAAK3F,aAE3B,GAAI6iB,EAAYzlB,OAAS,EAAG,CAC7B,IAAI4lB,EAAoB1gB,MAAMsD,KAAK,IAAI+E,IAAIkY,GAAa5lB,UACpD8lB,EAAgBpd,EAAKpE,QAAO,SAAUgM,GAAK,OAAOyV,EAAkBnkB,QAAQ0O,EAAExE,MAAQ,CAAG,IAC7FlJ,EAAOkjB,cAAgBA,CAC3B,CAEA,OADAljB,EAAOijB,UAAYjjB,EAAOkjB,cAAc3lB,OAAS,EAC1CyC,CACX,CA8EaojB,CAAoBzc,EAAMF,EAAS/E,GAASuhB,EAAY/hB,EAAG+hB,UAAWF,EAAY7hB,EAAG6hB,UAAWG,EAAgBhiB,EAAGgiB,cAmC5H,OAjCAtc,EAAKpJ,SAAQ,SAAU6lB,GACnB,GAAIJ,EAAW,CACX,IAAIK,EAAsB,CAAC,EAE3B,GADAJ,EAAc1lB,SAAQ,SAAUqJ,GAAQyc,EAAoBzc,EAAKqC,KAAOrC,EAAK0c,aAAaF,EAAW,KAChGN,EAAUO,GACX,MAER,CACA,IAAIlmB,EAAS0I,EAAKI,KAAI,SAAUwH,GAAK,OAAOA,EAAE6V,aAAaF,EAAW,IAClEG,EAVI,GAUYtkB,OAAOqE,MAVnB,GAUgCnG,GACpCub,EAAW3C,EAAMvB,IAAI+O,GACzB,IAAK7K,EAAU,CACX,IAAI8K,EAASzjB,EACT0jB,EAAW,SAAU7c,GAhFrB,IAAUqC,EAAKnM,EAiFf0mB,EAASnP,EAAQmP,GAjFPva,EAiFyBrC,EAAKqC,IAjFzBnM,EAiF8B8J,EAAK0c,aAAaF,GAjFhCna,EAF/B,IAEiDnM,GAkFrD,EACA4J,EAAKnJ,QAAQkmB,GACbD,EAASnP,EAAQmP,EAAQhO,GACzBmN,EAAU7X,IAAI0Y,GACdhd,EAAQjJ,QAAQkmB,GAChB/K,EAAW,CAAC,EACZ8K,EAAO5Y,IAAImK,EAAW2D,GACtB3C,EAAMnL,IAAI2Y,EAAS7K,GACnB5a,EAASP,SAAQ,SAAU4T,GACvBA,EAAEgE,UAAUpC,KAAK2F,EACrB,GACJ,CACA5a,EAASP,SAAQ,SAAU4T,GACvBA,EAAEgE,UAAU5B,WAAWmF,EAAUvH,EAAErU,MAAMsmB,GAC7C,GACJ,IACAT,EAAUplB,SAAQ,SAAUmmB,GAAQ,OAAO5O,EAAoB4O,EAAM5lB,EAAUiX,EAAY,IAC3FQ,GAAiBxV,EAAQjC,EAAU0X,EAAaT,GACzChV,CACX,EA6xBAzE,EAAQ6G,EAAI0R,EACZvY,EAAQ4I,EA5/Ba,CACjB6O,KAAM,SAAUpM,GACP,WAAYA,IAAU,IACvBA,EAAKgd,OAAS,EAEtB,EACAxQ,MAAO,SAAUC,EAAKC,GAClBA,EAAKsQ,QAAUvQ,EAAIuQ,MACvB,EACApQ,WAAY,SAAUC,EAAKoQ,GACvBpQ,EAAImQ,QAAU,CAClB,EACA5jB,OAAQ,SAAU4G,GAAQ,OAAOA,EAAKgd,MAAQ,EAC9ChQ,OAAQ,SAAU7W,GAAS,OAAOA,EAAM8W,SAAW,GAg/BvDtY,EAAQkJ,EAp8DQ,SAAUqf,EAAc7iB,GAAW,OAAOuC,EAAU4F,OAAO,OAAQ,GAAQ,WACvF,IAAI4J,EACJ,OAAOzO,EAAYrI,MAAM,SAAUgF,GAC/B,OAAQA,EAAG2D,OACP,KAAK,EAED,OADAmO,EAAO/P,EAAS,CAAEuB,KAAMxD,EAAkBC,GAAU8iB,QAAS,CAAE,eAAgB,YAAcC,OAAQ,QAAUF,EAAa9Q,MACrH,CAAC,EAAaiR,MAAMH,EAAaI,IAAKlR,IACjD,KAAK,EAED,MAAO,CAAC,EADG9R,EAAG4D,OACgBqf,QAClC,KAAK,EAED,MAAO,CAAC,EAAc1e,EADLvE,EAAG4D,SAGhC,GACJ,GAAI,EAs7DJvJ,EAAQoJ,EAx7Cc,SAAUe,GAM5B,MALY,CACRe,QAAS+H,EAAyB9I,EAASe,QAAQC,QACnDE,KAAMlB,EAASkB,KACfD,KAAMjB,EAASiB,KAAKD,OAG5B,EAk7CAnL,EAAQgU,EAn7DY,SAAUuU,EAAc7iB,GAAW,OAAOuC,EAAU4F,OAAO,OAAQ,GAAQ,WAC3F,IAAI4J,EAAgBoR,EACpB,OAAO7f,EAAYrI,MAAM,SAAUgF,GAC/B,OAAQA,EAAG2D,OACP,KAAK,EAED,OADAmO,EAAO/P,EAAS,CAAEuB,KAAMmE,EAAmB1H,GAAU8iB,QAAS,CAAE,eAAgB,YAAcC,OAAQ,QAAUF,EAAa9Q,MACtH,CAAC,EAAaiR,MAAMH,EAAaI,IAAKlR,IACjD,KAAK,EAED,MAAO,CAAC,EADG9R,EAAG4D,OACgBqf,QAClC,KAAK,EAED,OADAC,EAAiBljB,EAAG4D,OACb,CAAC,EAAcuE,EAAepI,EAAQnE,SAASsnB,IAElE,GACJ,GAAI,EAq6DJ7oB,EAAQ8H,EAAImM,EACZjU,EAAQuD,EAxwDK,SAAU4H,GACnB,IAAIpI,EAAO,CAAE4I,SAAU,IACnBhB,EAAM,CAAC,EACX,GAAIQ,EAAOyK,OAAM,SAAUhO,GAAK,OAA4B,IAArBA,EAAErF,QAAQP,QAAgBoN,EAAUxH,EAAErF,QAAQ,GAAK,IAEtF,MAAO,CACHoJ,SAAUR,EAAOR,KAAI,SAAU/C,GAC3B,IAAI3E,EAAS2E,EAAErF,QAAQ,GACvB,OAAOmF,EAAS,CAAC,EAAGzE,EAAQ,CAAE4M,eAAgB,CAAC5M,EAAOE,MAAO4I,WAAY9I,EAAOE,KAAM6N,KAAM,CAAC/N,EAAO2I,YACxG,KAGR,IAAK,IAAIkd,EAAa,EAAGA,EAAa3d,EAAOnJ,OAAQ8mB,IAsCjD,IArCA,IAAIvd,EAAQmG,EAAKvG,EAAO2d,IACpBnb,EAAM,GACNoN,EAAU,SAAUgO,GACpB,IACIC,EA3Iaxc,EAAMoD,EA0InB3M,EAASsI,EAAMhJ,QAAQwmB,GAE3B,GAAIhmB,EAAK4I,UAAqC,IAAzB5I,EAAK4I,SAAS3J,OAC/BgnB,EAAWjmB,OAEV,GAAI4H,EAAIgD,KAAShD,EAAIgD,EAAM1K,EAAOE,OAA6B,IAApBF,EAAO6I,SACnDkd,EAAWre,EAAIgD,QAEd,GAAIhD,EAAIgD,EAAM1K,EAAO8I,aAAe9I,EAAO6I,SAAW,IAAMnB,EAAIgD,EAAM1K,EAAO8I,WAAa9I,EAAOE,MAClG6lB,EAAWre,EAAIgD,EAAM1K,EAAO8I,iBAE3B,IAAKpB,EAAIgD,EAAM1K,EAAO8I,aAAe9I,EAAO6I,SAAW,IAAMnB,EAAIgD,EAAM1K,EAAO8I,WAAa9I,EAAOE,MAAO,CAC1G,IAAI8lB,EAAYliB,OAAOiW,KAAKrS,GAAK0J,MAAK,SAAUzL,GAAK,OAAO3F,EAAO8I,aAAepB,EAAI/B,GAAGzF,IAAM,IAC3F8lB,IACAD,EAAWre,EAAIse,GAEvB,CACA,GAAID,EAAU,CACV/lB,EAAO+N,MA5JMxE,EA4JcvJ,IA5JR2M,EA4JgBoZ,IA3J5BpZ,EAAOhE,YAAcY,EAAKZ,WACtCgE,EAAOoB,MAAQ,IAAIpM,MAAM,GAAI,GAAGjB,OAAO,EAAqB,IAAlB6I,EAAKV,SAAiBU,EAAKZ,UAAYY,EAAKrJ,OAAS,QAAYyM,GAAUA,EAAOoB,KAAQpB,EAAOoB,KAAO,IAAIrN,OAAO,CAAmB,IAAlB6I,EAAKV,SAAiBU,EAAKZ,UAAYY,EAAKrJ,QAAQgD,OAAO2J,UA2JpN7M,EAAO4M,eAAiBF,EAAuB1M,EAAQ+lB,GACvD,IAAIE,EAAgBF,EAASrd,SAASiF,WAAU,SAAUzE,GAAK,OAAOA,EAAEP,YAAcod,EAASpd,SAAW,KACnF,IAAnBsd,EACAF,EAASrd,SAASsF,OAAOiY,EAAe,EAAGjmB,GAG3C+lB,EAASrd,SAASvI,KAAKH,EAE/B,CACAA,EAAO8I,YAAc9I,EAAOE,KAC5BwK,GAAO1K,EAAO8I,WACTpB,EAAIgD,KACLhD,EAAIgD,GAAO1K,EAEnB,EACS8lB,EAAc,EAAGA,EAAcxd,EAAMhJ,QAAQP,OAAQ+mB,IAC1DhO,EAAQgO,GAGhB,OAAOrX,EAAKJ,EAAUvO,GAC1B,EAktDA/C,EAAQ0Z,EAtqDQ,SAAU3W,GAEtB,IADA,IAAI4C,EAAKoK,EAAShN,GAAOqN,EAASzK,EAAG,GAAI0K,EAAQ1K,EAAG,GAAI6K,EAAQ7K,EAAG,GAAI8K,EAAU9K,EAAG,GAC3EsK,EAAW,EAAGA,EAAWQ,EAASR,IAEvC,IADA,IAAIrF,EAAO,KACFoF,EAAW,EAAGA,EAAWQ,EAAOR,IACrC,GAAII,EAAOJ,GAAW,CAClB,IAAIrH,EAAOyH,EAAOJ,GAAUtF,MAAMuF,IAC7BtH,GAAQiC,IACTA,EAAKmY,SAAWnY,EAAKmY,SAAW,GAAK,GAErCnY,IACAA,EAAK2X,QAAU3X,EAAK6F,SAAW,GAE/B9H,IACAiC,EAAOjC,EAEf,CAGR,MAAO,CAACyH,EAAQC,EAAOG,EAAOC,EAClC,EAmpDAzQ,EAAQwD,EA/oDK,SAAUT,GAEnB,IADA,IAAI4C,EAAKoK,EAAShN,GAAOqN,EAASzK,EAAG,GAAI0K,EAAQ1K,EAAG,GAAI6K,EAAQ7K,EAAG,GAAI8K,EAAU9K,EAAG,GAC3EsK,EAAW,EAAGA,EAAWQ,EAASR,IAEvC,IADA,IAAIrF,EAAO,KACFoF,EAAW,EAAGA,EAAWQ,EAAOR,IACrC,GAAII,EAAOJ,GAAW,CAClB,IAAIrH,EAAOyH,EAAOJ,GAAUtF,MAAMuF,IAC7BtH,GAAQiC,IACTA,EAAKmY,SAAWnY,EAAKmY,SAAW,GAAK,GAErCnY,IACAA,EAAK2X,QAAU3X,EAAK6F,SAEpB9H,IACAiC,EAAOjC,EAEf,CAGR,OA/De,SAAUyH,EAAQC,EAAOG,EAAOC,GAE/C,IADA,IAAIhM,EAAS,IAAIyC,MAAMuJ,GACdR,EAAW,EAAGA,EAAWQ,EAASR,IACvC,IAAK,IAAID,EAAW,EAAGA,EAAWQ,EAAOR,IACrC,GAAII,EAAOJ,IAAaI,EAAOJ,GAAUtF,MAAMuF,GAAW,CACtD,IAAIrF,EAAOwF,EAAOJ,GAAUtF,MAAMuF,GAC7BxL,EAAOwL,KACRxL,EAAOwL,GAAY,CACfvF,MAAO,IAAIxD,MAAMsJ,GAAOtE,KAAK,QAGrCzH,EAAOwL,GAAUvF,MAAMsF,GAAYtI,EAAS,CAAC,EAAGkD,EAAM,CAAEmY,QAASnY,EAAK2X,QAASA,QAAS3X,EAAKmY,SACjG,CAGR,MAAO,CAACte,EAAQ4L,EAAOI,EAASD,EACpC,CA+CW2Y,CAAa/Y,EAAQC,EAAOG,EAAOC,EAC9C,EA4nDAzQ,EAAQ6V,EAAI2B,EACZxX,EAAQ+D,EA5iDK,SAAUsH,GAGnB,IAFA,IAAIzI,EACAI,EAAM,EACHA,EAAMqI,EAAKrJ,OAAQgB,IACtB,GAAuB,IAAnBqI,EAAKrI,GAAKiL,KAAY,CACtBrL,GAAQ,EACR,KACJ,CAEAA,GACAyI,EAAK4F,OAAOjO,EAAM,EAAG,EAAG,CACpB0I,QAAS,OACTwC,iBAAkB,SAClB/K,KAAM,OACNgL,WAAY,UAGxB,EA4hDAnO,EAAQqkB,EAAIhG,GACZre,EAAQmH,EAAI8K,EACZjS,EAAQopB,EAxyBY,SAAUhO,EAAU3B,EAAWjX,GAC/C,IAAIiC,EAAS,IAAI0U,IAEjB,OADAW,EAAWsB,EAAU3W,EAAQjC,EAAUiX,GAChChV,CACX,EAqyBAzE,EAAQ2iB,EAAIvQ,EACZpS,EAAQ6H,EA5hCW,CACf4P,KAAM,SAAUpM,GACP,QAASA,IAAU,IACpBA,EAAKge,IAAM,EAEnB,EACAxR,MAAO,SAAUC,EAAKC,GAClBA,EAAKsR,KAAOvR,EAAIuR,GACpB,EACApR,WAAY,SAAUC,EAAK1W,GACvB0W,EAAImR,KAAO7nB,CACf,EACAiD,OAAQ,SAAU4G,GAAQ,OAAOA,EAAKge,GAAK,EAC3ChR,OAAQ,SAAU7W,GAAS,OAAOA,EAAM8W,QAAQ,EAAI,GAghCxDtY,EAAQ4H,EAvtDK,SAAUyD,EAAMH,EAASE,EAAMqF,EAASD,GACjD,IAAI/L,EAASyC,MAAMsD,KAAK,IAAItD,MAAMsJ,IAAQ,WAAc,MAAO,CAAG9F,MAAOxD,MAAMsD,KAAK,IAAItD,MAAMuJ,IAAU,WAAc,OAAO,IAAM,IAAO,IACtI6Y,EAAO,SAAUplB,GAAS,OAAOA,EAAMI,KAAK,IAAM,EAClDilB,EAAe,SAAUhe,GAAS,OAAOA,EAAMhJ,QAAQoI,KAAI,SAAUkL,GAAK,OAAOA,EAAE1S,IAAM,GAAI,EAC7FqmB,EAAiB,IAAIrQ,IACrBsQ,EAAc,IAAItQ,IAatB,OAZAjO,EAAQjJ,SAAQ,SAAUynB,EAAY1mB,GAAOwmB,EAAela,IAAIga,EAAKI,EAAW1Y,MAAOhO,EAAM,IAC7FoI,EAAKnJ,SAAQ,SAAU0nB,EAAY3mB,GAAOymB,EAAYna,IAAIga,EAAKK,EAAW3Y,MAAOhO,EAAM,IACvFqI,EAAKpJ,SAAQ,SAAU+Y,GACnB,IAAI/K,EAAWuZ,EAAetQ,IAAIoQ,EAAKC,EAAavO,EAAKzO,eACrDyD,EAAWyZ,EAAYvQ,IAAIoQ,EAAKC,EAAavO,EAAK3O,iBACrC3H,IAAbuL,QAAuCvL,IAAbsL,IACrBvL,EAAOuL,GAAUtF,MAAMuF,KACxBxL,EAAOuL,GAAUjC,IAAM3C,EAAK4E,GAAUgB,KACtCvM,EAAOuL,GAAUtF,MAAMuF,GAAY+K,GAG/C,IACOvW,CACX,EAqsDAzE,EAAQ4pB,EAAI/U,EACZ7U,EAAQ+J,EAn7CR,SAA+B8f,GAE3B,IADA,IAAIC,EAAc,GACThoB,EAAK,EAAG6D,EAAKoB,OAAOiW,KAAK6M,GAAa/nB,EAAK6D,EAAG3D,OAAQF,IAAM,CACjE,IAAI6L,EAAMhI,EAAG7D,GACbgoB,EAAY1mB,KAAK,CAAED,KAAMyO,KAAKC,MAAMlE,GAAMjK,OAAQmmB,EAAWlc,IACjE,CACA,OAAOmc,CACX,EA66CA9pB,EAAQ+pB,EAAI3c,EACZpN,EAAQilB,EAjdyB,SAAU+E,EAAYxnB,GACnD,IAAIiC,EAASsC,OAAOiW,KAAKgN,GAAYrf,KAAI,SAAUsf,GAAO,MAAO,CAC7Dve,QAASue,EACT/b,iBAAkB+b,EAClBjc,YAAa,GACb7K,KAAM8mB,EACN9b,WAAY8b,EACZlb,oBAAqBkb,EACrBzlB,SAAS,EACTyJ,KAAM,EACN,IAoBJ,OAnBIzL,EAASR,QACTyC,EAAOrB,KAAK,CACRsI,QAAS,WACTC,SAAUnJ,EAASmI,KAAI,SAAUkL,GAAK,MAAO,CACzC7G,WAAY,IACZtD,QAASjK,OAAOoU,EAAE1S,MAClB8L,cAAe,GACfjB,YAAa,GACbK,cAAe,GACfQ,UAAWpN,OAAOoU,EAAE1S,MACpBA,KAAM1B,OAAOoU,EAAE1S,MACfgL,WAAY1M,OAAOoU,EAAE1S,MACrB,IACJ8K,KAAM,EACND,YAAa,GACb7K,KAAM,WACNgL,WAAY,eAGb1J,CACX,EAmbAzE,EAAQmJ,EAAI1D,EACZzF,EAAQkqB,EAAI/N,EAEf","ignoreList":[],"sourcesContent":["(function (global, factory) {\n    typeof exports === 'object' && typeof module !== 'undefined' ? factory(exports, require('kendo.data-query.cmn.chunk.js')) :\n    typeof define === 'function' && define.amd ? define(['exports', 'kendo.data-query.cmn.chunk'], factory) :\n    (global = typeof globalThis !== 'undefined' ? globalThis : global || self, factory((global.kendo = global.kendo || {}, global.kendo._globals = global.kendo._globals || {}, global.kendo._globals.PivotgridCommonCmnChunk = {}), global.kendo._globals.DataQueryCmnChunk));\n})(this, (function (exports, kendo_dataQuery_cmn_chunk_js) {\n    const __meta__ = {\n        id: \"pivotgrid-common.cmn.chunk\",\n        name: \"PivotgridCommonCmnChunk\",\n        category: \"web\",\n        description: \"A reusable outputed chunk of code\",\n        depends: ['data-query.cmn.chunk'],\n        hidden: true,\n        chunk: true\n    };\n\n\n\n    var filterFunctionFormats = {\n        contains: \", InStr({0}.CurrentMember.MEMBER_CAPTION,\\\"{1}\\\") > 0\",\n        doesnotcontain: \", InStr({0}.CurrentMember.MEMBER_CAPTION,\\\"{1}\\\")\",\n        endswith: \", Right({0}.CurrentMember.MEMBER_CAPTION,Len(\\\"{1}\\\"))=\\\"{1}\\\"\",\n        eq: \", {0}.CurrentMember.MEMBER_CAPTION = \\\"{1}\\\"\",\n        neq: \", {0}.CurrentMember.MEMBER_CAPTION = \\\"{1}\\\"\",\n        startswith: \", Left({0}.CurrentMember.MEMBER_CAPTION,Len(\\\"{1}\\\"))=\\\"{1}\\\"\"\n    };\n    var operators = {\n        doesnotcontain: 'doesnotcontain',\n        in: 'in',\n        neq: \"neq\"\n    };\n    /**\n     * @hidden\n     */\n    function serializeFilters(filters, cube) {\n        var command = \"\";\n        var current = \"\";\n        for (var idx = filters.length - 1; idx >= 0; idx--) {\n            current = \"SELECT (\";\n            current += serializeExpression(filters[idx]);\n            current += \") ON 0\";\n            if (idx === filters.length - 1) {\n                current += \" FROM [\" + cube + \"]\";\n                command = current;\n            }\n            else {\n                command = current + \" FROM ( \" + command + \" )\";\n            }\n        }\n        return command;\n    }\n    function serializeExpression(expression) {\n        var command = '';\n        var value = String(expression.value);\n        var field = expression.field;\n        var operator = expression.operator;\n        if (operator === operators.in) {\n            command += \"{\";\n            command += value;\n            command += \"}\";\n        }\n        else {\n            command += operator === operators.neq || operator === operators.doesnotcontain ? '-' : '';\n            command += \"Filter(\";\n            command += field + \".MEMBERS\";\n            command += formatString(filterFunctionFormats[operator], field, value);\n            command += \")\";\n        }\n        return command;\n    }\n    function formatString(str) {\n        var values = [];\n        for (var _i = 1; _i < arguments.length; _i++) {\n            values[_i - 1] = arguments[_i];\n        }\n        values.forEach(function (value, index) {\n            str = str.replace(new RegExp(\"\\\\{\" + index + \"\\\\}\", 'g'), value);\n        });\n        return str;\n    }\n\n    /**\n     * @hidden\n     */\n    function serializeMembers(members, measures, sort) {\n        var command = \"\";\n        members = members || [];\n        var parsed = parseDescriptors(members);\n        var expanded = parsed.expanded;\n        var rootNames = getRootNames(parsed.root);\n        var crossJoinCommands = [];\n        var length = expanded.length;\n        var idx = 0;\n        var memberName;\n        var names = [];\n        if (rootNames.length > 1 || measures.length > 1) {\n            crossJoinCommands.push(crossJoinCommand(rootNames, measures));\n            for (; idx < length; idx++) {\n                memberName = expandMemberDescriptor(expanded[idx].name, sort);\n                names = mapNames(memberName, rootNames);\n                crossJoinCommands.push(crossJoinCommand(names, measures));\n            }\n            command += crossJoinCommands.join(\",\");\n        }\n        else {\n            for (; idx < length; idx++) {\n                memberName = expandMemberDescriptor(expanded[idx].name, sort);\n                names.push(memberName[0]);\n            }\n            command += rootNames.concat(names).join(\",\");\n        }\n        return command;\n    }\n    /**\n     * @hidden\n     */\n    function measureNames(measures) {\n        var length = measures.length;\n        var result = [];\n        var measure;\n        for (var idx = 0; idx < length; idx++) {\n            measure = measures[idx];\n            result.push(measure.name !== undefined ? measure.name : measure);\n        }\n        return result;\n    }\n    function getRootNames(members) {\n        var root = [];\n        members.forEach(function (member) {\n            var name = member.name[0];\n            var hierarchyName = baseHierarchyPath(name);\n            if (!root.some(function (n) { return n.indexOf(hierarchyName) === 0; })) {\n                root.push(name);\n            }\n        });\n        return root;\n    }\n    function parseDescriptors(members) {\n        var expanded = [];\n        var child = [];\n        var root = [];\n        var idx = 0;\n        var found;\n        for (; idx < members.length; idx++) {\n            var member = members[idx];\n            var name_1 = member.name;\n            found = false;\n            if (name_1.length > 1) {\n                child.push(member);\n            }\n            else {\n                var hierarchyName = baseHierarchyPath(name_1[0]);\n                for (var j = 0, l = root.length; j < l; j++) {\n                    if (root[j].name[0].indexOf(hierarchyName) === 0) {\n                        found = true;\n                        break;\n                    }\n                }\n                if (!found) {\n                    root.push(member);\n                }\n                if (member.expand) {\n                    expanded.push(member);\n                }\n            }\n        }\n        expanded = expanded.concat(child);\n        return {\n            expanded: expanded,\n            root: root\n        };\n    }\n    function mapNames(names, rootNames) {\n        var rootLength = rootNames.length;\n        rootNames = rootNames.slice(0);\n        for (var idx = 0; idx < names.length; idx++) {\n            var name_2 = names[idx];\n            for (var j = 0; j < rootLength; j++) {\n                var rootName = baseHierarchyPath(rootNames[j]);\n                if (name_2.indexOf(rootName) !== -1) {\n                    rootNames[j] = name_2;\n                    break;\n                }\n            }\n        }\n        return rootNames;\n    }\n    function crossJoinCommand(members, measures) {\n        var tmp = members.slice(0);\n        if (measures.length > 1) {\n            tmp.push(\"{\" + measureNames(measures).join(\",\") + \"}\");\n        }\n        return crossJoin(tmp);\n    }\n    function expandMemberDescriptor(names, sort) {\n        var idx = names.length - 1;\n        var name = names[idx];\n        var sortDescriptor = sortDescriptorForMember(sort, name);\n        if (sortDescriptor && sortDescriptor.dir) {\n            name = \"ORDER(\" + name + \".Children,\" + sortDescriptor.field + \".CurrentMember.MEMBER_CAPTION,\" + sortDescriptor.dir + \")\";\n        }\n        else {\n            name += \".Children\";\n        }\n        names[idx] = name;\n        return names;\n    }\n    function sortDescriptorForMember(sort, member) {\n        for (var idx = 0, length_1 = sort.length; idx < length_1; idx++) {\n            if (member.indexOf(sort[idx].field) === 0) {\n                return sort[idx];\n            }\n        }\n        return null;\n    }\n    function baseHierarchyPath(memberName) {\n        var parts = memberName.split(\".\");\n        if (parts.length > 2) {\n            return parts[0] + \".\" + parts[1];\n        }\n        return memberName;\n    }\n    function crossJoin(names) {\n        var result = \"CROSSJOIN({\";\n        var name;\n        if (names.length > 2) {\n            name = names.pop();\n            result += crossJoin(names);\n        }\n        else {\n            result += names.shift();\n            name = names.pop();\n        }\n        result += \"},{\";\n        result += name;\n        result += \"})\";\n        return result;\n    }\n\n    /**\n     * @hidden\n     */\n    function createRequestBody(options) {\n        var command = '<Envelope xmlns=\"http://schemas.xmlsoap.org/soap/envelope/\"><Header/><Body><Execute xmlns=\"urn:schemas-microsoft-com:xml-analysis\"><Command><Statement>';\n        var _a = options.columnAxes, columnAxes = _a === void 0 ? [] : _a, _b = options.rowAxes, rowAxes = _b === void 0 ? [] : _b;\n        var _c = options.measureAxes, measureAxes = _c === void 0 ? [] : _c, _d = options.sort, sort = _d === void 0 ? [] : _d, _e = options.filter, filter = _e === void 0 ? [] : _e;\n        var measuresRowAxis = options.measuresAxis === \"rows\";\n        command += \"SELECT NON EMPTY {\";\n        if (!columnAxes.length && rowAxes.length && (!measureAxes.length || (measureAxes.length && measuresRowAxis))) {\n            columnAxes = rowAxes;\n            rowAxes = [];\n            measuresRowAxis = false;\n        }\n        if (!columnAxes.length && !rowAxes.length) {\n            measuresRowAxis = false;\n        }\n        if (columnAxes.length) {\n            command += serializeMembers(columnAxes, !measuresRowAxis ? measureAxes : [], sort);\n        }\n        else if (measureAxes.length && !measuresRowAxis) {\n            command += measureNames(measureAxes).join(\",\");\n        }\n        command += \"} DIMENSION PROPERTIES CHILDREN_CARDINALITY, PARENT_UNIQUE_NAME ON COLUMNS\";\n        if (rowAxes.length || (measuresRowAxis && measureAxes.length > 1)) {\n            command += \", NON EMPTY {\";\n            if (rowAxes.length) {\n                command += serializeMembers(rowAxes, measuresRowAxis ? measureAxes : [], sort);\n            }\n            else {\n                command += measureNames(measureAxes).join(\",\");\n            }\n            command += \"} DIMENSION PROPERTIES CHILDREN_CARDINALITY, PARENT_UNIQUE_NAME ON ROWS\";\n        }\n        if (filter.length) {\n            command += \" FROM \";\n            command += \"(\";\n            command += serializeFilters(filter, options.connection.cube);\n            command += \")\";\n        }\n        else {\n            command += \" FROM [\" + options.connection.cube + \"]\";\n        }\n        if (measureAxes.length === 1 && columnAxes.length) {\n            command += \" WHERE (\" + measureNames(measureAxes).join(\",\") + \")\";\n        }\n        command += '</Statement></Command><Properties><PropertyList><Catalog>' + options.connection.catalog + '</Catalog><Format>Multidimensional</Format></PropertyList></Properties></Execute></Body></Envelope>';\n        return command.replace(/&/g, \"&amp;\");\n    }\n\n    /*! *****************************************************************************\r\n    Copyright (c) Microsoft Corporation.\r\n\r\n    Permission to use, copy, modify, and/or distribute this software for any\r\n    purpose with or without fee is hereby granted.\r\n\r\n    THE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\r\n    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\r\n    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\r\n    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\r\n    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\r\n    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\r\n    PERFORMANCE OF THIS SOFTWARE.\r\n    ***************************************************************************** */\r\n    /* global Reflect, Promise */\r\n\r\n    var extendStatics = function(d, b) {\r\n        extendStatics = Object.setPrototypeOf ||\r\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n        return extendStatics(d, b);\r\n    };\r\n\r\n    function __extends(d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    }\r\n\r\n    var __assign = function() {\r\n        __assign = Object.assign || function __assign(t) {\r\n            for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n                s = arguments[i];\r\n                for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n            }\r\n            return t;\r\n        };\r\n        return __assign.apply(this, arguments);\r\n    };\r\n\r\n    function __rest(s, e) {\r\n        var t = {};\r\n        for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\r\n            t[p] = s[p];\r\n        if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\r\n            for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\r\n                if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\r\n                    t[p[i]] = s[p[i]];\r\n            }\r\n        return t;\r\n    }\r\n\r\n    function __decorate(decorators, target, key, desc) {\r\n        var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n        if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n        else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n        return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n    }\r\n\r\n    function __param(paramIndex, decorator) {\r\n        return function (target, key) { decorator(target, key, paramIndex); }\r\n    }\r\n\r\n    function __metadata(metadataKey, metadataValue) {\r\n        if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(metadataKey, metadataValue);\r\n    }\r\n\r\n    function __awaiter(thisArg, _arguments, P, generator) {\r\n        function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n        return new (P || (P = Promise))(function (resolve, reject) {\r\n            function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n            function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n            function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n            step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n        });\r\n    }\r\n\r\n    function __generator(thisArg, body) {\r\n        var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n        return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n        function verb(n) { return function (v) { return step([n, v]); }; }\r\n        function step(op) {\r\n            if (f) throw new TypeError(\"Generator is already executing.\");\r\n            while (_) try {\r\n                if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n                if (y = 0, t) op = [op[0] & 2, t.value];\r\n                switch (op[0]) {\r\n                    case 0: case 1: t = op; break;\r\n                    case 4: _.label++; return { value: op[1], done: false };\r\n                    case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                    case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                    default:\r\n                        if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                        if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                        if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                        if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                        if (t[2]) _.ops.pop();\r\n                        _.trys.pop(); continue;\r\n                }\r\n                op = body.call(thisArg, _);\r\n            } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n            if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n        }\r\n    }\r\n\r\n    function __createBinding(o, m, k, k2) {\r\n        if (k2 === undefined) k2 = k;\r\n        o[k2] = m[k];\r\n    }\r\n\r\n    function __exportStar(m, exports) {\r\n        for (var p in m) if (p !== \"default\" && !exports.hasOwnProperty(p)) exports[p] = m[p];\r\n    }\r\n\r\n    function __values(o) {\r\n        var s = typeof Symbol === \"function\" && Symbol.iterator, m = s && o[s], i = 0;\r\n        if (m) return m.call(o);\r\n        if (o && typeof o.length === \"number\") return {\r\n            next: function () {\r\n                if (o && i >= o.length) o = void 0;\r\n                return { value: o && o[i++], done: !o };\r\n            }\r\n        };\r\n        throw new TypeError(s ? \"Object is not iterable.\" : \"Symbol.iterator is not defined.\");\r\n    }\r\n\r\n    function __read(o, n) {\r\n        var m = typeof Symbol === \"function\" && o[Symbol.iterator];\r\n        if (!m) return o;\r\n        var i = m.call(o), r, ar = [], e;\r\n        try {\r\n            while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\r\n        }\r\n        catch (error) { e = { error: error }; }\r\n        finally {\r\n            try {\r\n                if (r && !r.done && (m = i[\"return\"])) m.call(i);\r\n            }\r\n            finally { if (e) throw e.error; }\r\n        }\r\n        return ar;\r\n    }\r\n\r\n    function __spread() {\r\n        for (var ar = [], i = 0; i < arguments.length; i++)\r\n            ar = ar.concat(__read(arguments[i]));\r\n        return ar;\r\n    }\r\n\r\n    function __spreadArrays() {\r\n        for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\r\n        for (var r = Array(s), k = 0, i = 0; i < il; i++)\r\n            for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\r\n                r[k] = a[j];\r\n        return r;\r\n    };\r\n\r\n    function __await(v) {\r\n        return this instanceof __await ? (this.v = v, this) : new __await(v);\r\n    }\r\n\r\n    function __asyncGenerator(thisArg, _arguments, generator) {\r\n        if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n        var g = generator.apply(thisArg, _arguments || []), i, q = [];\r\n        return i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i;\r\n        function verb(n) { if (g[n]) i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; }\r\n        function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }\r\n        function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r); }\r\n        function fulfill(value) { resume(\"next\", value); }\r\n        function reject(value) { resume(\"throw\", value); }\r\n        function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }\r\n    }\r\n\r\n    function __asyncDelegator(o) {\r\n        var i, p;\r\n        return i = {}, verb(\"next\"), verb(\"throw\", function (e) { throw e; }), verb(\"return\"), i[Symbol.iterator] = function () { return this; }, i;\r\n        function verb(n, f) { i[n] = o[n] ? function (v) { return (p = !p) ? { value: __await(o[n](v)), done: n === \"return\" } : f ? f(v) : v; } : f; }\r\n    }\r\n\r\n    function __asyncValues(o) {\r\n        if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n        var m = o[Symbol.asyncIterator], i;\r\n        return m ? m.call(o) : (o = typeof __values === \"function\" ? __values(o) : o[Symbol.iterator](), i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i);\r\n        function verb(n) { i[n] = o[n] && function (v) { return new Promise(function (resolve, reject) { v = o[n](v), settle(resolve, reject, v.done, v.value); }); }; }\r\n        function settle(resolve, reject, d, v) { Promise.resolve(v).then(function(v) { resolve({ value: v, done: d }); }, reject); }\r\n    }\r\n\r\n    function __makeTemplateObject(cooked, raw) {\r\n        if (Object.defineProperty) { Object.defineProperty(cooked, \"raw\", { value: raw }); } else { cooked.raw = raw; }\r\n        return cooked;\r\n    };\r\n\r\n    function __importStar(mod) {\r\n        if (mod && mod.__esModule) return mod;\r\n        var result = {};\r\n        if (mod != null) for (var k in mod) if (Object.hasOwnProperty.call(mod, k)) result[k] = mod[k];\r\n        result.default = mod;\r\n        return result;\r\n    }\r\n\r\n    function __importDefault(mod) {\r\n        return (mod && mod.__esModule) ? mod : { default: mod };\r\n    }\r\n\r\n    function __classPrivateFieldGet(receiver, privateMap) {\r\n        if (!privateMap.has(receiver)) {\r\n            throw new TypeError(\"attempted to get private field on non-instance\");\r\n        }\r\n        return privateMap.get(receiver);\r\n    }\r\n\r\n    function __classPrivateFieldSet(receiver, privateMap, value) {\r\n        if (!privateMap.has(receiver)) {\r\n            throw new TypeError(\"attempted to set private field on non-instance\");\r\n        }\r\n        privateMap.set(receiver, value);\r\n        return value;\r\n    }\n\n    /**\n     * @hidden\n     */\n    function parseResponse(response) {\n        var xmlDoc = new DOMParser().parseFromString(response, \"text/xml\");\n        var axes = Array.from(xmlDoc.querySelectorAll(\"Axis\"));\n        var cells = Array.from(xmlDoc.querySelectorAll(\"CellData > Cell\"))\n            .map(function (cell) { return ({\n            fmtValue: getPropertyValue(cell, \"FmtValue\"),\n            ordinal: parseInt(cell.getAttribute(\"CellOrdinal\"), 10),\n            value: getPropertyValue(cell, \"Value\")\n        }); });\n        var columns = { tuples: [] };\n        var rows = { tuples: [] };\n        var data = [];\n        axes.forEach(function (axis) {\n            if (axis.getAttribute('name') !== \"SlicerAxis\") {\n                var tuples = columns.tuples.length === 0 ? columns.tuples : rows.tuples;\n                Array.prototype.push.apply(tuples, translateAxis(axis));\n            }\n        });\n        var indexedData = new Array(rows.tuples.length * columns.tuples.length).fill(null);\n        cells.forEach(function (c) { indexedData[c.ordinal] = c; });\n        var counter = 0;\n        rows.tuples.forEach(function (rowTuple) {\n            columns.tuples.forEach(function (colTuple) {\n                data.push({\n                    columnTuple: colTuple,\n                    data: indexedData[counter],\n                    rowTuple: rowTuple\n                });\n                counter++;\n            });\n        });\n        return { columns: columns, data: data, rows: rows };\n    }\n    /**\n     * @hidden\n     */\n    function getPropertyValue(member, name) {\n        var node = member.querySelector(name);\n        return node ? node.textContent : \"\";\n    }\n    function translateAxis(axis) {\n        var tuples = Array.from(axis.querySelectorAll(\"Tuple\"));\n        return tuples.map(function (tuple) {\n            var memberElements = Array.from(tuple.querySelectorAll(\"Member\"));\n            var members = memberElements.map(function (member) {\n                var lNum = parseInt(getPropertyValue(member, \"LNum\") || \"0\", 10);\n                var hasChildren = parseInt(getPropertyValue(member, \"CHILDREN_CARDINALITY\") || \"0\", 10) > 0;\n                return {\n                    caption: getPropertyValue(member, \"Caption\"),\n                    children: [],\n                    hasChildren: hasChildren,\n                    hierarchy: member.getAttribute('Hierarchy'),\n                    levelName: getPropertyValue(member, \"LName\"),\n                    levelNum: lNum,\n                    name: getPropertyValue(member, \"UName\"),\n                    parentName: getPropertyValue(member, \"PARENT_UNIQUE_NAME\")\n                };\n            });\n            return { members: members };\n        });\n    }\n\n    /**\n     * @hidden\n     */\n    var discoverCommands = {\n        schemaCatalogs: \"DBSCHEMA_CATALOGS\",\n        schemaCubes: \"MDSCHEMA_CUBES\",\n        schemaDimensions: \"MDSCHEMA_DIMENSIONS\",\n        schemaHierarchies: \"MDSCHEMA_HIERARCHIES\",\n        schemaKPIs: \"MDSCHEMA_KPIS\",\n        schemaLevels: \"MDSCHEMA_LEVELS\",\n        schemaMeasures: \"MDSCHEMA_MEASURES\",\n        schemaMembers: \"MDSCHEMA_MEMBERS\"\n    };\n    /**\n     * @hidden\n     */\n    function createDiscoverBody(options) {\n        var properties = {};\n        var command = '<Envelope xmlns=\"http://schemas.xmlsoap.org/soap/envelope/\"><Header/><Body><Discover xmlns=\"urn:schemas-microsoft-com:xml-analysis\">';\n        command += \"<RequestType>\" + (discoverCommands[options.command] || options.command) + \"</RequestType>\";\n        command += \"<Restrictions>\" + serializeOptions(\"RestrictionList\", options.restrictions, true) + \"</Restrictions>\";\n        if (options.connection && options.connection.catalog) {\n            properties.Catalog = options.connection.catalog;\n        }\n        command += \"<Properties>\" + serializeOptions(\"PropertyList\", properties, false) + \"</Properties>\";\n        command += '</Discover></Body></Envelope>';\n        return command;\n    }\n    function serializeOptions(parentTagName, options, capitalize) {\n        var result = \"\";\n        if (options) {\n            result += \"<\" + parentTagName + \">\";\n            var value = void 0;\n            for (var key in options) {\n                if (options[key]) {\n                    value = options[key];\n                    if (capitalize) {\n                        key = key.replace(/([A-Z]+(?=$|[A-Z][a-z])|[A-Z]?[a-z]+)/g, \"$1_\").toUpperCase().replace(/_$/, \"\");\n                    }\n                    result += \"<\" + key + \">\" + value + \"</\" + key + \">\";\n                }\n            }\n            result += \"</\" + parentTagName + \">\";\n        }\n        else {\n            result += \"<\" + parentTagName + \"/>\";\n        }\n        return result;\n    }\n\n    /**\n     * @hidden\n     */\n    function parseCubes(response) {\n        var xmlDoc = new DOMParser().parseFromString(response, \"text/xml\");\n        var rows = Array.from(xmlDoc.querySelectorAll(\"DiscoverResponse > return > root > row\"))\n            .map(function (row) { return ({\n            name: getPropertyValue(row, \"CUBE_NAME\"),\n            caption: getPropertyValue(row, \"CUBE_CAPTION\"),\n            description: getPropertyValue(row, \"DESCRIPTION\"),\n            type: getPropertyValue(row, \"CUBE_TYPE\")\n        }); });\n        return rows;\n    }\n    /**\n     * @hidden\n     */\n    function parseCatalogs(response) {\n        var xmlDoc = new DOMParser().parseFromString(response, \"text/xml\");\n        var rows = Array.from(xmlDoc.querySelectorAll(\"DiscoverResponse > return > root > row\"))\n            .map(function (row) { return ({\n            name: getPropertyValue(row, \"CATALOG_NAME\"),\n            description: getPropertyValue(row, \"DESCRIPTION\")\n        }); });\n        return rows;\n    }\n    /**\n     * @hidden\n     */\n    function parseMeasures(response) {\n        var xmlDoc = new DOMParser().parseFromString(response, \"text/xml\");\n        var rows = Array.from(xmlDoc.querySelectorAll(\"DiscoverResponse > return > root > row\"))\n            .map(function (row) { return ({\n            name: getPropertyValue(row, \"MEASURE_NAME\"),\n            caption: getPropertyValue(row, \"MEASURE_CAPTION\"),\n            uniqueName: getPropertyValue(row, \"MEASURE_UNIQUE_NAME\"),\n            description: getPropertyValue(row, \"DESCRIPTION\"),\n            aggregator: getPropertyValue(row, \"MEASURE_AGGREGATOR\"),\n            groupName: getPropertyValue(row, \"MEASUREGROUP_NAME\"),\n            displayFolder: getPropertyValue(row, \"MEASURE_DISPLAY_FOLDER\"),\n            defaultFormat: getPropertyValue(row, \"DEFAULT_FORMAT_STRING\")\n        }); });\n        return rows;\n    }\n    /**\n     * @hidden\n     */\n    function parseKPIs(response) {\n        var xmlDoc = new DOMParser().parseFromString(response, \"text/xml\");\n        var rows = Array.from(xmlDoc.querySelectorAll(\"DiscoverResponse > return > root > row\"))\n            .map(function (row) { return ({\n            name: getPropertyValue(row, \"KPI_NAME\"),\n            uniqueName: getPropertyValue(row, \"KPI_NAME\"),\n            caption: getPropertyValue(row, \"KPI_CAPTION\"),\n            value: getPropertyValue(row, \"KPI_VALUE\"),\n            goal: getPropertyValue(row, \"KPI_GOAL\"),\n            status: getPropertyValue(row, \"KPI_STATUS\"),\n            trend: getPropertyValue(row, \"KPI_TREND\"),\n            statusGraphic: getPropertyValue(row, \"KPI_STATUS_GRAPHIC\"),\n            trendGraphic: getPropertyValue(row, \"KPI_TREND_GRAPHIC\"),\n            description: getPropertyValue(row, \"KPI_DESCRIPTION\"),\n            groupName: getPropertyValue(row, \"MEASUREGROUP_NAME\"),\n            type: \"kpi\"\n        }); });\n        return rows;\n    }\n    /**\n     * @hidden\n     */\n    function parseDimensions(response) {\n        var xmlDoc = new DOMParser().parseFromString(response, \"text/xml\");\n        var rows = Array.from(xmlDoc.querySelectorAll(\"DiscoverResponse > return > root > row\"))\n            .map(function (row) { return ({\n            caption: getPropertyValue(row, \"DIMENSION_CAPTION\"),\n            defaultHierarchy: getPropertyValue(row, \"DEFAULT_HIERARCHY\"),\n            description: getPropertyValue(row, \"DESCRIPTION\"),\n            name: getPropertyValue(row, \"DIMENSION_NAME\"),\n            type: parseInt(getPropertyValue(row, \"DIMENSION_TYPE\"), 10),\n            uniqueName: getPropertyValue(row, \"DIMENSION_UNIQUE_NAME\")\n        }); });\n        return rows;\n    }\n    /**\n     * @hidden\n     */\n    function parseHierarchies(response) {\n        var xmlDoc = new DOMParser().parseFromString(response, \"text/xml\");\n        var rows = Array.from(xmlDoc.querySelectorAll(\"DiscoverResponse > return > root > row\"))\n            .map(function (row) { return ({\n            name: getPropertyValue(row, \"HIERARCHY_NAME\"),\n            caption: getPropertyValue(row, \"HIERARCHY_CAPTION\"),\n            description: getPropertyValue(row, \"DESCRIPTION\"),\n            uniqueName: getPropertyValue(row, \"HIERARCHY_UNIQUE_NAME\"),\n            dimensionUniqueName: getPropertyValue(row, \"DIMENSION_UNIQUE_NAME\"),\n            displayFolder: getPropertyValue(row, \"HIERARCHY_DISPLAY_FOLDER\"),\n            origin: getPropertyValue(row, \"HIERARCHY_ORIGIN\"),\n            defaultMember: getPropertyValue(row, \"DEFAULT_MEMBER\")\n        }); });\n        return rows;\n    }\n    /**\n     * @hidden\n     */\n    function parseLevels(response) {\n        var xmlDoc = new DOMParser().parseFromString(response, \"text/xml\");\n        var rows = Array.from(xmlDoc.querySelectorAll(\"DiscoverResponse > return > root > row\"))\n            .map(function (row) { return ({\n            name: getPropertyValue(row, \"LEVEL_NAME\"),\n            caption: getPropertyValue(row, \"LEVEL_CAPTION\"),\n            description: getPropertyValue(row, \"DESCRIPTION\"),\n            uniqueName: getPropertyValue(row, \"LEVEL_UNIQUE_NAME\"),\n            dimensionUniqueName: getPropertyValue(row, \"DIMENSION_UNIQUE_NAME\"),\n            displayFolder: getPropertyValue(row, \"LEVEL_DISPLAY_FOLDER\"),\n            orderingProperty: getPropertyValue(row, \"LEVEL_ORDERING_PROPERTY\"),\n            origin: getPropertyValue(row, \"LEVEL_ORIGIN\"),\n            hierarchyUniqueName: getPropertyValue(row, \"HIERARCHY_UNIQUE_NAME\")\n        }); });\n        return rows;\n    }\n    /**\n     * @hidden\n     */\n    function parseMembers(response) {\n        var xmlDoc = new DOMParser().parseFromString(response, \"text/xml\");\n        var rows = Array.from(xmlDoc.querySelectorAll(\"DiscoverResponse > return > root > row\"))\n            .map(function (row) { return ({\n            name: getPropertyValue(row, \"MEMBER_NAME\"),\n            caption: getPropertyValue(row, \"MEMBER_CAPTION\"),\n            uniqueName: getPropertyValue(row, \"MEMBER_UNIQUE_NAME\"),\n            dimensionUniqueName: getPropertyValue(row, \"DIMENSION_UNIQUE_NAME\"),\n            hierarchyUniqueName: getPropertyValue(row, \"HIERARCHY_UNIQUE_NAME\"),\n            levelUniqueName: getPropertyValue(row, \"LEVEL_UNIQUE_NAME\"),\n            childrenCardinality: getPropertyValue(row, \"CHILDREN_CARDINALITY\")\n        }); });\n        return rows;\n    }\n\n    var _this = undefined;\n    var discoverParser = {\n        schemaCatalogs: parseCatalogs,\n        schemaCubes: parseCubes,\n        schemaDimensions: parseDimensions,\n        schemaHierarchies: parseHierarchies,\n        schemaKPIs: parseKPIs,\n        schemaLevels: parseLevels,\n        schemaMeasures: parseMeasures,\n        schemaMembers: parseMembers\n    };\n    /**\n     * Fetches the data.\n     *\n     * @param options RequestOptions\n     * @returns Promise<ResponseData>\n     *\n     * @example\n     * const options: RequestOptions = { ... };\n     *\n     * fetchData(options).then(createDataState).then((dataState: DataState) => {\n     *  // Update the UI\n     * });\n     */\n    /**\n     * @hidden\n     */\n    var fetchData = function (fetchOptions, options) { return __awaiter(_this, void 0, void 0, function () {\n        var init, response, stringResponse;\n        return __generator(this, function (_a) {\n            switch (_a.label) {\n                case 0:\n                    init = __assign({ body: createRequestBody(options), headers: { 'Content-Type': 'text/xml' }, method: 'POST' }, fetchOptions.init);\n                    return [4 /*yield*/, fetch(fetchOptions.url, init)];\n                case 1:\n                    response = _a.sent();\n                    return [4 /*yield*/, response.text()];\n                case 2:\n                    stringResponse = _a.sent();\n                    return [2 /*return*/, parseResponse(stringResponse)];\n            }\n        });\n    }); };\n    /**\n     * @hidden\n     */\n    var fetchDiscover = function (fetchOptions, options) { return __awaiter(_this, void 0, void 0, function () {\n        var init, response, stringResponse;\n        return __generator(this, function (_a) {\n            switch (_a.label) {\n                case 0:\n                    init = __assign({ body: createDiscoverBody(options), headers: { 'Content-Type': 'text/xml' }, method: 'POST' }, fetchOptions.init);\n                    return [4 /*yield*/, fetch(fetchOptions.url, init)];\n                case 1:\n                    response = _a.sent();\n                    return [4 /*yield*/, response.text()];\n                case 2:\n                    stringResponse = _a.sent();\n                    return [2 /*return*/, discoverParser[options.command](stringResponse)];\n            }\n        });\n    }); };\n\n    var isMeasure = function (member) { return member.hierarchy === '[Measures]'; };\n    // A typical tree depth count won't work for the Pivot,\n    // as each branch can have lower number of nodes than the total number of levels\n    /**\n     * @hidden\n     */\n    var getMaxNesting = function (node, set) {\n        if (set === void 0) { set = new Set(); }\n        (node.children || []).forEach(function (child) {\n            set.add(child.levelName);\n            getMaxNesting(child, set);\n        });\n        return set.size;\n    };\n    /**\n     * @hidden\n     */\n    var getMaxExpansion = function (node) {\n        var expanded = 0;\n        (node.children || []).forEach(function (child) {\n            expanded += (getMaxExpansion(child) || 1);\n        });\n        return expanded;\n    };\n    /**\n     * @hidden\n     */\n    var generateNormalizedPath = function (node, parent) {\n        return (parent && (parent.hierarchy === node.hierarchy)\n            ? (parent.normalizedPath || []).slice(0, -1).concat([node.name || null]) : ((parent && parent.normalizedPath) ? parent.normalizedPath : []).concat([node.name])).filter(Boolean);\n    };\n    /**\n     * @hidden\n     */\n    var generatePath = function (node, parent) {\n        return (parent && (parent.hierarchy === node.hierarchy)\n            ? (parent.path || []).slice(0, -1).concat([((node.levelNum === 0 ? node.hierarchy : node.name) || null)]) : ((parent && parent.path) ? parent.path : []).concat([node.levelNum === 0 ? node.hierarchy : node.name])).filter(Boolean);\n    };\n    /**\n     * @hidden\n     */\n    var toMatrix = function (node, rowIndex, colIndex, maxDepth, maxBreadth, matrix, leafs, parent) {\n        if (rowIndex === void 0) { rowIndex = -1; }\n        if (colIndex === void 0) { colIndex = 0; }\n        if (maxDepth === void 0) { maxDepth = undefined; }\n        if (maxBreadth === void 0) { maxBreadth = undefined; }\n        if (matrix === void 0) { matrix = undefined; }\n        if (leafs === void 0) { leafs = undefined; }\n        if (parent === void 0) { parent = undefined; }\n        var branchDepth = getMaxNesting(node);\n        var branchBreadth = getMaxExpansion(node);\n        var depth = maxDepth || branchDepth;\n        var breadth = maxBreadth || branchBreadth;\n        var matrixResult = matrix ? matrix.slice() : [];\n        var leafsResult = leafs ? leafs.slice() : new Array(breadth);\n        var index = matrixResult.findIndex(function (l) { return l && l.name === node.levelName && l.level === node.levelNum; });\n        var level = matrixResult[index];\n        var row = {\n            name: node.levelName,\n            level: node.levelNum,\n            index: rowIndex,\n            cells: new Array(breadth).fill(null)\n        };\n        var inject = rowIndex !== -1 && colIndex !== -1;\n        var cell = {\n            caption: node.caption,\n            name: node.name,\n            levelName: node.levelName,\n            levelNum: node.levelNum,\n            hasChildren: node.hasChildren,\n            parentName: node.parentName,\n            hierarchy: node.hierarchy,\n            total: (node.total !== undefined ? node.total : false) || (parent && parent.children.length <= 1 && parent.total),\n            parent: parent,\n            rowIndex: rowIndex,\n            colIndex: colIndex,\n            depth: 1,\n            breadth: 1,\n            path: node.path || [],\n            normalizedPath: node.normalizedPath || [],\n            children: node.children.filter(function (c) { return c.hierarchy === node.hierarchy; })\n        };\n        if (inject) {\n            if (level) {\n                level.cells[colIndex] = cell;\n                if (level.index >= rowIndex) {\n                    rowIndex = level.index;\n                }\n            }\n            else {\n                if (matrixResult[rowIndex] && matrixResult[rowIndex].cells.length) {\n                    for (var idx = rowIndex; idx < matrixResult.length; idx++) {\n                        var shiftedRow = matrixResult[idx];\n                        shiftedRow.index++;\n                    }\n                    matrixResult.splice(rowIndex, 0, row);\n                    matrixResult[rowIndex].cells[colIndex] = cell;\n                }\n                else {\n                    matrixResult[rowIndex] = row;\n                    matrixResult[rowIndex].cells[colIndex] = cell;\n                }\n            }\n        }\n        var collOffset = 0;\n        if (node.children && node.children.length) {\n            node.children.forEach(function (child) {\n                var _a = toMatrix(child, rowIndex + 1, colIndex + collOffset, depth, breadth, matrixResult, leafsResult, cell), newMatrix = _a[0], newLeafs = _a[1], childBreadth = _a[3];\n                collOffset += (childBreadth || 1);\n                matrixResult = newMatrix.slice();\n                leafsResult = newLeafs.slice();\n            });\n        }\n        else if (node.normalizedPath) {\n            leafsResult[colIndex] = { total: cell.total, path: node.normalizedPath };\n        }\n        cell.depth = branchDepth;\n        cell.breadth = branchBreadth;\n        return [\n            matrixResult,\n            leafsResult,\n            branchDepth,\n            branchBreadth\n        ];\n    };\n    var withTotal = function (root, parent, index) {\n        if (parent === void 0) { parent = null; }\n        if (index === void 0) { index = 0; }\n        var hierarchy;\n        var alt = __assign({}, root, { total: true, hasChildren: false, children: [] });\n        for (var childIndex = 0; childIndex < root.children.length; childIndex++) {\n            var child = withTotal(root.children[childIndex], root, childIndex);\n            hierarchy = hierarchy || child.hierarchy;\n            if (child.hierarchy !== hierarchy\n                && parent\n                && !parent.children.some(function (c) { return c.total && c.name === alt.name; })\n                && !root.total) {\n                alt.children.push(child);\n                root.children.splice(childIndex, 1);\n                childIndex--;\n            }\n        }\n        if (root.children.filter(function (c) { return !c.total; }).length >= 1\n            && parent\n            && !parent.children.some(function (c) { return c.total && c.name === alt.name; })\n            && !root.total) {\n            var childHierarchy = root.children[0].hierarchy;\n            if (root.hierarchy === childHierarchy) {\n                parent.children.splice(index + 1, 0, alt);\n            }\n        }\n        return root;\n    };\n    /**\n     * @hidden\n     */\n    var toTree = function (tuples) {\n        var root = { children: [] };\n        var map = {};\n        if (tuples.every(function (t) { return t.members.length === 1 && isMeasure(t.members[0]); })) {\n            // toTree(columnsTuples) - The case where there are only measure(s) and no columns.\n            return {\n                children: tuples.map(function (t) {\n                    var member = t.members[0];\n                    return __assign({}, member, { normalizedPath: [member.name], parentName: member.name, path: [member.hierarchy] });\n                })\n            };\n        }\n        for (var tupleIndex = 0; tupleIndex < tuples.length; tupleIndex++) {\n            var tuple = copy(tuples[tupleIndex]);\n            var key = \"\";\n            var _loop_1 = function (memberIndex) {\n                var member = tuple.members[memberIndex];\n                var parent_1;\n                if (root.children && root.children.length === 0) {\n                    parent_1 = root;\n                }\n                else if (map[key] && !map[key + member.name] && member.levelNum === 0) {\n                    parent_1 = map[key];\n                }\n                else if (map[key + member.parentName] && member.levelNum > 0 && !map[key + member.parentName + member.name]) {\n                    parent_1 = map[key + member.parentName];\n                }\n                else if (!map[key + member.parentName] && member.levelNum > 0 && !map[key + member.parentName + member.name]) {\n                    var parentKey = Object.keys(map).find(function (e) { return member.parentName === map[e].name; });\n                    if (parentKey) {\n                        parent_1 = map[parentKey];\n                    }\n                }\n                if (parent_1) {\n                    member.path = generatePath(member, parent_1);\n                    member.normalizedPath = generateNormalizedPath(member, parent_1);\n                    var intruderIndex = parent_1.children.findIndex(function (c) { return c.hierarchy !== parent_1.hierarchy; });\n                    if (intruderIndex !== -1) {\n                        parent_1.children.splice(intruderIndex, 0, member);\n                    }\n                    else {\n                        parent_1.children.push(member);\n                    }\n                }\n                member.parentName += member.name;\n                key += member.parentName;\n                if (!map[key]) {\n                    map[key] = member;\n                }\n            };\n            for (var memberIndex = 0; memberIndex < tuple.members.length; memberIndex++) {\n                _loop_1(memberIndex);\n            }\n        }\n        return copy(withTotal(root));\n    };\n    /**\n     * @hidden\n     */\n    var toData = function (data, columns, rows, breadth, depth) {\n        var result = Array.from(new Array(depth), function () { return ({ cells: Array.from(new Array(breadth), function () { return null; }) }); });\n        var hash = function (names) { return names.join('|'); };\n        var membersNames = function (tuple) { return tuple.members.map(function (m) { return m.name; }); };\n        var columnsIndexes = new Map();\n        var rowsIndexes = new Map();\n        columns.forEach(function (colMembers, idx) { columnsIndexes.set(hash(colMembers.path), idx); });\n        rows.forEach(function (rowMembers, idx) { rowsIndexes.set(hash(rowMembers.path), idx); });\n        data.forEach(function (item) {\n            var colIndex = columnsIndexes.get(hash(membersNames(item.columnTuple)));\n            var rowIndex = rowsIndexes.get(hash(membersNames(item.rowTuple)));\n            if (colIndex !== undefined && rowIndex !== undefined) {\n                if (!result[rowIndex].cells[colIndex]) {\n                    result[rowIndex].row = rows[rowIndex].path;\n                    result[rowIndex].cells[colIndex] = item;\n                }\n            }\n        });\n        return result;\n    };\n    var rotateMatrix = function (matrix, leafs, depth, breadth) {\n        var result = new Array(breadth);\n        for (var colIndex = 0; colIndex < breadth; colIndex++) {\n            for (var rowIndex = 0; rowIndex < depth; rowIndex++) {\n                if (matrix[rowIndex] && matrix[rowIndex].cells[colIndex]) {\n                    var cell = matrix[rowIndex].cells[colIndex];\n                    if (!result[colIndex]) {\n                        result[colIndex] = {\n                            cells: new Array(depth).fill(null)\n                        };\n                    }\n                    result[colIndex].cells[rowIndex] = __assign({}, cell, { rowSpan: cell.colSpan, colSpan: cell.rowSpan });\n                }\n            }\n        }\n        return [result, leafs, breadth, depth];\n    };\n    /**\n     * @hidden\n     */\n    var toColumns = function (root) {\n        var _a = toMatrix(root), matrix = _a[0], leafs = _a[1], depth = _a[2], breadth = _a[3];\n        for (var colIndex = 0; colIndex < breadth; colIndex++) {\n            var cell = null;\n            for (var rowIndex = 0; rowIndex < depth; rowIndex++) {\n                if (matrix[rowIndex]) {\n                    var next = matrix[rowIndex].cells[colIndex];\n                    if (!next && cell) {\n                        cell.rowSpan = (cell.rowSpan || 1) + 1;\n                    }\n                    if (cell) {\n                        cell.colSpan = cell.breadth || 1;\n                    }\n                    if (next) {\n                        cell = next;\n                    }\n                }\n            }\n        }\n        return [matrix, leafs, depth, breadth];\n    };\n    /**\n     * @hidden\n     */\n    var toRows = function (root) {\n        var _a = toMatrix(root), matrix = _a[0], leafs = _a[1], depth = _a[2], breadth = _a[3];\n        for (var colIndex = 0; colIndex < breadth; colIndex++) {\n            var cell = null;\n            for (var rowIndex = 0; rowIndex < depth; rowIndex++) {\n                if (matrix[rowIndex]) {\n                    var next = matrix[rowIndex].cells[colIndex];\n                    if (!next && cell) {\n                        cell.rowSpan = (cell.rowSpan || 1) + 1;\n                    }\n                    if (cell) {\n                        cell.colSpan = cell.breadth;\n                    }\n                    if (next) {\n                        cell = next;\n                    }\n                }\n            }\n        }\n        return rotateMatrix(matrix, leafs, depth, breadth);\n    };\n    /**\n     * @hidden\n     */\n    var cloneDate = function (date) { return date ? new Date(date.getTime()) : null; };\n    /**\n     * @hidden\n     */\n    function clone(obj) {\n        var result = {};\n        cloneObject(obj, result);\n        return result;\n    }\n    /**\n     * @hidden\n     */\n    function cloneObject(obj, result) {\n        for (var field in obj) {\n            if (obj.hasOwnProperty(field)) {\n                var value = obj[field];\n                result[field] = cloneValue(value, result[field]);\n            }\n        }\n    }\n    /**\n     * @hidden\n     */\n    function cloneValue(value, nextValue) {\n        if (Array.isArray(value)) {\n            return cloneArray(value);\n        }\n        else if (value instanceof Date) {\n            return cloneDate(value);\n        }\n        else if (value && typeof value === 'object') {\n            var newNextValue = nextValue || {};\n            cloneObject(value, newNextValue);\n            return newNextValue;\n        }\n        else {\n            return value;\n        }\n    }\n    /**\n     * @hidden\n     */\n    function copy(obj) {\n        return JSON.parse(JSON.stringify(obj));\n    }\n    /**\n     * @hidden\n     */\n    function cloneArray(array) {\n        return array.map(function (value) { return cloneValue(value, undefined); });\n    }\n    var kpiMeasure = function (name, measure, type) {\n        return {\n            hierarchyUniqueName: name,\n            uniqueName: measure,\n            caption: measure,\n            measure: measure,\n            name: measure,\n            type: type,\n            kpi: true\n        };\n    };\n    /**\n     * @hidden\n     */\n    function buildKPIMeasures(node) {\n        var name = node.name;\n        return [\n            kpiMeasure(name, node.value, \"value\"),\n            kpiMeasure(name, node.goal, \"goal\"),\n            kpiMeasure(name, node.status, \"status\"),\n            kpiMeasure(name, node.trend, \"trend\")\n        ];\n    }\n    /**\n     * @hidden\n     */\n    var addKPI = function (data) {\n        var found;\n        var idx = 0;\n        for (; idx < data.length; idx++) {\n            if (data[idx].type === 2) {\n                found = true;\n                break;\n            }\n        }\n        if (found) {\n            data.splice(idx + 1, 0, {\n                caption: \"KPIs\",\n                defaultHierarchy: \"[KPIs]\",\n                name: \"KPIs\",\n                uniqueName: \"[KPIs]\"\n            });\n        }\n    };\n    /**\n     * @hidden\n     */\n    var compareAxisWithField = function (a, b) { return String(a.name) === String([(b.defaultHierarchy\n            ? b.defaultHierarchy\n            : b.uniqueName)]); };\n    /**\n     * @hidden\n     */\n    var compareAxes = function (a, b) { return String(a.name) === String(b.name); };\n    /**\n     * @hidden\n     */\n    var filterField = function (axes, out) {\n        var _loop_2 = function (i) {\n            var axis = axes[i];\n            var index = axis.name.findIndex(function (name) { return compareAxisWithField({ name: [name] }, out) || String(name).startsWith(out.uniqueName); });\n            if (index !== -1) {\n                if (index === axis.name.length - 1 || axis.name.length === 1) {\n                    axes.splice(i, 1);\n                }\n                else {\n                    axis.name.splice(index, 1);\n                    var duplicatedAxisIndex = axes.findIndex(function (ax) { return ax !== axis && String(ax.name) === String(axis.name); });\n                    if (duplicatedAxisIndex !== -1) {\n                        axes[duplicatedAxisIndex] = __assign({}, axes[duplicatedAxisIndex], axis, ((axes[duplicatedAxisIndex].expand || axis.expand) ? { expand: true } : {}));\n                        axes.splice(i, 1);\n                    }\n                }\n            }\n        };\n        for (var i = axes.length - 1; i >= 0; i--) {\n            _loop_2(i);\n        }\n    };\n    /**\n     * @hidden\n     */\n    var insertAxis = function (axes, toInsert, state) {\n        var index = -1;\n        if (state.dropTarget && state.dropDirection) {\n            var offset = state.dropDirection\n                ? (state.dropDirection === 'before'\n                    ? 0\n                    : 1)\n                : 0;\n            index = axes.findIndex(function (c) { return compareAxes(c, state.dropTarget); }) + offset;\n        }\n        if (index !== -1) {\n            axes.forEach(function (axis) {\n                var _a;\n                if (axis.expand && axis.name.length > 1 && axis.name.length > index) {\n                    (_a = axis.name).splice.apply(_a, [index, 0].concat(toInsert.name));\n                }\n            });\n            axes.splice(index, 0, toInsert);\n        }\n        else {\n            axes.push(toInsert);\n        }\n    };\n    /**\n     * @hidden\n     */\n    var reverseColumnsByMeasures = function (columns) {\n        var firstColumn = columns.length && columns[0];\n        var lastMember = firstColumn && firstColumn.members[firstColumn.members.length - 1];\n        if (lastMember && isMeasure(lastMember)) {\n            var columnsArr = [];\n            var measuresCount = new Set(columns.map(function (col) { return col.members[col.members.length - 1].caption; })).size;\n            for (var i = 0; i < columns.length; i += measuresCount) {\n                columnsArr.push(columns.slice(i, i + measuresCount));\n            }\n            var result_1 = [];\n            columnsArr.forEach(function (arr) {\n                result_1.push.apply(result_1, arr.reverse());\n            });\n            return result_1;\n        }\n        return columns;\n    };\n\n    /**\n     * Creates the state object. See `fetchData`.\n     *\n     * @param response - ResponseData\n     * @returns DataState\n     */\n    /**\n     * @hidden\n     */\n    var createDataState = function (response) {\n        var state = {\n            columns: reverseColumnsByMeasures(response.columns.tuples),\n            data: response.data,\n            rows: response.rows.tuples\n        };\n        return state;\n    };\n\n    /**\n     * Creates a collection of AxisDescriptor base on the expandTree.\n     * @param expandTree - { [key: string]: boolean }\n     * @returns AxisDescriptor[]\n     *\n     * @example\n     * See `setRowExpand` or `setColumnExpand` functions.\n     */\n    /**\n     * @hidden\n     */\n    function createAxisDescriptors(expandTree) {\n        var descriptors = [];\n        for (var _i = 0, _a = Object.keys(expandTree); _i < _a.length; _i++) {\n            var key = _a[_i];\n            descriptors.push({ name: JSON.parse(key), expand: expandTree[key] });\n        }\n        return descriptors;\n    }\n\n    /**\n     * Sets sort descriptors to request options.\n     *\n     * @param options - RequestOptions\n     * @param sort - SortDescriptor[]\n     *\n     * @example\n     * const options: RequestOptions = { ... };\n     * const sort: SortDescriptor[] = [{ ... }, { ... }];\n     * setSort(options, sort);\n     * // skip the sort parameter to clear current filter - setSort(options);\n     *\n     * fetchData(options).then(createDataState).then((dataState: DataState) => {\n     *  // Update the UI\n     * });\n     */\n    /**\n     * @hidden\n     */\n    var setSort = function (options, sort) {\n        if (sort === void 0) { sort = []; }\n        options.sort = sort;\n    };\n\n    /**\n     * Sets filter descriptors to request options.\n     *\n     * @param options - RequestOptions\n     * @param filter - FilterDescriptor[]\n     *\n     * @example\n     * const options: RequestOptions = { ... };\n     * const filter: FilterDescriptor[] = [{ ... }, { ... }];\n     * setFilter(options, filter);\n     * // skip the filter parameter to clear current filter - setFilter(options);\n     *\n     * fetchData(options).then(createDataState).then((dataState: DataState) => {\n     *  // Update the UI\n     * });\n     */\n    /**\n     * @hidden\n     */\n    var setFilter = function (options, filter) {\n        if (filter === void 0) { filter = []; }\n        options.filter = filter;\n    };\n\n    /**\n     * @hidden\n     */\n    var HEADERS_ACTION;\n    (function (HEADERS_ACTION) {\n        HEADERS_ACTION[\"toggle\"] = \"HEADERS_ACTION_TOGGLE\";\n        HEADERS_ACTION[\"expand\"] = \"HEADERS_ACTION_EXPAND\";\n        HEADERS_ACTION[\"collapse\"] = \"HEADERS_ACTION_COLLAPSE\";\n    })(HEADERS_ACTION || (HEADERS_ACTION = {}));\n    var findPath = function (node, matchFn, matched) {\n        var result = new Set();\n        node.children.forEach(function (child) {\n            var match = matchFn(child);\n            if (matched) {\n                result.add(String(child.path));\n            }\n            findPath(child, matchFn, (matched || match)).map(function (h) {\n                result.add(h);\n            });\n        });\n        return Array.from(result.values());\n    };\n    /**\n     * @hidden\n     */\n    var headersReducer = function (state, action) {\n        switch (action.type) {\n            case HEADERS_ACTION.toggle: {\n                var existing = state.find((function (s) { return String(s.name) === String(action.payload); }));\n                return headersReducer(state, __assign({}, action, { type: existing && (existing.expand)\n                        ? HEADERS_ACTION.collapse\n                        : HEADERS_ACTION.expand }));\n            }\n            case HEADERS_ACTION.expand: {\n                var existing_1 = state.find((function (s) { return String(s.name) === String(action.payload); }));\n                if (existing_1 && existing_1.expand === true) {\n                    return state;\n                }\n                else if (existing_1 && (existing_1.expand === false || existing_1.expand === undefined)) {\n                    return state.map(function (s) { return s === existing_1 ? (__assign({}, existing_1, { expand: true })) : s; });\n                }\n                else {\n                    var nextState = state.slice();\n                    nextState.push({ name: action.payload, expand: true });\n                    return nextState;\n                }\n            }\n            case HEADERS_ACTION.collapse: {\n                var filtered_1 = findPath(action.tree, function (node) { return !node.total && String(node.path) === String(action.payload); });\n                var newState = state.slice()\n                    .filter(function (h) { return !filtered_1.some(function (f) { return f === String(h.name); }); })\n                    .map(function (h) { return (__assign({}, h, { expand: Boolean(h.expand) })); })\n                    .map(function (h) { return (String(h.name) === String(action.payload))\n                    ? action.payload.length > 1 ? undefined : { name: action.payload, expand: false }\n                    : h; })\n                    .filter(Boolean);\n                return newState;\n            }\n            default: {\n                return state;\n            }\n        }\n    };\n\n    /**\n     * @hidden\n     */\n    exports.I = void 0;\n    (function (PIVOT_CONFIGURATOR_ACTION) {\n        // Selection\n        PIVOT_CONFIGURATOR_ACTION[\"toggleSelection\"] = \"PIVOT_CONFIGURATOR_ACTION_TOGGLE_SELECTION\";\n        PIVOT_CONFIGURATOR_ACTION[\"addColumnAxis\"] = \"PIVOT_CONFIGURATOR_ACTION_ADD_COLUMN_AXIS\";\n        PIVOT_CONFIGURATOR_ACTION[\"addColumnAxes\"] = \"PIVOT_CONFIGURATOR_ACTION_ADD_COLUMN_AXES\";\n        PIVOT_CONFIGURATOR_ACTION[\"removeColumnAxis\"] = \"PIVOT_CONFIGURATOR_ACTION_REMOVE_COLUMN_AXIS\";\n        PIVOT_CONFIGURATOR_ACTION[\"removeColumnAxes\"] = \"PIVOT_CONFIGURATOR_ACTION_REMOVE_COLUMN_AXES\";\n        PIVOT_CONFIGURATOR_ACTION[\"addRowAxis\"] = \"PIVOT_CONFIGURATOR_ACTION_ADD_ROW_AXIS\";\n        PIVOT_CONFIGURATOR_ACTION[\"addRowAxes\"] = \"PIVOT_CONFIGURATOR_ACTION_ADD_ROW_AXES\";\n        PIVOT_CONFIGURATOR_ACTION[\"removeRowAxis\"] = \"PIVOT_CONFIGURATOR_ACTION_REMOVE_ROW_AXIS\";\n        PIVOT_CONFIGURATOR_ACTION[\"removeRowAxes\"] = \"PIVOT_CONFIGURATOR_ACTION_REMOVE_ROW_AXES\";\n        PIVOT_CONFIGURATOR_ACTION[\"addMeasureAxis\"] = \"PIVOT_CONFIGURATOR_ACTION_ADD_MEASURE_AXIS\";\n        PIVOT_CONFIGURATOR_ACTION[\"addMeasureAxes\"] = \"PIVOT_CONFIGURATOR_ACTION_ADD_MEASURE_AXES\";\n        PIVOT_CONFIGURATOR_ACTION[\"removeMeasureAxis\"] = \"PIVOT_CONFIGURATOR_ACTION_REMOVE_MEASURE_AXIS\";\n        PIVOT_CONFIGURATOR_ACTION[\"removeMeasureAxes\"] = \"PIVOT_CONFIGURATOR_ACTION_REMOVE_MEASURE_AXES\";\n        // Removal\n        PIVOT_CONFIGURATOR_ACTION[\"remove\"] = \"PIVOT_CONFIGURATOR_ACTION_REMOVE\";\n        // Sort\n        PIVOT_CONFIGURATOR_ACTION[\"setSort\"] = \"PIVOT_CONFIGURATOR_ACTION_SET_SORT\";\n        // Filter\n        PIVOT_CONFIGURATOR_ACTION[\"setFilter\"] = \"PIVOT_CONFIGURATOR_ACTION_SET_FILTER\";\n        PIVOT_CONFIGURATOR_ACTION[\"addFilter\"] = \"PIVOT_CONFIGURATOR_ACTION_ADD_FILTER\";\n        PIVOT_CONFIGURATOR_ACTION[\"changeFilter\"] = \"PIVOT_CONFIGURATOR_ACTION_CHANGE_FILTER\";\n        PIVOT_CONFIGURATOR_ACTION[\"removeFilter\"] = \"PIVOT_CONFIGURATOR_ACTION_REMOVE_FILTER\";\n        // Drag\n        PIVOT_CONFIGURATOR_ACTION[\"setDragItem\"] = \"PIVOT_CONFIGURATOR_ACTION_SET_DRAGITEM\";\n        PIVOT_CONFIGURATOR_ACTION[\"drop\"] = \"PIVOT_CONFIGURATOR_ACTION_DROP\";\n        PIVOT_CONFIGURATOR_ACTION[\"setDropZone\"] = \"PIVOT_CONFIGURATOR_ACTION_SET_DROP_ZONE\";\n        PIVOT_CONFIGURATOR_ACTION[\"setDropTarget\"] = \"PIVOT_CONFIGURATOR_ACTION_SET_DROP_TARGET\";\n        PIVOT_CONFIGURATOR_ACTION[\"setDropDirection\"] = \"PIVOT_CONFIGURATOR_ACTION_SET_DROP_DIRECTION\";\n    })(exports.I || (exports.I = {}));\n    /**\n     * @hidden\n     */\n    var configuratorReducer = function (state, action) {\n        var newRows;\n        var newColumns;\n        var newMeasures;\n        var newSort;\n        var newFilter;\n        var newDragitem;\n        var newDropZone;\n        var newDropDirection;\n        var newDropTarget;\n        switch (action.type) {\n            case exports.I.toggleSelection: {\n                if (Array.isArray(action.payload)) {\n                    // TODO;\n                }\n                else {\n                    var payload_1 = action.payload;\n                    if (payload_1.type === 2 || 'aggregator' in payload_1) {\n                        if (state.measureAxes.some(function (s) { return compareAxisWithField(s, payload_1); })) {\n                            return configuratorReducer(state, __assign({}, action, { type: exports.I.removeMeasureAxis }));\n                        }\n                        else {\n                            return configuratorReducer(state, __assign({}, action, { type: exports.I.addMeasureAxis }));\n                        }\n                    }\n                    else if (payload_1.type === 'kpi') {\n                        var measures = buildKPIMeasures(payload_1);\n                        if (measures.every(function (m) { return state.measureAxes.some(function (s) { return compareAxisWithField(s, m); }); })) {\n                            return configuratorReducer(state, __assign({}, action, { type: exports.I.removeMeasureAxes, payload: measures }));\n                        }\n                        else {\n                            return configuratorReducer(state, __assign({}, action, { type: exports.I.addMeasureAxes, payload: measures.filter(function (m) { return !state.measureAxes.some(function (s) { return compareAxisWithField(s, m); }); }) }));\n                        }\n                    }\n                    else if (action.payload.kpi) {\n                        if (state.measureAxes.some(function (s) { return compareAxisWithField(s, payload_1); })) {\n                            return configuratorReducer(state, __assign({}, action, { type: exports.I.removeMeasureAxis }));\n                        }\n                        else {\n                            return configuratorReducer(state, __assign({}, action, { type: exports.I.addMeasureAxis }));\n                        }\n                    }\n                    else {\n                        if (state.columnAxes.some(function (s) { return compareAxisWithField(s, payload_1); })) {\n                            return configuratorReducer(state, __assign({}, action, { type: exports.I.removeColumnAxis }));\n                        }\n                        else if (state.rowAxes.some(function (s) { return compareAxisWithField(s, payload_1); })) {\n                            return configuratorReducer(state, __assign({}, action, { type: exports.I.removeRowAxis }));\n                        }\n                        else if ((state.columnAxes && state.columnAxes.length) && (!state.rowAxes || !state.rowAxes.length)) {\n                            return configuratorReducer(state, __assign({}, action, { type: exports.I.addRowAxis }));\n                        }\n                        else {\n                            return configuratorReducer(state, __assign({}, action, { type: exports.I.addColumnAxis }));\n                        }\n                    }\n                }\n                break;\n            }\n            case exports.I.addColumnAxis: {\n                newColumns = (state.columnAxes || []).concat([\n                    { name: [action.payload.defaultHierarchy || action.payload.uniqueName] }\n                ]);\n                break;\n            }\n            case exports.I.addColumnAxes: {\n                // TODO;\n                break;\n            }\n            case exports.I.removeColumnAxis: {\n                newColumns = (state.columnAxes || []).filter(function (s) { return !compareAxisWithField(s, action.payload); }).slice();\n                filterField(newColumns, action.payload);\n                break;\n            }\n            case exports.I.removeColumnAxes: {\n                // TODO;\n                break;\n            }\n            case exports.I.addRowAxis: {\n                newRows = (state.rowAxes || []).concat([\n                    { name: [action.payload.defaultHierarchy || action.payload.uniqueName] }\n                ]);\n                break;\n            }\n            case exports.I.addRowAxes: {\n                // TODO;\n                break;\n            }\n            case exports.I.removeRowAxis: {\n                newRows = (state.rowAxes || []).filter(function (s) { return !compareAxisWithField(s, action.payload); }).slice();\n                filterField(newRows, action.payload);\n                break;\n            }\n            case exports.I.removeRowAxes: {\n                // TODO;\n                break;\n            }\n            case exports.I.addMeasureAxis: {\n                newMeasures = (state.measureAxes || []).concat([\n                    { name: [action.payload.defaultHierarchy || action.payload.uniqueName] }\n                ]);\n                break;\n            }\n            case exports.I.removeMeasureAxis: {\n                newMeasures = (state.measureAxes || []).filter(function (s) { return !compareAxisWithField(s, action.payload); }).slice();\n                break;\n            }\n            case exports.I.addMeasureAxes: {\n                newMeasures = (state.measureAxes || []).concat((action.payload || []).map(function (p) { return ({ name: [p.defaultHierarchy || p.uniqueName] }); }));\n                break;\n            }\n            case exports.I.removeMeasureAxes: {\n                newMeasures = (state.measureAxes || []).filter(function (s) { return !action.payload.some(function (p) { return compareAxisWithField(s, p); }); }).slice();\n                break;\n            }\n            case exports.I.remove: {\n                if (state.columnAxes.some(function (s) { return compareAxes(s, action.payload); })) {\n                    newColumns = state.columnAxes.filter(function (s) { return !compareAxes(s, action.payload); }).slice();\n                    filterField(newColumns, { uniqueName: action.payload.name });\n                }\n                if (state.rowAxes.some(function (s) { return compareAxes(s, action.payload); })) {\n                    newRows = state.rowAxes.filter(function (s) { return !compareAxes(s, action.payload); }).slice();\n                    filterField(newRows, { uniqueName: action.payload.name });\n                }\n                if (state.measureAxes.some(function (s) { return compareAxes(s, action.payload); })) {\n                    newMeasures = state.measureAxes.filter(function (s) { return !compareAxes(s, action.payload); }).slice();\n                }\n                break;\n            }\n            case exports.I.setDragItem:\n                newDragitem = action.payload;\n                break;\n            case exports.I.setDropZone:\n                newDropZone = action.payload;\n                break;\n            case exports.I.setDropTarget:\n                newDropTarget = action.payload;\n                break;\n            case exports.I.setDropDirection:\n                newDropDirection = action.payload;\n                break;\n            case exports.I.drop:\n                if (state.dragItem && state.dropZone) {\n                    var currentColumn = state.columnAxes.find(function (s) { return compareAxes(s, action.payload); });\n                    var currentRow = state.rowAxes.find(function (s) { return compareAxes(s, action.payload); });\n                    var currentMeasure = state.measureAxes.find(function (s) { return compareAxes(s, action.payload); });\n                    var current = void 0;\n                    if (currentColumn) {\n                        current = currentColumn;\n                        newColumns = state.columnAxes.filter(function (s) { return !compareAxes(s, action.payload); }).slice();\n                        filterField(newColumns, { uniqueName: action.payload.name });\n                    }\n                    if (currentRow) {\n                        current = currentRow;\n                        newRows = state.rowAxes.filter(function (s) { return !compareAxes(s, action.payload); }).slice();\n                        filterField(newRows, { uniqueName: action.payload.name });\n                    }\n                    if (currentMeasure) {\n                        current = currentMeasure;\n                        newMeasures = state.measureAxes.filter(function (s) { return !compareAxes(s, action.payload); }).slice();\n                    }\n                    switch (state.dropZone) {\n                        case 'columnAxes': {\n                            newColumns = newColumns || state.columnAxes.slice();\n                            insertAxis(newColumns, current, state);\n                            break;\n                        }\n                        case 'rowAxes': {\n                            newRows = newRows || state.rowAxes.slice();\n                            insertAxis(newRows, current, state);\n                            break;\n                        }\n                        case 'measureAxes': {\n                            newMeasures = newMeasures || state.measureAxes.slice();\n                            insertAxis(newMeasures, current, state);\n                            break;\n                        }\n                        default:\n                            break;\n                    }\n                }\n                newDragitem = null;\n                newDropZone = null;\n                newDropTarget = null;\n                break;\n            case exports.I.setSort:\n                newSort = action.payload;\n                break;\n            case exports.I.setFilter:\n                if (Array.isArray(action.payload)) {\n                    newFilter = action.payload;\n                }\n                else {\n                    newFilter = [action.payload];\n                }\n                break;\n            case exports.I.addFilter:\n                newFilter = (state.filter || []).slice();\n                if (Array.isArray(action.payload)) {\n                    newFilter.push.apply(newFilter, action.payload);\n                }\n                else {\n                    newFilter.push(action.payload);\n                }\n                break;\n            case exports.I.changeFilter:\n                newFilter = (Array.isArray(action.payload)\n                    ? (state.filter || []).map(function (f) { return action.payload.some(function (a) { return a.field === f.field; })\n                        ? action.payload.find(function (a) { return a.field === f.field; })\n                        : f; })\n                    : (state.filter || []).map(function (f) { return f.field === action.payload.field\n                        ? action.payload\n                        : f; }));\n                break;\n            case exports.I.removeFilter:\n                newFilter = (state.filter || []).slice();\n                if (Array.isArray(action.payload)) {\n                    newFilter = newFilter.filter(function (f) { return !action.payload.some(function (p) { return p.field === f.field &&\n                        p.operator === f.operator; }); });\n                }\n                else {\n                    newFilter = newFilter.filter(function (f) { return !(f.field === action.payload.field\n                        && f.operator === action.payload.operator); });\n                }\n                break;\n            default:\n                break;\n        }\n        return {\n            dragItem: newDragitem,\n            dropTarget: newDropTarget,\n            dropDirection: newDropDirection,\n            dropZone: newDropZone,\n            columnAxes: newColumns,\n            rowAxes: newRows,\n            measureAxes: newMeasures,\n            filter: newFilter,\n            sort: newSort\n        };\n    };\n\n    // tslint:disable:object-literal-sort-keys\n    /**\n     * Represents the aggregate object which calculates the total value. Applicable for local data binding.\n     */\n    var sumAggregate = {\n        init: function (data) {\n            if (('sum' in data) === false) {\n                data.sum = 0;\n            }\n        },\n        merge: function (src, dest) {\n            dest.sum += src.sum;\n        },\n        accumulate: function (acc, value) {\n            acc.sum += value;\n        },\n        result: function (data) { return data.sum; },\n        format: function (value) { return value.toFixed(2); }\n    };\n    /**\n     * Represents the aggregate object which calculates the count value. Applicable for local data binding.\n     */\n    var countAggregate = {\n        init: function (data) {\n            if (('countA' in data) === false) {\n                data.countA = 0;\n            }\n        },\n        merge: function (src, dest) {\n            dest.countA += src.countA;\n        },\n        accumulate: function (acc, _value) {\n            acc.countA += 1;\n        },\n        result: function (data) { return data.countA; },\n        format: function (value) { return value.toFixed(); }\n    };\n    /**\n     * Represents the aggregate object which calculates the minimum value. Applicable for local data binding.\n     */\n    var minAggregate = {\n        init: function (data) {\n            if (('min' in data) === false) {\n                data.min = Number.POSITIVE_INFINITY;\n            }\n        },\n        merge: function (src, dest) {\n            dest.min = Math.min(src.min, dest.min);\n        },\n        accumulate: function (acc, value) {\n            acc.min = Math.min(value, acc.min);\n        },\n        result: function (data) { return Number.isFinite(data.min) ? data.min : NaN; },\n        format: function (value) { return value.toFixed(2); }\n    };\n    /**\n     * Represents the aggregate object which calculates the maximum value. Applicable for local data binding.\n     */\n    var maxAggregate = {\n        init: function (data) {\n            if (('max' in data) === false) {\n                data.max = Number.NEGATIVE_INFINITY;\n            }\n        },\n        merge: function (src, dest) {\n            dest.max = Math.max(src.max, dest.max);\n        },\n        accumulate: function (acc, value) {\n            acc.max = Math.max(value, acc.max);\n        },\n        result: function (data) { return Number.isFinite(data.max) ? data.max : NaN; },\n        format: function (value) { return value.toFixed(2); }\n    };\n    /**\n     * Represents the aggregate object which calculates the average value. Applicable for local data binding.\n     */\n    var averageAggregate = {\n        init: function (data) {\n            if (('count' in data) === false) {\n                data.sumA = 0;\n                data.count = 0;\n            }\n        },\n        merge: function (src, dest) {\n            dest.sumA += src.sumA;\n            dest.count += src.count;\n        },\n        accumulate: function (acc, value) {\n            acc.sumA += value;\n            acc.count += 1;\n        },\n        result: function (data) { return data.sumA / data.count; },\n        format: function (value) { return value.toFixed(2); }\n    };\n\n    function forEachDesc(desc, callbackfn) {\n        if ('filters' in desc) {\n            desc.filters.map(function (child) { return forEachDesc(child, callbackfn); });\n        }\n        else {\n            callbackfn(desc);\n        }\n    }\n    var filterFields = function (filter, callback) {\n        var descriptors = Array.isArray(filter) ? filter : filter.filters;\n        descriptors.forEach(function (desc) { return forEachDesc(desc, callback); });\n    };\n    /** @hidden */\n    var initializeFiltering = function (rows, columns, filter) {\n        var compositeFilter = filter ?\n            (Array.isArray(filter) ? { logic: 'and', filters: filter } : filter) : undefined;\n        var predicate = compositeFilter ? kendo_dataQuery_cmn_chunk_js.c(compositeFilter) : function () { return true; };\n        var axes = rows.concat(columns);\n        var fieldValues = [];\n        filterFields(filter || [], function (desc) {\n            if ('field' in desc && desc.field) {\n                fieldValues.push(desc.field);\n            }\n        });\n        var result = { hasFilter: false, predicate: predicate, filteringAxes: [] };\n        if (fieldValues.some(function (f) { return typeof f === 'function'; })) {\n            result.filteringAxes = axes.slice();\n        }\n        else if (fieldValues.length > 0) {\n            var filteringFields_1 = Array.from(new Set(fieldValues).values());\n            var filteringAxes = axes.filter(function (a) { return filteringFields_1.indexOf(a.key) >= 0; });\n            result.filteringAxes = filteringAxes;\n        }\n        result.hasFilter = result.filteringAxes.length > 0;\n        return result;\n    };\n\n    /** @hidden */\n    var subNode = function (node, field, initialNode) {\n        var childNode = node.get(field);\n        if (!childNode) {\n            childNode = initialNode || new Map();\n            node.set(field, childNode);\n        }\n        return childNode;\n    };\n    var separator = '&';\n    /** @hidden */\n    var createKey = function (key, value) { return key + separator + value; };\n    /** @hidden */\n    var splitKeyValue = function (keyValue) {\n        var separatorIndex = keyValue.indexOf(separator);\n        if (separatorIndex !== -1) {\n            var key = keyValue.substring(0, separatorIndex);\n            var value = keyValue.substring(separatorIndex + 1);\n            return [key, value];\n        }\n        else {\n            return [keyValue, undefined];\n        }\n    };\n\n    var calculateColumnData = function (node, measures, dataField) {\n        node.forEach(function (childNode, k) {\n            if (k !== dataField) {\n                if (childNode.size > 0) {\n                    calculateColumnData(childNode, measures, dataField);\n                }\n                var childData_1 = childNode.get(dataField);\n                var parentData_1 = subNode(node, dataField, {});\n                measures.forEach(function (m) {\n                    m.aggregate.init(parentData_1);\n                    m.aggregate.merge(childData_1, parentData_1);\n                });\n            }\n        });\n    };\n    /** @hidden */\n    var mergeTrees = function (src, dest, measures, dataField) {\n        src.forEach(function (srcChild, k) {\n            var destChild;\n            if (k !== dataField) {\n                destChild = subNode(dest, k);\n                mergeTrees(srcChild, destChild, measures, dataField);\n            }\n            else {\n                destChild = subNode(dest, k, {});\n                measures.forEach(function (m) {\n                    m.aggregate.init(destChild);\n                    m.aggregate.merge(srcChild, destChild);\n                });\n            }\n        });\n    };\n    var calculateColumns = function (node, measures, columnsData, dataField) {\n        node.forEach(function (childNode, k) {\n            if (k !== columnsData) {\n                if (childNode.size > 0) {\n                    calculateColumns(childNode, measures, columnsData, dataField);\n                }\n                var srcColumns = subNode(childNode, columnsData);\n                var destColumns = subNode(node, columnsData);\n                mergeTrees(srcColumns, destColumns, measures, dataField);\n            }\n        });\n    };\n    /** @hidden */\n    var createDataTree = function (data, rows, columns, measures, fields, filter) {\n        var result = new Map();\n        var cache = new Map();\n        var axes = rows.concat(columns);\n        var leafNodes = new Set();\n        var dataField = fields.dataField, columnsData = fields.columnsData;\n        var _a = initializeFiltering(rows, columns, filter), hasFilter = _a.hasFilter, predicate = _a.predicate, filteringAxes = _a.filteringAxes;\n        var empty = '';\n        data.forEach(function (dataItem) {\n            if (hasFilter) {\n                var filteringDataItem_1 = {};\n                filteringAxes.forEach(function (axis) { filteringDataItem_1[axis.key] = axis.displayValue(dataItem); });\n                if (!predicate(filteringDataItem_1)) {\n                    return;\n                }\n            }\n            var values = axes.map(function (a) { return a.displayValue(dataItem); });\n            var dataKey = empty.concat.apply(empty, values);\n            var nodeData = cache.get(dataKey);\n            if (!nodeData) {\n                var node_1 = result;\n                var eachAxis = function (axis) {\n                    node_1 = subNode(node_1, createKey(axis.key, axis.displayValue(dataItem)));\n                };\n                rows.forEach(eachAxis);\n                node_1 = subNode(node_1, columnsData);\n                leafNodes.add(node_1);\n                columns.forEach(eachAxis);\n                nodeData = {};\n                node_1.set(dataField, nodeData);\n                cache.set(dataKey, nodeData);\n                measures.forEach(function (m) {\n                    m.aggregate.init(nodeData);\n                });\n            }\n            measures.forEach(function (m) {\n                m.aggregate.accumulate(nodeData, m.value(dataItem));\n            });\n        });\n        leafNodes.forEach(function (leaf) { return calculateColumnData(leaf, measures, dataField); });\n        calculateColumns(result, measures, columnsData, dataField);\n        return result;\n    };\n    /** @hidden */\n    var cloneDataTree = function (dataTree, dataField, measures) {\n        var result = new Map();\n        mergeTrees(dataTree, result, measures, dataField);\n        return result;\n    };\n\n    var createPath = function (name, axes, path) {\n        var _a = splitKeyValue(name), key = _a[0], value = _a[1];\n        var result = path.slice();\n        if (key && value) {\n            var axis = axes.find(function (a) { return a.key === key; });\n            var caption_1 = axis ? axis.caption : '';\n            return result.map(function (p) { return p === caption_1 ? name : p; });\n        }\n        return result;\n    };\n    var membersNode = function (tree, members, field, axisSettings, measures, dataField, cache) {\n        var cacheData = cache || new Map();\n        var path = axisSettings.map(function (a) { return a.caption; });\n        while (members.length > 1 && axisSettings.some(function (a) { return a.caption === members[members.length - 1].caption; })) {\n            members.pop();\n            path.pop();\n        }\n        var node = tree;\n        members.forEach(function (m, i) {\n            path = createPath(m.name, axisSettings, path);\n            if (node && !axisSettings.some(function (a) { return a.caption === m.name; })) {\n                if (!node.has(m.name) && !cacheData.has(path.slice(0, path.indexOf(m.name) + 1).join('-'))) {\n                    var currentLevel = Array.from(node).find(function (n) { return n[0] !== field; });\n                    var currentLevelNode = currentLevel && currentLevel[0];\n                    var levelField_1 = currentLevelNode && splitKeyValue(currentLevelNode)[0];\n                    var depth = levelField_1 ? i - axisSettings.findIndex(function (a) { return a.key === levelField_1; }) : 0;\n                    var _loop_1 = function (t) {\n                        var data = [];\n                        node.forEach(function (value, key) {\n                            if (key !== field) {\n                                data.push.apply(data, Array.from(value).filter(function (d) { return d[0] !== field; }));\n                            }\n                        });\n                        var next = new Map();\n                        data.forEach(function (item) {\n                            if (next.has(item[0])) {\n                                var dest = next.get(item[0]);\n                                var src = item[1];\n                                var newDest = new Map();\n                                mergeTrees(dest, newDest, measures, dataField);\n                                mergeTrees(src, newDest, measures, dataField);\n                                next.set(item[0], newDest);\n                            }\n                            else {\n                                next.set(item[0], new Map(item[1]));\n                            }\n                        });\n                        var currentPath = path.slice(0, path.indexOf(m.name));\n                        next.forEach(function (value, key) {\n                            cacheData.set(createPath(key, axisSettings, currentPath.concat([key])).join('-'), value);\n                        });\n                        next.set(field, node.get(field));\n                        node = next;\n                    };\n                    for (var t = 0; t < depth; t++) {\n                        _loop_1(t);\n                    }\n                }\n                node = node.get(m.name) || cacheData.get(path.slice(0, path.indexOf(m.name) + 1).join('-'));\n            }\n        });\n        return node;\n    };\n    /** @hidden */\n    var readData = function (dataTree, rowTuples, columnTuples, fields, columnSettings, rowSettings, measures) {\n        var data = [];\n        var dataField = fields.dataField, columnsData = fields.columnsData;\n        var rowsCache = new Map();\n        rowTuples.forEach(function (row) {\n            var rowNode = membersNode(dataTree, row.members.slice(), columnsData, rowSettings, measures, dataField, rowsCache);\n            var rowColumnsNode = rowNode && rowNode.get(columnsData);\n            columnTuples.forEach(function (col) {\n                var members = col.members.slice();\n                var measure = measures[0];\n                if (members[members.length - 1].levelName === \"[Measures].[MeasuresLevel]\") {\n                    var measuresMember_1 = members.pop();\n                    measure = measures.find(function (m) { return String(m.name) === measuresMember_1.caption; }) || measure;\n                }\n                var colNode = rowColumnsNode && membersNode(rowColumnsNode, members, dataField, columnSettings, measures, dataField);\n                var value = '', fmtValue = '', ordinal = 0;\n                if (colNode && measure) {\n                    var result = measure.aggregate.result(colNode.get(dataField));\n                    value = String(result);\n                    fmtValue = measure.aggregate.format(result);\n                }\n                data.push({\n                    columnTuple: col,\n                    data: { fmtValue: fmtValue, ordinal: ordinal, value: value },\n                    rowTuple: row\n                });\n            });\n        });\n        return data;\n    };\n\n    var getTopMembersTuple = function (parentFields, axesSettings) {\n        var allTuple = { members: [] };\n        parentFields.forEach(function (topField) {\n            var axis = axesSettings.find(function (a) { return a.key === topField; });\n            var caption = axis ? axis.caption : \"\";\n            var member = {\n                caption: caption,\n                children: [],\n                hasChildren: true,\n                parentName: \"\",\n                levelNum: 0,\n                levelName: caption,\n                hierarchy: topField,\n                name: caption\n            };\n            allTuple.members.push(member);\n        });\n        return allTuple;\n    };\n    var sortFunc = function (descriptor, axe) {\n        return function (a, b) {\n            var order = descriptor.dir;\n            var sortableA = axe.sortValue(splitKeyValue(a[0])[1]);\n            var sortableB = axe.sortValue(splitKeyValue(b[0])[1]);\n            if (sortableA < sortableB) {\n                return order === \"asc\" ? -1 : 1;\n            }\n            if (sortableA > sortableB) {\n                return order === \"asc\" ? 1 : -1;\n            }\n            return 0;\n        };\n    };\n    var mergeData = function (src, dest, exclude) {\n        src.forEach(function (srcChild, k) {\n            if (!exclude[k]) {\n                var destChild = subNode(dest, k);\n                mergeData(srcChild, destChild, exclude);\n            }\n        });\n    };\n    var childrenByKeys = function (dataTree, keys, exclude) {\n        var result = [];\n        var nodeData = function (node) { return Array.from(node).filter(function (n) { return !exclude[n[0]]; }); };\n        var element = new Map(dataTree);\n        var next;\n        var _loop_1 = function (i) {\n            next = element.get(keys[i]);\n            if (next) {\n                element = new Map(next);\n            }\n            else if (i < keys.length - 1 && Array.from(element).some(function (e) { return splitKeyValue(e[0])[0] === keys[i]; })) {\n                var curLevel_1 = [];\n                element.forEach(function (child, key) {\n                    if (!exclude[key]) {\n                        curLevel_1.push.apply(curLevel_1, nodeData(new Map(child)));\n                    }\n                });\n                element = new Map();\n                curLevel_1.forEach(function (item) {\n                    if (element.has(item[0])) {\n                        var dest = element.get(item[0]);\n                        var src = item[1];\n                        var newDest = new Map();\n                        mergeData(dest, newDest, exclude);\n                        mergeData(src, newDest, exclude);\n                        element.set(item[0], newDest);\n                    }\n                    else {\n                        element.set(item[0], new Map(item[1]));\n                    }\n                });\n            }\n            else if (i === 0 || i === keys.length - 1) {\n                if (Array.from(element).some(function (e) { return splitKeyValue(e[0])[0] === keys[i]; })) {\n                    result.push.apply(result, nodeData(element));\n                }\n            }\n        };\n        for (var i = 0; i < keys.length; i++) {\n            _loop_1(i);\n        }\n        return result;\n    };\n    /** @hidden */\n    var rootFields = function (definitions) {\n        var fields = new Set();\n        definitions.forEach(function (item) {\n            if (item.name.length === 1 && !splitKeyValue(item.name[0])[1]) {\n                fields.add(item.name[0]);\n            }\n        });\n        return fields;\n    };\n    /** @hidden */\n    var createTuples = function (axesSettings, definitions, dataTree, sortDescriptors, excludeFields) {\n        var parentFields = rootFields(definitions);\n        var flatMembers = [];\n        var topTuple = getTopMembersTuple(parentFields, axesSettings);\n        flatMembers.push(topTuple);\n        var _loop_2 = function (i) {\n            var currDef = definitions[i];\n            if (currDef.name.length === 1 && !currDef.expand && parentFields.has(currDef.name[0])) {\n                return \"continue\";\n            }\n            var keysToAdd = new Set(parentFields.keys());\n            var currDefMembers = [];\n            var keys = [];\n            var tuples = [];\n            var axe;\n            currDef.name.forEach(function (element, index) {\n                var _a;\n                var _b = splitKeyValue(element), field = _b[0], value = _b[1];\n                axe = axesSettings.find(function (a) { return a.key === field; });\n                if (value) {\n                    keysToAdd.delete(field);\n                    keys.push(element);\n                    var member = {\n                        children: [],\n                        caption: value,\n                        hierarchy: field,\n                        levelNum: 1,\n                        levelName: field + \" \" + field,\n                        name: element,\n                        parentName: axe ? axe.caption : \"\"\n                    };\n                    currDefMembers.push(member);\n                }\n                else if (currDef.expand && currDef.name.length - 1 === index) {\n                    keysToAdd.delete(element);\n                    keys.push(element);\n                    var children = childrenByKeys(dataTree, keys, excludeFields);\n                    var descriptor = sortDescriptors.find(function (desc) { return desc.field === field; });\n                    if (descriptor && descriptor.dir) {\n                        children.sort(sortFunc(descriptor, axe));\n                    }\n                    for (var c = 0; c < children.length; c++) {\n                        var leafValue = children[c][0];\n                        var leafTuple = { members: [] };\n                        tuples.push(leafTuple);\n                        var caption = splitKeyValue(leafValue)[1];\n                        axe = axesSettings.find(function (a) { return a.key === element; });\n                        var member = {\n                            caption: caption,\n                            children: [],\n                            levelName: element + \" \" + element,\n                            levelNum: 1,\n                            parentName: axe ? axe.caption : \"\",\n                            hierarchy: element,\n                            name: leafValue\n                        };\n                        (_a = leafTuple.members).push.apply(_a, currDefMembers);\n                        leafTuple.members.push(member);\n                    }\n                }\n                else if (currDef.expand) {\n                    axe = axesSettings.find(function (a) { return a.key === element; });\n                    var axisCaption = axe ? axe.caption : \"\";\n                    keysToAdd.delete(element);\n                    keys.push(element);\n                    var member = {\n                        children: [],\n                        caption: axisCaption,\n                        hierarchy: element,\n                        levelName: axisCaption,\n                        levelNum: 0,\n                        name: axisCaption,\n                        parentName: \"\"\n                    };\n                    currDefMembers.push(member);\n                }\n                keysToAdd.forEach(function (key) {\n                    tuples.forEach(function (tuple) {\n                        axe = axesSettings.find(function (a) { return a.key === key; });\n                        var curCaption = axe ? axe.caption : \"\";\n                        var member = {\n                            children: [],\n                            hasChildren: true,\n                            caption: curCaption,\n                            hierarchy: key,\n                            levelName: curCaption,\n                            levelNum: 0,\n                            name: curCaption,\n                            parentName: \"\"\n                        };\n                        tuple.members.push(member);\n                    });\n                });\n                flatMembers.push.apply(flatMembers, tuples);\n            });\n        };\n        for (var i = 0; i < definitions.length; i++) {\n            _loop_2(i);\n        }\n        return flatMembers;\n    };\n    var measureToMember = function (measure) {\n        return {\n            caption: String(measure.name),\n            children: [],\n            hasChildren: false,\n            hierarchy: \"[Measures]\",\n            levelName: \"[Measures].[MeasuresLevel]\",\n            levelNum: 0,\n            name: \"[Measures].[\" + measure.name + \"]\",\n            parentName: \"\"\n        };\n    };\n    var addMeasure = function (tuple, measure) {\n        var measureMember = measureToMember(measure);\n        var tupleCopy = copy(tuple);\n        tupleCopy.members.push(measureMember);\n        return tupleCopy;\n    };\n    /** @hidden */\n    var addMultipleMeasures = function (tuples, measures) {\n        if (measures.length < 2) {\n            return tuples;\n        }\n        var result = tuples.slice();\n        for (var i = result.length - 1; i >= 0; i--) {\n            var tuple = result[i];\n            result[i] = addMeasure(result[i], measures[0]);\n            for (var m = 1; m < measures.length; m++) {\n                var tupleWithMeasure = addMeasure(tuple, measures[m]);\n                result.splice(i + m, 0, tupleWithMeasure);\n            }\n        }\n        return reverseColumnsByMeasures(result);\n    };\n    /** @hidden */\n    var createLocalDataState = function (args) {\n        var _a;\n        var dataTree = args.dataTree, rowSettings = args.rowSettings, columnSettings = args.columnSettings, rowAxes = args.rowAxes, columnAxes = args.columnAxes, measures = args.measures, sort = args.sort, fields = args.fields;\n        var exclude = (_a = {}, _a[fields.columnsData] = fields.columnsData, _a[fields.dataField] = fields.dataField, _a);\n        var colTuples = columnAxes.length ?\n            createTuples(columnSettings, columnAxes, dataTree.get(fields.columnsData), sort, exclude) :\n            measures.map(function (m) { return ({ members: [measureToMember(m)] }); });\n        var columnTuples = columnAxes.length > 0 ? addMultipleMeasures(colTuples, measures) : colTuples;\n        var rowTuples = rowAxes.length ? createTuples(rowSettings, rowAxes, dataTree, sort, exclude) : [{ members: [] }];\n        var resultData = readData(dataTree, rowTuples, columnTuples, fields, columnSettings, rowSettings, measures);\n        return {\n            columns: columnTuples,\n            data: resultData,\n            rows: rowTuples\n        };\n    };\n\n    /** @hidden */\n    var createFlatSchemaDimensions = function (dimensions, measures) {\n        var result = Object.keys(dimensions).map(function (dim) { return ({\n            caption: dim,\n            defaultHierarchy: dim,\n            description: '',\n            name: dim,\n            uniqueName: dim,\n            hierarchyUniqueName: dim,\n            measure: true,\n            type: 1 // https://github.com/telerik/kendo-pivotgrid-common/blob/develop/src/models/responseDiscover.ts#L12-L14\n        }); });\n        if (measures.length) {\n            result.push({\n                caption: 'Measures',\n                children: measures.map(function (m) { return ({\n                    aggregator: '1',\n                    caption: String(m.name),\n                    defaultFormat: '',\n                    description: '',\n                    displayFolder: '',\n                    groupName: String(m.name),\n                    name: String(m.name),\n                    uniqueName: String(m.name)\n                }); }),\n                type: 2,\n                description: '',\n                name: 'Measures',\n                uniqueName: '[Measures]'\n            });\n        }\n        return result;\n    };\n\n    var Navigation = /** @class */ (function () {\n        function Navigation(options) {\n            this.tabIndex = 0;\n            this.root = null;\n            this.eventHandlers = {};\n            this.update = function () { };\n            this.tabIndex = options.tabIndex;\n        }\n        Object.defineProperty(Navigation.prototype, \"elements\", {\n            get: function () {\n                return this.root ? Array.from(this.root.querySelectorAll(this.selectors.join(','))) : [];\n            },\n            enumerable: true,\n            configurable: true\n        });\n        Object.defineProperty(Navigation.prototype, \"first\", {\n            get: function () {\n                return (this.root && this.root.querySelector(this.selectors.join(','))) || null;\n            },\n            enumerable: true,\n            configurable: true\n        });\n        Object.defineProperty(Navigation.prototype, \"last\", {\n            get: function () {\n                var all = this.elements;\n                return all[all.length - 1] || null;\n            },\n            enumerable: true,\n            configurable: true\n        });\n        Object.defineProperty(Navigation.prototype, \"current\", {\n            get: function () {\n                return this.elements.find(function (el) { return el.matches(':focus'); });\n            },\n            enumerable: true,\n            configurable: true\n        });\n        Navigation.prototype.start = function (root) {\n            var _this = this;\n            this.root = root;\n            var _loop_1 = function (eventType) {\n                if (this_1.mouseEvents[eventType]) {\n                    this_1.eventHandlers[eventType] = (function (ev) {\n                        var target = ev.target instanceof Element && ev.target.closest(_this.selectors.join(','));\n                        if (target) {\n                            _this.mouseEvents[eventType].call(undefined, target, _this, ev);\n                        }\n                    });\n                    root.addEventListener(eventType, this_1.eventHandlers[eventType]);\n                }\n            };\n            var this_1 = this;\n            for (var eventType in this.mouseEvents) {\n                _loop_1(eventType);\n            }\n            var _loop_2 = function (eventType) {\n                if (this_2.keyboardEvents[eventType]) {\n                    this_2.eventHandlers[eventType] = (function (ev) {\n                        var target = ev.target instanceof Element && ev.target.closest(_this.selectors.join(','));\n                        var key = ev.key === ' ' ? 'Space' : ev.key;\n                        if (target && _this.keyboardEvents[eventType][key]) {\n                            _this.keyboardEvents[eventType][key].call(undefined, target, _this, ev);\n                        }\n                    });\n                    root.addEventListener(eventType, this_2.eventHandlers[eventType]);\n                }\n            };\n            var this_2 = this;\n            for (var eventType in this.keyboardEvents) {\n                _loop_2(eventType);\n            }\n        };\n        Navigation.prototype.stop = function () {\n            if (this.root) {\n                for (var eventType in this.eventHandlers) {\n                    if (this.eventHandlers[eventType]) {\n                        this.root.removeEventListener(eventType, this.eventHandlers[eventType]);\n                    }\n                }\n            }\n            this.root = null;\n        };\n        Navigation.prototype.focusElement = function (element, previous) {\n            if (element) {\n                if (previous) {\n                    previous.removeAttribute('tabindex');\n                    previous.classList.remove('k-focus');\n                }\n                element.setAttribute('tabindex', String(this.tabIndex));\n                element.focus({ preventScroll: true });\n            }\n        };\n        return Navigation;\n    }());\n\n    var scrollableValuesSel = '.k-pivotgrid .k-pivotgrid-values';\n    var scrollableColumnHeaderSel = '.k-pivotgrid .k-pivotgrid-column-headers';\n    var scrollableRowHeaderSel = '.k-pivotgrid .k-pivotgrid-row-headers';\n    var emptyCellSel = '.k-pivotgrid > .k-pivotgrid-empty-cell';\n    var tableSel = 'table.k-pivotgrid-table';\n    var cellSel = '.k-pivotgrid-cell';\n    var scrollables = [scrollableValuesSel, scrollableColumnHeaderSel, scrollableRowHeaderSel].join(',');\n    var selectors$1 = [\n        emptyCellSel,\n        [scrollableColumnHeaderSel, tableSel, cellSel].join(' '),\n        [scrollableRowHeaderSel, tableSel, cellSel].join(' '),\n        [scrollableValuesSel, tableSel, cellSel].join(' ')\n    ];\n    var onEnter = function (target, nav, ev) {\n        var icon = target.querySelector('.k-icon, .k-svg-icon');\n        if (icon) {\n            var index_1 = nav.elements.indexOf(target);\n            nav.update = function () {\n                nav.focusElement(nav.elements[index_1], null);\n                nav.update = function () { };\n            };\n            icon.click();\n            ev.preventDefault();\n        }\n    };\n    var tryScrollLeft = function (target, scrollable, elToScroll) {\n        if (target.offsetLeft < scrollable.scrollLeft) {\n            elToScroll.scrollLeft = target.offsetLeft;\n        }\n    };\n    var tryScrollRight = function (target, scrollable, elToScroll) {\n        if (target.offsetLeft + target.offsetWidth > scrollable.scrollLeft + scrollable.offsetWidth &&\n            target.offsetWidth < scrollable.offsetWidth) {\n            elToScroll.scrollLeft = target.offsetLeft + target.offsetWidth - scrollable.offsetWidth;\n        }\n    };\n    var tryScrollUp = function (target, scrollable, elToScroll) {\n        if (scrollable.scrollTop && target.offsetTop < scrollable.scrollTop) {\n            elToScroll.scrollTop = target.offsetTop;\n        }\n    };\n    var tryScrollDown = function (target, scrollable, elToScroll) {\n        if (target.offsetTop + target.offsetHeight > scrollable.scrollTop + scrollable.offsetHeight &&\n            target.offsetHeight < scrollable.offsetHeight) {\n            elToScroll.scrollTop = target.offsetTop + target.offsetHeight - scrollable.offsetHeight;\n        }\n    };\n    var scrollTo = function (target, root, scrollFunc) {\n        var elToScroll = root.querySelector(scrollableValuesSel);\n        var scrollable = target && target.closest(scrollables);\n        if (!elToScroll || !scrollable || !target) {\n            return;\n        }\n        scrollFunc.forEach(function (scroll) { return scroll(target, scrollable, elToScroll); });\n    };\n    var tableMap = function (table) {\n        var rows = Array.from(table.rows);\n        var colsCount = Array.from((rows && rows[0] && rows[0].cells) || [])\n            .map(function (c) { return c.colSpan; })\n            .reduce(function (prev, cur) { return prev + cur; }, 0);\n        var map = rows.map(function () { return new Array(colsCount); });\n        rows.forEach(function (row, r) {\n            var curColSpan = 0;\n            Array.from(row.cells).forEach(function (c) {\n                for (var colSp = 0; colSp < c.colSpan; colSp++) {\n                    for (var rowSp = 0; rowSp < c.rowSpan; rowSp++) {\n                        var ind = map[r + rowSp].findIndex(function (val, curInd) { return curInd >= curColSpan && !val; });\n                        map[r + rowSp][ind] = c;\n                    }\n                    curColSpan++;\n                }\n            });\n        });\n        return map;\n    };\n    var navigationMap = function (root) {\n        var columnHeader = tableMap(root.querySelector([scrollableColumnHeaderSel, tableSel].join(' ')));\n        var rowHeader = tableMap(root.querySelector([scrollableRowHeaderSel, tableSel].join(' ')));\n        var values = tableMap(root.querySelector([scrollableValuesSel, tableSel].join(' ')));\n        var emptyCell = root.querySelector(emptyCellSel);\n        var emptyCellRow = new Array(rowHeader[0].length).fill(emptyCell);\n        var map = [];\n        for (var i = 0; i < columnHeader.length; i++) {\n            map.push(emptyCellRow.concat(columnHeader[i]));\n        }\n        for (var i = 0; i < rowHeader.length; i++) {\n            map.push(rowHeader[i].concat(values[i]));\n        }\n        return map;\n    };\n    var getTargetPos = function (map, target) {\n        for (var r = 0; r < map.length; r++) {\n            for (var c = 0; c < map[r].length; c++) {\n                if (map[r][c] === target) {\n                    return [r, c];\n                }\n            }\n        }\n        return [-1, -1];\n    };\n    var ctrlKey = function (ev) { return ev.ctrlKey || ev.metaKey; };\n    var cellAt = function (root, target, pos) {\n        var map = navigationMap(root);\n        var targetPos = getTargetPos(map, target);\n        var nextPos = [targetPos[0] + pos[0], targetPos[1] + pos[1]];\n        var next = map[nextPos[0]] && map[nextPos[0]][nextPos[1]];\n        while (next && next === target) {\n            nextPos = [nextPos[0] + pos[0], nextPos[1] + pos[1]];\n            next = map[nextPos[0]] && map[nextPos[0]][nextPos[1]];\n        }\n        return next;\n    };\n    var keyboardEvents$1 = {\n        keydown: {\n            ArrowLeft: function (target, nav, ev) {\n                ev.preventDefault();\n                var next = cellAt(nav.root, target, [0, -1]);\n                nav.focusElement(next, target);\n                scrollTo(next, nav.root, [tryScrollRight, tryScrollLeft, tryScrollDown, tryScrollUp]);\n            },\n            ArrowRight: function (target, nav, ev) {\n                ev.preventDefault();\n                var next = cellAt(nav.root, target, [0, 1]);\n                nav.focusElement(next, target);\n                scrollTo(next, nav.root, [tryScrollLeft, tryScrollRight, tryScrollDown, tryScrollUp]);\n            },\n            ArrowUp: function (target, nav, ev) {\n                ev.preventDefault();\n                var next = cellAt(nav.root, target, [-1, 0]);\n                nav.focusElement(next, target);\n                scrollTo(next, nav.root, [tryScrollRight, tryScrollLeft, tryScrollDown, tryScrollUp]);\n            },\n            ArrowDown: function (target, nav, ev) {\n                ev.preventDefault();\n                var next = cellAt(nav.root, target, [1, 0]);\n                nav.focusElement(next, target);\n                scrollTo(next, nav.root, [tryScrollRight, tryScrollLeft, tryScrollUp, tryScrollDown]);\n            },\n            o: function (_target, nav, _ev) {\n                if (!nav.root) {\n                    return;\n                }\n                var next = nav.root.nextElementSibling;\n                if (next && next instanceof HTMLElement && next.matches('div.k-pivotgrid-configurator-button')) {\n                    next.click();\n                    setTimeout(function () {\n                        if (nav.root.parentNode) {\n                            var confHeader = nav.root.parentNode.querySelector('.k-pivotgrid-configurator-content .k-form-field .k-fields-list-wrapper .k-treeview');\n                            if (confHeader instanceof HTMLElement) {\n                                confHeader.setAttribute('tabindex', String(nav.tabIndex));\n                                confHeader.focus();\n                            }\n                        }\n                    }, 0);\n                }\n            },\n            Enter: onEnter,\n            Space: onEnter,\n            Home: function (target, nav, ev) {\n                var map = navigationMap(nav.root);\n                var ctrl = ctrlKey(ev);\n                var row = ctrl ? map[0] : (map.find(function (ro) { return Boolean(ro.find(function (x) { return x === target; })); }) || []);\n                var next = row[0];\n                if (next) {\n                    nav.focusElement(next, target);\n                    scrollTo(next, nav.root, [tryScrollRight, tryScrollLeft, tryScrollDown, tryScrollUp]);\n                    ev.preventDefault();\n                }\n            },\n            End: function (target, nav, ev) {\n                var map = navigationMap(nav.root);\n                var ctrl = ctrlKey(ev);\n                var row = ctrl ? map[map.length - 1] : (map.find(function (ro) { return Boolean(ro.find(function (x) { return x === target; })); }) || []);\n                var next = row && row[row.length - 1] || null;\n                if (next) {\n                    nav.focusElement(next, target);\n                    scrollTo(next, nav.root, [tryScrollLeft, tryScrollRight, tryScrollUp, tryScrollDown]);\n                    ev.preventDefault();\n                }\n            }\n        }\n    };\n    var mouseEvents$1 = {\n        click: function (target, nav) {\n            if (target && target instanceof HTMLElement) {\n                var prev = nav.elements.find(function (c) { return c.hasAttribute('tabindex'); }) || null;\n                nav.focusElement(target, prev);\n            }\n        }\n    };\n    /**\n     * The PivotGrid keyboard navigation functionality.\n     *\n     * Usage:\n     *\n     * On Initialize\n     * const navigation = new PivotGridNavigation({ tabindex: 0 });\n     *\n     * Turn on\n     * navigation.start(rootDomElement);\n     *\n     * On After Update\n     * navigation.update();\n     *\n     * On Destroy / Turn off\n     * navigation.stop();\n     */\n    var PivotGridNavigation = /** @class */ (function (_super) {\n        __extends(PivotGridNavigation, _super);\n        function PivotGridNavigation() {\n            var _this = _super !== null && _super.apply(this, arguments) || this;\n            _this.selectors = selectors$1;\n            _this.mouseEvents = mouseEvents$1;\n            _this.keyboardEvents = keyboardEvents$1;\n            return _this;\n        }\n        return PivotGridNavigation;\n    }(Navigation));\n\n    var selectors = [\n        '.k-pivotgrid-configurator-content .k-form-field .k-fields-list-wrapper .k-treeview',\n        '.k-pivotgrid-configurator-content .k-chip',\n        '.k-pivotgrid-configurator-actions button'\n    ];\n    var onEscape = function (_target, nav, ev) {\n        if (ev.target instanceof HTMLElement) {\n            if (nav.root) {\n                var pivot = nav.root.previousElementSibling;\n                var confButton = nav.root.nextElementSibling;\n                var pivotCell = Array.from(pivot instanceof HTMLElement ? pivot.querySelectorAll('[tabindex]') : []).find(function (c) { return c.tabIndex >= 0; });\n                if (pivotCell instanceof HTMLElement) {\n                    pivotCell.focus();\n                    if (confButton instanceof HTMLElement) {\n                        confButton.click();\n                    }\n                }\n            }\n        }\n    };\n    var navigate = function (target, nav, ev, dir) {\n        ev.preventDefault();\n        var all = nav.elements;\n        var index = all.indexOf(target) + dir;\n        if (index < 0) {\n            index = all.length - 1;\n        }\n        nav.focusElement(all[index % all.length], target);\n    };\n    var onDelete = function (target, nav, ev) {\n        if (ev.target instanceof HTMLElement) {\n            var deleteButton = ev.target.querySelector('.k-icon.k-i-x-circle, .k-svg-icon.k-svg-i-x-circle');\n            if (deleteButton instanceof HTMLElement) {\n                ev.preventDefault();\n                navigate(target, nav, ev, -1);\n            }\n        }\n    };\n    var keyboardEvents = {\n        keydown: {\n            Tab: function (target, nav, ev) {\n                navigate(target, nav, ev, ev.shiftKey ? -1 : 1);\n            },\n            Escape: onEscape,\n            Delete: onDelete,\n            Backspace: onDelete\n        }\n    };\n    var mouseEvents = {\n        click: function (target, nav) {\n            if (target && target instanceof HTMLElement) {\n                var prev = nav.elements.find(function (c) { return c.hasAttribute('tabindex'); }) || null;\n                nav.focusElement(target, prev);\n            }\n        }\n    };\n    /**\n     * The PivotGrid Configurator keyboard navigation functionality.\n     *\n     * Usage:\n     *\n     * On Initialize\n     * const navigation = new ConfiguratorNavigation({ tabindex: 0 });\n     *\n     * Turn on\n     * navigation.start(rootDomElement);\n     *\n     * On After Update\n     * navigation.update();\n     *\n     * On Destroy / Turn off\n     * navigation.stop();\n     */\n    var ConfiguratorNavigation = /** @class */ (function (_super) {\n        __extends(ConfiguratorNavigation, _super);\n        function ConfiguratorNavigation() {\n            var _this = _super !== null && _super.apply(this, arguments) || this;\n            _this.selectors = selectors;\n            _this.mouseEvents = mouseEvents;\n            _this.keyboardEvents = keyboardEvents;\n            return _this;\n        }\n        return ConfiguratorNavigation;\n    }(Navigation));\n\n    exports.A = discoverCommands;\n    exports.B = mergeTrees;\n    exports.C = parseResponse;\n    exports.D = readData;\n    exports.E = rootFields;\n    exports.F = setFilter;\n    exports.G = setSort;\n    exports.H = ConfiguratorNavigation;\n    exports.P = PivotGridNavigation;\n    exports.__meta__ = __meta__;\n    exports.a = createLocalDataState;\n    exports.b = averageAggregate;\n    exports.c = createDataTree;\n    exports.d = maxAggregate;\n    exports.e = countAggregate;\n    exports.f = fetchData;\n    exports.g = createDataState;\n    exports.h = fetchDiscover;\n    exports.i = headersReducer;\n    exports.j = toTree;\n    exports.k = toColumns;\n    exports.l = toRows;\n    exports.m = minAggregate;\n    exports.n = addKPI;\n    exports.o = addMultipleMeasures;\n    exports.p = buildKPIMeasures;\n    exports.q = cloneDataTree;\n    exports.r = compareAxes;\n    exports.s = sumAggregate;\n    exports.t = toData;\n    exports.u = configuratorReducer;\n    exports.v = createAxisDescriptors;\n    exports.w = createDiscoverBody;\n    exports.x = createFlatSchemaDimensions;\n    exports.y = createRequestBody;\n    exports.z = createTuples;\n\n}));\n"]}